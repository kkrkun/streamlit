const _0xe44749=_0x5354;(function(_0x31c80a,_0x3dd8f0){const _0x4a4625=_0x5354,_0x2555fb=_0x31c80a();while(!![]){try{const _0x22a5dc=parseInt(_0x4a4625(0x1e8))/0x1+parseInt(_0x4a4625(0x20e))/0x2*(parseInt(_0x4a4625(0x232))/0x3)+parseInt(_0x4a4625(0x1dc))/0x4*(parseInt(_0x4a4625(0x1f5))/0x5)+parseInt(_0x4a4625(0x23e))/0x6*(-parseInt(_0x4a4625(0x1e0))/0x7)+parseInt(_0x4a4625(0x1cd))/0x8*(-parseInt(_0x4a4625(0x26a))/0x9)+parseInt(_0x4a4625(0x1e4))/0xa*(-parseInt(_0x4a4625(0x21d))/0xb)+parseInt(_0x4a4625(0x244))/0xc*(parseInt(_0x4a4625(0x24f))/0xd);if(_0x22a5dc===_0x3dd8f0)break;else _0x2555fb['push'](_0x2555fb['shift']());}catch(_0x2d5d43){_0x2555fb['push'](_0x2555fb['shift']());}}}(_0x225d,0x8eaa7));const {Server,ServerEvent}=require(_0xe44749(0x1d8)),WebSocket=require('ws'),fetch=require('node-fetch'),wanakana=require('wanakana'),fs=require('fs'),JSON5=require('json5'),getPort=require(_0xe44749(0x1e5)),{Client}=require('ssh2'),net=require(_0xe44749(0x23b)),configPath=_0xe44749(0x207),config=JSON5[_0xe44749(0x235)](fs[_0xe44749(0x26c)](configPath,_0xe44749(0x248)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimentions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![];const server_log_info=_0x33b86c=>console[_0xe44749(0x1d9)](_0xe44749(0x266)+_0x33b86c),server_log_log=_0x39e82f=>console[_0xe44749(0x1d9)]('\x1b[33m[Log]\x1b[0m\x20'+_0x39e82f),processName=_0x3b0db3=>wanakana[_0xe44749(0x256)](_0x3b0db3[_0xe44749(0x24d)](/ /g,'_'))[_0xe44749(0x24d)](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0xe44749(0x200),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8;function _0x225d(){const _0x4c53dc=['sendMessage','localhost','https://','socket-be','log','disabled','yRot','278788jSdPaT','=======================================================\x0a','type','false','7SavHcf','specDim','password','runCommand','3908570TzoEuJ','get-port','action','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','345589aQAfcF','WebSocket\x20error:','\x0a!help\x20でコマンド一覧を確認できます','send','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','Error\x20handling\x20world:','floor','ws://127.0.0.1:','tcpexposer.com','exit','split','alive','です\x0aあなたのVCnameは','70bcXwTH','Spectator\x20set\x20to\x20common\x20VC','roomId','spectators','WorldRemove','終了シグナル受信。SSH接続を停止します...','end','Server','proximity','forEach','接続を開始しました\x0a近接vc：','mcproxvc.tcpexposer.com','createConnection','enabled','pipe','name','victim','\x20Relay\x20server\x20disconnected\x20(ID:\x20','./config.json','details','声の最大距離を','wss://','[VC\x20SSH]','localAddr','スペクテイターが他モードプレイヤーの会話を聞けるようになました','6506lfbjXL','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','distance','\x0a=======================================================','参加:\x20','/room/','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','<Proximity\x20VC>Language\x20set\x20to\x20English','from','includes','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','近接vcを有効にしました','Password\x20is\x20','22uuuRqU','Proximity\x20VC\x20disabled','dimension','string','Connection\x20started\x0aProximity\x20voice\x20chat:','players','localPlayer','once','OPEN','に変更しました','values','Participants\x20should\x20access\x20this\x20URL','PlayerLeave','SIGINT','localPort','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','ready','\x0a声の届く距離：','Changed\x20max\x20distance\x20to\x20','partner_connected','Password\x20disabled','39MDwEAw','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','スペクテイター同士の会話を共通にしました','parse','[MC\x20Relay]','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20name','socket-beサーバーのポート:\x20','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','[VC\x20Relay]','net','all','?clientType=server_script','5922924sBYhCh','--------------------','❌\x20SSH\x20Error\x20(','Open','specListen','.tcpexposer.com','25676712JhFPCn','Minecraftから以下のコマンドで接続してください:','close','clients','utf8','run_command','testfor\x20@a[m=spectator]','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','\x0aMax\x20distance:','replace','パスワードを有効にしました','13iMFDQY','パスワードを無効にしました','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使う名前を確認できます','接続終了:\x20','スペクテイターとVCを分けました','true','[MC\x20Local\x20WS\x20Error]','toRomaji','\x20Relay\x20server\x20connected\x20(ID:\x20','退出:\x20','Spectator`s\x20VC\x20separated\x20by\x20dimension','パスワードは','<近接VC>言語を日本語に設定しました','\x0aYour\x20VCname\x20is\x20','message','testfor\x20@e[type=player]','value','[MC\x20SSH]','forwardIn','https://proximity-vc-mcbe.pages.dev?roomid=','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','/connect\x20','\x20WebSocket\x20error:','\x1b[36m[Info]\x1b[0m\x20','toString','WebSocketメッセージの解析に失敗:','tcp\x20connection','17397SGbrcz','remoteAddr','readFileSync','error','world_update','ROOM\x20ID:\x20','4760lOLDLS','open','writeFileSync','spectator','ローカル接続エラー\x20(','connect','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','接続開始:\x20'];_0x225d=function(){return _0x4c53dc;};return _0x225d();}let inactivityTimer;const resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{const _0x2bc9e1=_0x5354;process[_0x2bc9e1(0x1f1)](0x7c);},INACTIVITY_TIMEOUT);};function _0x5354(_0x3ecefc,_0x4c9346){const _0x225d05=_0x225d();return _0x5354=function(_0x5354e5,_0x18a91d){_0x5354e5=_0x5354e5-0x1ca;let _0x2c56c5=_0x225d05[_0x5354e5];return _0x2c56c5;},_0x5354(_0x3ecefc,_0x4c9346);}function startSshForwarding(_0x394a9e,_0x4b080e,_0x32ac73){const _0x1b7b06=_0xe44749;if(!_0x394a9e||!username||!ssh_password)return;const _0x52778a=_0x32ac73==='vc',_0x11ecc2=_0x52778a?_0x1b7b06(0x20b):_0x1b7b06(0x260),_0x18b6d9={'host':_0x1b7b06(0x1f0),'port':0x16,'username':username,'password':ssh_password},_0x34172c={'remoteAddr':_0x394a9e,'remotePort':0x50,'localAddr':_0x1b7b06(0x1d6),'localPort':_0x4b080e},_0x7eff6e=new Client();return _0x7eff6e['on'](_0x1b7b06(0x22d),()=>{const _0x16affc=_0x1b7b06;_0x7eff6e[_0x16affc(0x261)](_0x34172c[_0x16affc(0x26b)],_0x34172c['remotePort'],_0x26fb68=>{const _0x4ce012=_0x16affc;if(_0x26fb68)return console[_0x4ce012(0x1ca)](_0x11ecc2+'❌\x20ポートフォワーディング失敗\x20('+_0x394a9e+'):',_0x26fb68[_0x4ce012(0x25d)]),server_log_info(_0x11ecc2+'中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),connectToRelayServer(_0x32ac73),_0x7eff6e[_0x4ce012(0x1fb)]();console['log'](_0x4ce012(0x212)),_0x52778a?(useRelay=![],vc_connected=!![],server_log_info(_0x4ce012(0x1cc)+_0x394a9e),server_log_info('参加者はこのURLにアクセスしてください:'),server_log_info(_0x4ce012(0x228)),server_log_info(_0x4ce012(0x262)+_0x394a9e)):(server_log_info(_0x4ce012(0x245)),server_log_info(_0x4ce012(0x215)),server_log_info('/connect\x20'+_0x394a9e+_0x4ce012(0x243))),console[_0x4ce012(0x1d9)](_0x4ce012(0x1dd));}),_0x7eff6e['on'](_0x16affc(0x269),(_0x345005,_0xb440f4)=>{const _0x4b1c9c=_0x16affc,_0x35a1be=_0xb440f4(),_0x2f3665=net[_0x4b1c9c(0x201)]({'host':_0x34172c[_0x4b1c9c(0x20c)],'port':_0x34172c[_0x4b1c9c(0x22b)]});_0x2f3665['on'](_0x4b1c9c(0x1d2),()=>_0x35a1be[_0x4b1c9c(0x203)](_0x2f3665)[_0x4b1c9c(0x203)](_0x35a1be)),_0x2f3665['on'](_0x4b1c9c(0x1ca),_0xc77762=>{const _0x3e34b9=_0x4b1c9c;console[_0x3e34b9(0x1ca)](_0x3e34b9(0x1d1)+_0x394a9e+'):',_0xc77762[_0x3e34b9(0x25d)]),_0x35a1be[_0x3e34b9(0x246)]();}),_0x35a1be['on'](_0x4b1c9c(0x246),()=>_0x2f3665[_0x4b1c9c(0x1fb)]());});})['on'](_0x1b7b06(0x1ca),_0x23bce3=>{const _0x3e19ab=_0x1b7b06;console[_0x3e19ab(0x1ca)](_0x3e19ab(0x240)+_0x394a9e+'):',_0x23bce3[_0x3e19ab(0x25d)]),server_log_info(_0x11ecc2+_0x3e19ab(0x20f)),connectToRelayServer(_0x32ac73);}),_0x7eff6e[_0x1b7b06(0x1d2)](_0x18b6d9),_0x7eff6e;}async function setupWebSocketServer(){const _0x12e965=_0xe44749;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0x12e965(0x1fc))]({'port':web_port}),wss['on']('connection',_0x5dede3=>{const _0x57d92b=_0x12e965;_0x5dede3['on']('message',_0x5e16c7=>{const _0x369b5b=_0x5354;try{const {userName:_0x354602,position:_0x22513d}=JSON[_0x369b5b(0x235)](_0x5e16c7);if(_0x354602&&_0x22513d)positions[_0x354602]=_0x22513d;}catch(_0x5d0849){console[_0x369b5b(0x1ca)](_0x369b5b(0x268),_0x5d0849);}}),_0x5dede3['on'](_0x57d92b(0x1ca),_0x283596=>console['error'](_0x57d92b(0x1e9),_0x283596));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console['log']('\x0a======================================================='),server_log_info(_0x12e965(0x245)),server_log_info('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'),server_log_info('/connect\x20localhost:'+port),console[_0x12e965(0x1d9)](_0x12e965(0x1dd));process['on'](_0x12e965(0x22a),()=>{const _0x27a944=_0x12e965;console[_0x27a944(0x1d9)](_0x27a944(0x1fa));if(vcSSHClient)vcSSHClient[_0x27a944(0x1fb)]();if(mcSSHClient)mcSSHClient[_0x27a944(0x1fb)]();process[_0x27a944(0x1f1)]();});}function broadcastPositions(){const _0x51d642=_0xe44749,_0x5aeb9e=JSON['stringify']({'type':_0x51d642(0x1cb),'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimentions':dimentions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.['readyState']===WebSocket[_0x51d642(0x225)])relayWs[_0x51d642(0x1eb)](_0x5aeb9e);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x51d642(0x247)][_0x51d642(0x1fe)](_0x5aeb06=>{_0x5aeb06['readyState']===WebSocket['OPEN']&&_0x5aeb06['send'](_0x5aeb9e);});}async function handleWorld(_0x47d5eb){const _0x4a086a=_0xe44749;try{const _0x4c876e=Array[_0x4a086a(0x218)](_0x47d5eb[_0x4a086a(0x222)][_0x4a086a(0x227)](),_0x1673ee=>String(_0x1673ee['name']));let _0x38029a={};if(proximity){const [_0x43e04b,_0x394bac,_0x4842df]=await Promise[_0x4a086a(0x23c)]([_0x47d5eb[_0x4a086a(0x1e3)](_0x4a086a(0x25e)),_0x47d5eb[_0x4a086a(0x1e3)](_0x4a086a(0x24a)),_0x47d5eb['runCommand']('querytarget\x20@e[type=player]')]);_0x38029a={'alive':_0x43e04b[_0x4a086a(0x205)]||[],'spectators':_0x394bac[_0x4a086a(0x205)]||[],'details':JSON[_0x4a086a(0x235)](_0x4842df[_0x4a086a(0x208)]||'[]')};}_0x4c876e[_0x4a086a(0x1fe)](_0xee5e8f=>{const _0x5caebc=_0x4a086a;resetTimer();let _0x5378fb;if(proximity)_0x5378fb=_0x38029a['alive']['indexOf'](_0xee5e8f);const _0x101881=processName(_0xee5e8f);_0x38029a[_0x5caebc(0x1f8)][_0x5caebc(0x219)](_0xee5e8f)?spectators[_0x101881]=!![]:spectators[_0x101881]=![];if(!proximity)positions[_0x101881]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x38029a[_0x5caebc(0x1f3)]['includes'](_0xee5e8f))positions[_0x101881]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x38029a[_0x5caebc(0x1f8)]['includes'](_0xee5e8f)){if(specListen===!![])positions[_0x101881]=_0x38029a['details'][_0x5378fb]['position'];else positions[_0x101881]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimentions[_0x101881]=_0x38029a['details'][_0x5378fb][_0x5caebc(0x21f)];}else _0x38029a[_0x5caebc(0x208)][_0x5378fb]?.['position']?(positions[_0x101881]=_0x38029a['details'][_0x5378fb]['position'],yRots[_0x101881]=_0x38029a['details'][_0x5378fb][_0x5caebc(0x1db)],dimentions[_0x101881]=_0x38029a['details'][_0x5378fb][_0x5caebc(0x21f)]):positions[_0x101881]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x3768e8){console[_0x4a086a(0x1ca)](_0x4a086a(0x1ed),_0x3768e8);}if(!stop_roop)setTimeout(()=>handleWorld(_0x47d5eb),0x64);}async function connectToRelayServer(_0x4cd75e){const _0x181467=_0xe44749,_0xba9043=_0x4cd75e==='mc',_0xb761c5=_0xba9043?_0x181467(0x236):_0x181467(0x23a);try{const _0x476cec=await fetch(_0x181467(0x1d7)+RELAY_SERVER_DOMAIN+'/create-room'),_0x3a927d=await _0x476cec['json'](),_0x6a6f41=_0x3a927d[_0x181467(0x1f7)];if(!_0xba9043)roomId=_0x6a6f41;console[_0x181467(0x1d9)](_0x181467(0x212));_0xba9043?(server_log_info(_0x181467(0x245)),server_log_info(_0x181467(0x215)),server_log_info(_0x181467(0x264)+RELAY_SERVER_DOMAIN+_0x181467(0x214)+_0x6a6f41)):(useRelay=!![],vc_connected=!![],server_log_info('ROOM\x20ID:\x20'+_0x6a6f41),server_log_info('参加者はこのURLにアクセスしてください:'),server_log_info(_0x181467(0x228)),server_log_info(_0x181467(0x262)+_0x6a6f41));console['log'](_0x181467(0x1dd));const _0x5e24f6=new WebSocket(_0x181467(0x20a)+RELAY_SERVER_DOMAIN+_0x181467(0x214)+_0x6a6f41+_0x181467(0x23d));if(!_0xba9043)relayWs=_0x5e24f6;_0x5e24f6['on'](_0x181467(0x1ce),()=>console[_0x181467(0x1d9)](_0xb761c5+_0x181467(0x257)+_0x6a6f41+')')),_0x5e24f6['on'](_0x181467(0x246),()=>console[_0x181467(0x1d9)](_0xb761c5+_0x181467(0x206)+_0x6a6f41+')')),_0x5e24f6['on']('error',_0x1c4b3e=>console['error'](_0xb761c5+_0x181467(0x265),_0x1c4b3e));if(_0xba9043){let _0x4a1d53='',_0x1df4fa='';if(lang=='ja'){let _0xf6ab6='';proximity?_0xf6ab6='有効':_0xf6ab6='無効',_0x4a1d53=_0x181467(0x1ff)+_0xf6ab6+_0x181467(0x22e)+distance+'\x0a!help\x20でコマンド一覧を確認できます';}else{let _0xc20b34='';proximity?_0xc20b34=_0x181467(0x202):_0xc20b34='disabled',_0x1df4fa='Connection\x20started\x0aProximity\x20voice\x20chat:'+_0xc20b34+'\x0aMax\x20distance:'+distance+'\x0a!help\x20for\x20command\x20list';}const _0x23c623=lang==='ja'?_0x4a1d53:_0x1df4fa;_0x5e24f6[_0x181467(0x224)]('open',()=>{const _0xdf1d89=_0x181467,_0x1b6c97={'type':'initialization','message':_0x23c623,'lang':lang};_0x5e24f6[_0xdf1d89(0x1eb)](JSON['stringify'](_0x1b6c97));}),setupMcRelayListeners(_0x5e24f6);}else setupVcRelayListeners(_0x5e24f6);}catch(_0xf5efc6){console[_0x181467(0x1ca)](_0xb761c5+'\x20処理中にエラーが発生しました:',_0xf5efc6);}}function setupVcRelayListeners(_0x7fba9b){const _0x20bd3c=_0xe44749;_0x7fba9b['on'](_0x20bd3c(0x25d),async _0x2d4d32=>{const _0x31f322=_0x20bd3c;try{const _0x608cb7=JSON[_0x31f322(0x235)](_0x2d4d32[_0x31f322(0x267)]());if(mainWorld&&_0x608cb7[_0x31f322(0x1e6)]===_0x31f322(0x249)&&typeof _0x608cb7[_0x31f322(0x25f)]===_0x31f322(0x220)){const _0x27e743=await mainWorld[_0x31f322(0x1e3)](_0x608cb7[_0x31f322(0x25f)]);_0x7fba9b[_0x31f322(0x1eb)](JSON['stringify']({'type':'command_result','payload':_0x27e743}));}}catch(_0x2ab381){console[_0x31f322(0x1ca)]('[VC\x20Relay]\x20メッセージ処理エラー:',_0x2ab381);}});}function setupMcRelayListeners(_0x5b8fa5){const _0x33ac46=_0xe44749;let _0x4c4c82;_0x5b8fa5['on'](_0x33ac46(0x25d),_0x45d8cd=>{const _0x389c50=_0x33ac46;try{const _0xea1d=JSON[_0x389c50(0x235)](_0x45d8cd[_0x389c50(0x267)]());if(_0xea1d[_0x389c50(0x1de)]===_0x389c50(0x230)){console['log'](_0x389c50(0x216)),_0x4c4c82=new WebSocket(_0x389c50(0x1ef)+port),_0x4c4c82['on'](_0x389c50(0x1ce),()=>console[_0x389c50(0x1d9)](_0x389c50(0x233))),_0x4c4c82['on']('message',_0x2baef1=>_0x5b8fa5['readyState']===WebSocket[_0x389c50(0x225)]&&_0x5b8fa5[_0x389c50(0x1eb)](_0x2baef1)),_0x4c4c82['on'](_0x389c50(0x246),()=>_0x5b8fa5['readyState']===WebSocket[_0x389c50(0x225)]&&_0x5b8fa5[_0x389c50(0x246)]()),_0x4c4c82['on'](_0x389c50(0x1ca),_0x451a3c=>console[_0x389c50(0x1ca)](_0x389c50(0x255),_0x451a3c['message']));return;}}catch(_0x414dbf){}_0x4c4c82?.['readyState']===WebSocket[_0x389c50(0x225)]&&_0x4c4c82[_0x389c50(0x1eb)](_0x45d8cd);}),_0x5b8fa5['on'](_0x33ac46(0x246),()=>_0x4c4c82?.['close']());}async function main(){const _0x1144bd=_0xe44749;resetTimer(),port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x1144bd(0x238)+port);const _0x339d18=new Server({'port':port,'disableEncryption':!![],'timezone':'Asia/Tokyo'}),_0x59f352=(_0x45295e,_0x22e99d)=>{const _0xda4c35=_0x1144bd;try{let _0x50656b=fs[_0xda4c35(0x26c)](configPath,'utf8');const _0x10b5d1=new RegExp('(\x22'+_0x45295e+_0xda4c35(0x263)),_0x127970=typeof _0x22e99d===_0xda4c35(0x220)?'\x22'+_0x22e99d+'\x22':_0x22e99d,_0x4dac6c=_0x50656b[_0xda4c35(0x24d)](_0x10b5d1,'$1'+_0x127970);_0x4dac6c!==_0x50656b&&fs[_0xda4c35(0x1cf)](configPath,_0x4dac6c,_0xda4c35(0x248));}catch(_0x15299a){console[_0xda4c35(0x1ca)]('❌\x20設定ファイルの更新に失敗しました:',_0x15299a);}},_0x172ade=(_0x7fe8f0,_0x4e77b8,_0x202608)=>async(_0x1041a1,_0x35cab4,_0xdcd46d)=>{const _0x244a13=_0x1144bd;if(_0x35cab4[_0x244a13(0x204)]!==_0x1041a1[_0x244a13(0x223)]['name'])return;if(_0xdcd46d[0x0]!==_0x244a13(0x254)&&_0xdcd46d[0x0]!==_0x244a13(0x1df))return;const _0x157b82=_0xdcd46d[0x0]===_0x244a13(0x254);if(_0x7fe8f0===_0x244a13(0x1e2))password=_0x157b82;else{if(_0x7fe8f0===_0x244a13(0x1fd))proximity=_0x157b82;else{if(_0x7fe8f0===_0x244a13(0x1d0))spectator=_0x157b82;else{if(_0x7fe8f0===_0x244a13(0x242))specListen=_0x157b82;else{if(_0x7fe8f0===_0x244a13(0x1e1))specDim=_0x157b82;}}}}_0x59f352(_0x7fe8f0,_0x157b82),Object['assign'](global,{[_0x7fe8f0]:_0x157b82});const _0x2231db=lang==='ja'?_0x157b82?_0x4e77b8[_0x244a13(0x202)]:_0x4e77b8['disabled']:_0x157b82?_0x202608[_0x244a13(0x202)]:_0x202608[_0x244a13(0x1da)];await _0x1041a1['sendMessage'](_0x2231db);},_0x37247c={'!dis':async(_0x6f8d6b,_0x45a834,_0x233659)=>{const _0x1eb2af=_0x1144bd;try{if(_0x45a834[_0x1eb2af(0x204)]!==_0x6f8d6b[_0x1eb2af(0x223)]['name'])return;const _0x399384=Number(_0x233659[0x0]);if(!isNaN(_0x399384)){distance=_0x399384,_0x59f352(_0x1eb2af(0x211),_0x399384);const _0x4dcae3=lang==='ja'?_0x1eb2af(0x209)+distance+_0x1eb2af(0x226):_0x1eb2af(0x22f)+distance;await _0x6f8d6b[_0x1eb2af(0x1d5)](_0x4dcae3);}}catch(_0x4331be){}},'!name':async(_0x5876c9,_0x17c055)=>{const _0x13fba3=_0x1144bd;try{const _0x166538=processName(_0x17c055[_0x13fba3(0x204)]),_0x1914d8=_0x13fba3(0x1d3)+roomId+_0x13fba3(0x1f4)+_0x166538+'です',_0x1dffc9=_0x13fba3(0x22c)+roomId+_0x13fba3(0x25c)+_0x166538;await _0x17c055[_0x13fba3(0x1d5)](lang==='ja'?_0x1914d8:_0x1dffc9);if(password){!passwords[_0x166538]&&(passwords[_0x166538]=Math['floor'](0x3e8+Math['random']()*0x2328)['toString']());const _0x80e2ad=lang==='ja'?_0x13fba3(0x25a)+passwords[_0x166538]+'です':_0x13fba3(0x21c)+passwords[_0x166538];await _0x17c055[_0x13fba3(0x1d5)](_0x80e2ad);}}catch(_0x2354cb){}},'!password':_0x172ade('password',{'enabled':_0x1144bd(0x24e),'disabled':_0x1144bd(0x250)},{'enabled':'Password\x20enabled','disabled':_0x1144bd(0x231)}),'!pvc':_0x172ade(_0x1144bd(0x1fd),{'enabled':_0x1144bd(0x21b),'disabled':'近接vcを無効にしました'},{'enabled':'Proximity\x20VC\x20enabled','disabled':_0x1144bd(0x21e)}),'!spectator':_0x172ade(_0x1144bd(0x1d0),{'enabled':_0x1144bd(0x253),'disabled':'スペクテイターを共通のVCにしました'},{'enabled':'Spectator\x20and\x20VC\x20separated','disabled':_0x1144bd(0x1f6)}),'!specListen':_0x172ade(_0x1144bd(0x242),{'enable':_0x1144bd(0x20d),'disable':_0x1144bd(0x21a)},{'enable':_0x1144bd(0x1ec),'disable':_0x1144bd(0x24b)}),'!specDim':_0x172ade(_0x1144bd(0x1e1),{'enable':'\x20スペクテイター同士の会話をディメンションごとに分けました','disable':_0x1144bd(0x234)},{'enable':_0x1144bd(0x259),'disable':'Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions'}),'!lang':async(_0x583d17,_0x2a8dd2,_0x56d9c4)=>{const _0x35efdd=_0x1144bd;try{if(_0x2a8dd2[_0x35efdd(0x204)]!==_0x583d17['localPlayer']['name'])return;const _0x558c46=_0x56d9c4[0x0]==='ja'?'ja':'en';lang=_0x558c46,_0x59f352('lang',_0x558c46);const _0x1f9ae7=_0x558c46==='ja'?_0x35efdd(0x25b):_0x35efdd(0x217);await _0x583d17[_0x35efdd(0x1d5)](_0x1f9ae7);}catch(_0x32f831){}},'!help':async(_0x55a891,_0x19e887)=>{const _0x2b6b89=_0x1144bd;try{await _0x19e887[_0x2b6b89(0x1d5)](_0x2b6b89(0x23f));if(lang=='ja'){await _0x19e887['sendMessage'](_0x2b6b89(0x251));const _0x58a836=_0x55a891[_0x2b6b89(0x223)][_0x2b6b89(0x204)];_0x19e887[_0x2b6b89(0x204)]==_0x58a836&&await _0x19e887[_0x2b6b89(0x1d5)]('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x19e887[_0x2b6b89(0x1d5)](_0x2b6b89(0x237));const _0x3d6698=_0x55a891[_0x2b6b89(0x223)][_0x2b6b89(0x204)];_0x19e887['name']==_0x3d6698&&await _0x19e887['sendMessage'](_0x2b6b89(0x239));}await _0x19e887['sendMessage']('--------------------');}catch(_0x41060c){}}};_0x339d18['on'](ServerEvent['PlayerChat'],async({sender:_0xc4c4a9,message:_0x3a8e2b,world:_0x5b2af9})=>{const _0x59a467=_0x1144bd,[_0x11f651,..._0x3735bb]=_0x3a8e2b[_0x59a467(0x1f2)]('\x20');if(_0x37247c[_0x11f651])await _0x37247c[_0x11f651](_0x5b2af9,_0xc4c4a9,_0x3735bb);}),_0x339d18['on'](ServerEvent[_0x1144bd(0x241)],()=>setupWebSocketServer()),_0x339d18['on'](ServerEvent['WorldAdd'],async({world:_0x473be5})=>{const _0x4ad5e2=_0x1144bd;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x473be5,stop_roop=![],server_log_info(_0x4ad5e2(0x1d4)+_0x473be5[_0x4ad5e2(0x204)]);if(lang=='ja'){let _0x3d3e65='';proximity?_0x3d3e65='有効':_0x3d3e65='無効',_0x473be5[_0x4ad5e2(0x1d5)](_0x4ad5e2(0x1ff)+_0x3d3e65+_0x4ad5e2(0x22e)+distance+_0x4ad5e2(0x1ea));}else{let _0x470497='';proximity?_0x470497=_0x4ad5e2(0x202):_0x470497=_0x4ad5e2(0x1da),_0x473be5[_0x4ad5e2(0x1d5)](_0x4ad5e2(0x221)+_0x470497+_0x4ad5e2(0x24c)+distance+'\x0a!help\x20for\x20command\x20list');}await handleWorld(_0x473be5);}),_0x339d18['on'](ServerEvent[_0x1144bd(0x1f9)],({world:_0x28ad10})=>{const _0x54f0b5=_0x1144bd;mainWorld=null,stop_roop=!![],server_log_info(_0x54f0b5(0x252)+_0x28ad10[_0x54f0b5(0x204)]);}),_0x339d18['on'](ServerEvent['PlayerLoad'],async({player:_0x26a46e,world:_0x21c4a8})=>{const _0x5012e1=_0x1144bd;server_log_info(_0x5012e1(0x213)+_0x26a46e[_0x5012e1(0x204)]);const _0x1f26b0=setInterval(async()=>{const _0xe0bc95=_0x5012e1;try{const _0x151070=processName(_0x26a46e[_0xe0bc95(0x204)]),_0x311276=_0xe0bc95(0x210)+roomId+_0xe0bc95(0x1f4)+_0x151070+'です',_0x197e7c=_0xe0bc95(0x1e7)+roomId+_0xe0bc95(0x25c)+_0x151070;await _0x26a46e[_0xe0bc95(0x1d5)](lang==='ja'?_0x311276:_0x197e7c);if(password){!passwords[_0x151070]&&(passwords[_0x151070]=Math[_0xe0bc95(0x1ee)](0x3e8+Math['random']()*0x2328)[_0xe0bc95(0x267)]());const _0x4f2a15=lang==='ja'?_0xe0bc95(0x25a)+passwords[_0x151070]+'です':_0xe0bc95(0x21c)+passwords[_0x151070];await _0x26a46e[_0xe0bc95(0x1d5)](_0x4f2a15);}clearInterval(_0x1f26b0);}catch(_0x157b65){}},0x1f4);}),_0x339d18['on'](ServerEvent[_0x1144bd(0x229)],({player:_0x2c5356,world:_0x2777e6})=>{const _0x17e2e5=_0x1144bd;server_log_info(_0x17e2e5(0x258)+_0x2c5356['name']);const _0x52e573=_0x2777e6[_0x17e2e5(0x223)]['name'];if(_0x2c5356['name']===_0x52e573)process['exit'](0x0);delete positions[processName(_0x2c5356[_0x17e2e5(0x204)])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info('中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
