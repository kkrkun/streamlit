const _0x406bb8=_0x17c8;(function(_0x20aa6e,_0x1a192d){const _0x488f7c=_0x17c8,_0x37841d=_0x20aa6e();while(!![]){try{const _0x16b707=-parseInt(_0x488f7c(0x1ce))/0x1+parseInt(_0x488f7c(0x1ef))/0x2*(parseInt(_0x488f7c(0x1b8))/0x3)+parseInt(_0x488f7c(0x1ed))/0x4+-parseInt(_0x488f7c(0x1a1))/0x5*(parseInt(_0x488f7c(0x213))/0x6)+-parseInt(_0x488f7c(0x1c7))/0x7*(parseInt(_0x488f7c(0x22a))/0x8)+parseInt(_0x488f7c(0x211))/0x9*(-parseInt(_0x488f7c(0x1a7))/0xa)+parseInt(_0x488f7c(0x1ea))/0xb*(parseInt(_0x488f7c(0x222))/0xc);if(_0x16b707===_0x1a192d)break;else _0x37841d['push'](_0x37841d['shift']());}catch(_0x25bc79){_0x37841d['push'](_0x37841d['shift']());}}}(_0x4282,0xe015f));const {Server,ServerEvent}=require(_0x406bb8(0x221)),WebSocket=require('ws'),fetch=require(_0x406bb8(0x20f)),wanakana=require('wanakana'),fs=require('fs'),JSON5=require('json5'),getPort=require(_0x406bb8(0x1b7)),{Client}=require(_0x406bb8(0x198)),net=require(_0x406bb8(0x219)),configPath=_0x406bb8(0x1ca),config=JSON5[_0x406bb8(0x212)](fs[_0x406bb8(0x1e8)](configPath,_0x406bb8(0x1c8)));function _0x4282(){const _0x4ef9bf=['readyState','action','ssh2','all','スペクテイターとVCを分けました','\x20処理中にエラーが発生しました:','true','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','Proximity\x20VC\x20disabled','声の最大距離を','Connection\x20started\x0aProximity\x20voice\x20chat:','8796805PofoRO','Open','enabled','/connect\x20localhost:','ROOM\x20ID:\x20','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','10kywrni','Server','dimension','Minecraftから以下のコマンドで接続してください:','position','distance','[MC\x20Relay]','createConnection','details','ready','pipe','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20name','パスワードは','connection','forEach','❌\x20SSH\x20Error\x20(','get-port','1758JwTaYj','proximity','接続開始:\x20','sendMessage','接続終了:\x20','\x0a!help\x20でコマンド一覧を確認できます','Spectator`s\x20VC\x20separated\x20by\x20dimension','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','[VC\x20SSH]','WorldAdd','Error\x20handling\x20world:','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','Participants\x20should\x20access\x20this\x20URL','command_result','7WZHtRC','utf8','socket-beサーバーのポート:\x20','./config.json','\x20WebSocket\x20error:','=======================================================\x0a','https://','73620ATFJNu','random','includes','clients','\x1b[36m[Info]\x1b[0m\x20','/create-room','近接vcを無効にしました','https://proximity-vc-mcbe.pages.dev?roomid=','toRomaji','password','replace','localhost','runCommand','\x20スペクテイター同士の会話をディメンションごとに分けました','localPlayer','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','indexOf','exit','スペクテイターを共通のVCにしました','退出:\x20','Password\x20enabled','Spectator\x20set\x20to\x20common\x20VC','players','forwardIn','/room/','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','readFileSync','error','66oihZHv','disabled','\x0a=======================================================','3460088tmDZQj','alive','314rKNdJr','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使う名前を確認できます','wss://','参加者はこのURLにアクセスしてください:','run_command','open','tcpexposer.com','WorldRemove','ws://127.0.0.1:','close','Password\x20is\x20','spectators','message','OPEN','参加:\x20','values','testfor\x20@e[type=player]','value','end','toString','❌\x20設定ファイルの更新に失敗しました:','log','\x0a!help\x20for\x20command\x20list','localPort','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','string','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','from','です\x0aあなたのVCnameは','\x0a声の届く距離：','Proximity\x20VC\x20enabled','node-fetch','\x0aYour\x20VCname\x20is\x20','7715457yGOEDs','parse','6qGSyUt','--------------------','SIGINT','json','stringify','split','net','?clientType=server_script','victim','[MC\x20Local\x20WS\x20Error]','remoteAddr','/connect\x20','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','socket-be','8076492jlFltc','に変更しました','\x0aMax\x20distance:','WebSocket\x20error:','.tcpexposer.com','\x20Relay\x20server\x20disconnected\x20(ID:\x20','localAddr','name','11097288gKDusY','Password\x20disabled','writeFileSync','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','send','WebSocketメッセージの解析に失敗:','specListen','Changed\x20max\x20distance\x20to\x20'];_0x4282=function(){return _0x4ef9bf;};return _0x4282();}let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimentions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![];const server_log_info=_0x2b657a=>console[_0x406bb8(0x204)](_0x406bb8(0x1d2)+_0x2b657a),server_log_log=_0x1ee0fe=>console[_0x406bb8(0x204)]('\x1b[33m[Log]\x1b[0m\x20'+_0x1ee0fe),processName=_0x404d00=>wanakana[_0x406bb8(0x1d6)](_0x404d00[_0x406bb8(0x1d8)](/ /g,'_'))['replace'](/n'/g,'n'),RELAY_SERVER_DOMAIN='mcproxvc.tcpexposer.com';function _0x17c8(_0x36e196,_0xccc339){const _0x428213=_0x4282();return _0x17c8=function(_0x17c8b8,_0x333846){_0x17c8b8=_0x17c8b8-0x196;let _0x1599a2=_0x428213[_0x17c8b8];return _0x1599a2;},_0x17c8(_0x36e196,_0xccc339);}function startSshForwarding(_0x275fe4,_0x1d90ea,_0x408d7a){const _0x18e2df=_0x406bb8;if(!_0x275fe4||!username||!ssh_password)return;const _0x30d7ad=_0x408d7a==='vc',_0x260153=_0x30d7ad?_0x18e2df(0x1c0):'[MC\x20SSH]',_0x58b90c={'host':_0x18e2df(0x1f5),'port':0x16,'username':username,'password':ssh_password},_0x5e81b9={'remoteAddr':_0x275fe4,'remotePort':0x50,'localAddr':_0x18e2df(0x1d9),'localPort':_0x1d90ea},_0xab730b=new Client();return _0xab730b['on'](_0x18e2df(0x1b0),()=>{const _0x4703ec=_0x18e2df;_0xab730b[_0x4703ec(0x1e5)](_0x5e81b9[_0x4703ec(0x21d)],_0x5e81b9['remotePort'],_0x3c5f5d=>{const _0x28065b=_0x4703ec;if(_0x3c5f5d)return console[_0x28065b(0x1e9)](_0x260153+'❌\x20ポートフォワーディング失敗\x20('+_0x275fe4+'):',_0x3c5f5d[_0x28065b(0x1fb)]),server_log_info(_0x260153+_0x28065b(0x22d)),connectToRelayServer(_0x408d7a),_0xab730b[_0x28065b(0x201)]();console[_0x28065b(0x204)]('\x0a======================================================='),_0x30d7ad?(useRelay=![],vc_connected=!![],server_log_info(_0x28065b(0x1a5)+_0x275fe4),server_log_info(_0x28065b(0x1f2)),server_log_info(_0x28065b(0x1c5)),server_log_info(_0x28065b(0x1d5)+_0x275fe4)):(server_log_info(_0x28065b(0x1aa)),server_log_info('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'),server_log_info(_0x28065b(0x21e)+_0x275fe4+_0x28065b(0x226))),console['log'](_0x28065b(0x1cc));}),_0xab730b['on']('tcp\x20connection',(_0xcd0c22,_0x313263)=>{const _0x443341=_0x4703ec,_0x3d2620=_0x313263(),_0x439374=net[_0x443341(0x1ae)]({'host':_0x5e81b9[_0x443341(0x228)],'port':_0x5e81b9[_0x443341(0x206)]});_0x439374['on']('connect',()=>_0x3d2620[_0x443341(0x1b1)](_0x439374)[_0x443341(0x1b1)](_0x3d2620)),_0x439374['on'](_0x443341(0x1e9),_0x5d3cff=>{const _0x296482=_0x443341;console[_0x296482(0x1e9)]('ローカル接続エラー\x20('+_0x275fe4+'):',_0x5d3cff[_0x296482(0x1fb)]),_0x3d2620[_0x296482(0x1f8)]();}),_0x3d2620['on']('close',()=>_0x439374['end']());});})['on']('error',_0x44b309=>{const _0x3dc183=_0x18e2df;console[_0x3dc183(0x1e9)](_0x260153+_0x3dc183(0x1b6)+_0x275fe4+'):',_0x44b309['message']),server_log_info(_0x260153+'中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),connectToRelayServer(_0x408d7a);}),_0xab730b['connect'](_0x58b90c),_0xab730b;}async function setupWebSocketServer(){const _0x11e2ce=_0x406bb8;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0x11e2ce(0x1a8))]({'port':web_port}),wss['on'](_0x11e2ce(0x1b4),_0x2889dc=>{const _0x12a763=_0x11e2ce;_0x2889dc['on'](_0x12a763(0x1fb),_0x14699a=>{const _0x447d25=_0x12a763;try{const {userName:_0x3f72ec,position:_0x18a2cb}=JSON[_0x447d25(0x212)](_0x14699a);if(_0x3f72ec&&_0x18a2cb)positions[_0x3f72ec]=_0x18a2cb;}catch(_0x138ab9){console[_0x447d25(0x1e9)](_0x447d25(0x22f),_0x138ab9);}}),_0x2889dc['on']('error',_0x318929=>console[_0x12a763(0x1e9)](_0x12a763(0x225),_0x318929));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x11e2ce(0x204)]('\x0a======================================================='),server_log_info(_0x11e2ce(0x1aa)),server_log_info(_0x11e2ce(0x1bf)),server_log_info(_0x11e2ce(0x1a4)+port),console[_0x11e2ce(0x204)](_0x11e2ce(0x1cc));process['on'](_0x11e2ce(0x215),()=>{const _0x207447=_0x11e2ce;console[_0x207447(0x204)]('終了シグナル受信。SSH接続を停止します...');if(vcSSHClient)vcSSHClient[_0x207447(0x201)]();if(mcSSHClient)mcSSHClient[_0x207447(0x201)]();process[_0x207447(0x1df)]();});}function broadcastPositions(){const _0x5aec75=_0x406bb8,_0x5961e5=JSON['stringify']({'type':'world_update','proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimentions':dimentions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x5aec75(0x196)]===WebSocket[_0x5aec75(0x1fc)])relayWs[_0x5aec75(0x22e)](_0x5961e5);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x5aec75(0x1d1)][_0x5aec75(0x1b5)](_0x13261d=>{const _0x18850d=_0x5aec75;_0x13261d[_0x18850d(0x196)]===WebSocket[_0x18850d(0x1fc)]&&_0x13261d[_0x18850d(0x22e)](_0x5961e5);});}async function handleWorld(_0xa90ed6){const _0x59f11f=_0x406bb8;try{const _0x90cc93=Array[_0x59f11f(0x20b)](_0xa90ed6[_0x59f11f(0x1e4)][_0x59f11f(0x1fe)](),_0x4af012=>String(_0x4af012[_0x59f11f(0x229)]));let _0x3e6bac={};if(proximity){const [_0x570e52,_0x4370ad,_0x2320e7]=await Promise[_0x59f11f(0x199)]([_0xa90ed6[_0x59f11f(0x1da)](_0x59f11f(0x1ff)),_0xa90ed6[_0x59f11f(0x1da)]('testfor\x20@a[m=spectator]'),_0xa90ed6[_0x59f11f(0x1da)]('querytarget\x20@e[type=player]')]);_0x3e6bac={'alive':_0x570e52[_0x59f11f(0x21b)]||[],'spectators':_0x4370ad[_0x59f11f(0x21b)]||[],'details':JSON[_0x59f11f(0x212)](_0x2320e7[_0x59f11f(0x1af)]||'[]')};}_0x90cc93[_0x59f11f(0x1b5)](_0x1a3688=>{const _0x3cf56b=_0x59f11f;let _0x4362c8;if(proximity)_0x4362c8=_0x3e6bac[_0x3cf56b(0x1ee)][_0x3cf56b(0x1de)](_0x1a3688);const _0x4b7d58=processName(_0x1a3688);_0x3e6bac[_0x3cf56b(0x1fa)][_0x3cf56b(0x1d0)](_0x1a3688)?spectators[_0x4b7d58]=!![]:spectators[_0x4b7d58]=![];if(!proximity)positions[_0x4b7d58]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x3e6bac[_0x3cf56b(0x1ee)][_0x3cf56b(0x1d0)](_0x1a3688))positions[_0x4b7d58]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x3e6bac[_0x3cf56b(0x1fa)][_0x3cf56b(0x1d0)](_0x1a3688)){if(specListen===!![])positions[_0x4b7d58]=_0x3e6bac[_0x3cf56b(0x1af)][_0x4362c8][_0x3cf56b(0x1ab)];else positions[_0x4b7d58]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimentions[_0x4b7d58]=_0x3e6bac[_0x3cf56b(0x1af)][_0x4362c8][_0x3cf56b(0x1a9)];}else _0x3e6bac[_0x3cf56b(0x1af)][_0x4362c8]?.[_0x3cf56b(0x1ab)]?(positions[_0x4b7d58]=_0x3e6bac[_0x3cf56b(0x1af)][_0x4362c8]['position'],yRots[_0x4b7d58]=_0x3e6bac['details'][_0x4362c8]['yRot'],dimentions[_0x4b7d58]=_0x3e6bac[_0x3cf56b(0x1af)][_0x4362c8][_0x3cf56b(0x1a9)]):positions[_0x4b7d58]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x574f35){console[_0x59f11f(0x1e9)](_0x59f11f(0x1c2),_0x574f35);}if(!stop_roop)setTimeout(()=>handleWorld(_0xa90ed6),0x64);}async function connectToRelayServer(_0x2c0758){const _0x14a57e=_0x406bb8,_0x5092a9=_0x2c0758==='mc',_0x11d8b1=_0x5092a9?_0x14a57e(0x1ad):'[VC\x20Relay]';try{const _0x275002=await fetch(_0x14a57e(0x1cd)+RELAY_SERVER_DOMAIN+_0x14a57e(0x1d3)),_0x208a16=await _0x275002[_0x14a57e(0x216)](),_0x3a1577=_0x208a16['roomId'];if(!_0x5092a9)roomId=_0x3a1577;console[_0x14a57e(0x204)](_0x14a57e(0x1ec));_0x5092a9?(server_log_info('Minecraftから以下のコマンドで接続してください:'),server_log_info(_0x14a57e(0x1bf)),server_log_info(_0x14a57e(0x21e)+RELAY_SERVER_DOMAIN+_0x14a57e(0x1e6)+_0x3a1577)):(useRelay=!![],vc_connected=!![],server_log_info(_0x14a57e(0x1a5)+_0x3a1577),server_log_info(_0x14a57e(0x1f2)),server_log_info(_0x14a57e(0x1c5)),server_log_info(_0x14a57e(0x1d5)+_0x3a1577));console[_0x14a57e(0x204)]('=======================================================\x0a');const _0x432773=new WebSocket(_0x14a57e(0x1f1)+RELAY_SERVER_DOMAIN+_0x14a57e(0x1e6)+_0x3a1577+_0x14a57e(0x21a));if(!_0x5092a9)relayWs=_0x432773;_0x432773['on'](_0x14a57e(0x1f4),()=>console[_0x14a57e(0x204)](_0x11d8b1+'\x20Relay\x20server\x20connected\x20(ID:\x20'+_0x3a1577+')')),_0x432773['on'](_0x14a57e(0x1f8),()=>console[_0x14a57e(0x204)](_0x11d8b1+_0x14a57e(0x227)+_0x3a1577+')')),_0x432773['on'](_0x14a57e(0x1e9),_0x3b8c18=>console[_0x14a57e(0x1e9)](_0x11d8b1+_0x14a57e(0x1cb),_0x3b8c18)),_0x5092a9?setupMcRelayListeners(_0x432773):setupVcRelayListeners(_0x432773);}catch(_0x43356b){console[_0x14a57e(0x1e9)](_0x11d8b1+_0x14a57e(0x19b),_0x43356b);}}function setupVcRelayListeners(_0x44ba23){const _0xfaf1b9=_0x406bb8;_0x44ba23['on'](_0xfaf1b9(0x1fb),async _0x30d47f=>{const _0x44c79=_0xfaf1b9;try{const _0x37488f=JSON[_0x44c79(0x212)](_0x30d47f[_0x44c79(0x202)]());if(mainWorld&&_0x37488f[_0x44c79(0x197)]===_0x44c79(0x1f3)&&typeof _0x37488f['value']===_0x44c79(0x209)){const _0xb9a3e8=await mainWorld[_0x44c79(0x1da)](_0x37488f[_0x44c79(0x200)]);_0x44ba23[_0x44c79(0x22e)](JSON[_0x44c79(0x217)]({'type':_0x44c79(0x1c6),'payload':_0xb9a3e8}));}}catch(_0x325a98){console[_0x44c79(0x1e9)]('[VC\x20Relay]\x20メッセージ処理エラー:',_0x325a98);}});}function setupMcRelayListeners(_0x3c3c32){const _0x160613=_0x406bb8;let _0x159081;_0x3c3c32['on'](_0x160613(0x1fb),_0x3db8a3=>{const _0x93ae5e=_0x160613;try{const _0x292499=JSON[_0x93ae5e(0x212)](_0x3db8a3[_0x93ae5e(0x202)]());if(_0x292499['type']==='partner_connected'){console[_0x93ae5e(0x204)](_0x93ae5e(0x208)),_0x159081=new WebSocket(_0x93ae5e(0x1f7)+port),_0x159081['on'](_0x93ae5e(0x1f4),()=>console['log']('[MC\x20Relay]\x20ローカルのsocket-beに接続成功。')),_0x159081['on']('message',_0x26d43f=>_0x3c3c32[_0x93ae5e(0x196)]===WebSocket[_0x93ae5e(0x1fc)]&&_0x3c3c32[_0x93ae5e(0x22e)](_0x26d43f)),_0x159081['on'](_0x93ae5e(0x1f8),()=>_0x3c3c32[_0x93ae5e(0x196)]===WebSocket[_0x93ae5e(0x1fc)]&&_0x3c3c32[_0x93ae5e(0x1f8)]()),_0x159081['on'](_0x93ae5e(0x1e9),_0x6ebb34=>console['error'](_0x93ae5e(0x21c),_0x6ebb34[_0x93ae5e(0x1fb)]));return;}}catch(_0x216f83){}_0x159081?.[_0x93ae5e(0x196)]===WebSocket[_0x93ae5e(0x1fc)]&&_0x159081[_0x93ae5e(0x22e)](_0x3db8a3);}),_0x3c3c32['on']('close',()=>_0x159081?.[_0x160613(0x1f8)]());}async function main(){const _0x3891b7=_0x406bb8;port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x3891b7(0x1c9)+port);const _0x271440=new Server({'port':port,'disableEncryption':!![],'timezone':'Asia/Tokyo'}),_0x4f7e4c=(_0x584e3f,_0x5c89a5)=>{const _0x419dae=_0x3891b7;try{let _0x1c4a1e=fs[_0x419dae(0x1e8)](configPath,_0x419dae(0x1c8));const _0xd97ced=new RegExp('(\x22'+_0x584e3f+_0x419dae(0x207)),_0x4711c9=typeof _0x5c89a5===_0x419dae(0x209)?'\x22'+_0x5c89a5+'\x22':_0x5c89a5,_0x1625d1=_0x1c4a1e[_0x419dae(0x1d8)](_0xd97ced,'$1'+_0x4711c9);_0x1625d1!==_0x1c4a1e&&fs[_0x419dae(0x22c)](configPath,_0x1625d1,_0x419dae(0x1c8));}catch(_0x4ab583){console[_0x419dae(0x1e9)](_0x419dae(0x203),_0x4ab583);}},_0x3e4ecd=(_0x2edbe2,_0x2dbee9,_0x356399)=>async(_0x180079,_0x58deef,_0x4e2a23)=>{const _0x52352c=_0x3891b7;if(_0x58deef[_0x52352c(0x229)]!==_0x180079['localPlayer']['name'])return;if(_0x4e2a23[0x0]!==_0x52352c(0x19c)&&_0x4e2a23[0x0]!=='false')return;const _0x13c729=_0x4e2a23[0x0]==='true';if(_0x2edbe2===_0x52352c(0x1d7))password=_0x13c729;else{if(_0x2edbe2===_0x52352c(0x1b9))proximity=_0x13c729;else{if(_0x2edbe2==='spectator')spectator=_0x13c729;else{if(_0x2edbe2==='specListen')specListen=_0x13c729;else{if(_0x2edbe2==='specDim')specDim=_0x13c729;}}}}_0x4f7e4c(_0x2edbe2,_0x13c729),Object['assign'](global,{[_0x2edbe2]:_0x13c729});const _0x49a5fe=lang==='ja'?_0x13c729?_0x2dbee9[_0x52352c(0x1a3)]:_0x2dbee9[_0x52352c(0x1eb)]:_0x13c729?_0x356399[_0x52352c(0x1a3)]:_0x356399[_0x52352c(0x1eb)];await _0x180079[_0x52352c(0x1bb)](_0x49a5fe);},_0x175dca={'!dis':async(_0x24c0fd,_0x147ec9,_0x5d64db)=>{const _0x982c0e=_0x3891b7;try{if(_0x147ec9[_0x982c0e(0x229)]!==_0x24c0fd[_0x982c0e(0x1dc)][_0x982c0e(0x229)])return;const _0x25322e=Number(_0x5d64db[0x0]);if(!isNaN(_0x25322e)){distance=_0x25322e,_0x4f7e4c(_0x982c0e(0x1ac),_0x25322e);const _0x29ec9c=lang==='ja'?_0x982c0e(0x19f)+distance+_0x982c0e(0x223):_0x982c0e(0x231)+distance;await _0x24c0fd[_0x982c0e(0x1bb)](_0x29ec9c);}}catch(_0x2cefd2){}},'!name':async(_0x444bbc,_0x4933a6)=>{const _0x1803e3=_0x3891b7;try{const _0x4c1241=processName(_0x4933a6[_0x1803e3(0x229)]),_0xc05ea0=_0x1803e3(0x1dd)+roomId+_0x1803e3(0x20c)+_0x4c1241+'です',_0xe264c5=_0x1803e3(0x1e7)+roomId+_0x1803e3(0x210)+_0x4c1241;await _0x4933a6[_0x1803e3(0x1bb)](lang==='ja'?_0xc05ea0:_0xe264c5);if(password){!passwords[_0x4c1241]&&(passwords[_0x4c1241]=Math['floor'](0x3e8+Math[_0x1803e3(0x1cf)]()*0x2328)['toString']());const _0x310005=lang==='ja'?'パスワードは'+passwords[_0x4c1241]+'です':_0x1803e3(0x1f9)+passwords[_0x4c1241];await _0x4933a6[_0x1803e3(0x1bb)](_0x310005);}}catch(_0x1c26b9){}},'!password':_0x3e4ecd(_0x3891b7(0x1d7),{'enabled':'パスワードを有効にしました','disabled':'パスワードを無効にしました'},{'enabled':_0x3891b7(0x1e2),'disabled':_0x3891b7(0x22b)}),'!pvc':_0x3e4ecd(_0x3891b7(0x1b9),{'enabled':'近接vcを有効にしました','disabled':_0x3891b7(0x1d4)},{'enabled':_0x3891b7(0x20e),'disabled':_0x3891b7(0x19e)}),'!spectator':_0x3e4ecd('spectator',{'enabled':_0x3891b7(0x19a),'disabled':_0x3891b7(0x1e0)},{'enabled':'Spectator\x20and\x20VC\x20separated','disabled':_0x3891b7(0x1e3)}),'!specListen':_0x3e4ecd(_0x3891b7(0x230),{'enable':'スペクテイターが他モードプレイヤーの会話を聞けるようになました','disable':_0x3891b7(0x220)},{'enable':_0x3891b7(0x1a6),'disable':_0x3891b7(0x20a)}),'!specDim':_0x3e4ecd('specDim',{'enable':_0x3891b7(0x1db),'disable':'スペクテイター同士の会話を共通にしました'},{'enable':_0x3891b7(0x1be),'disable':_0x3891b7(0x19d)}),'!lang':async(_0x4508cb,_0x20b485,_0x3b84ae)=>{const _0x24fa6a=_0x3891b7;try{if(_0x20b485['name']!==_0x4508cb[_0x24fa6a(0x1dc)][_0x24fa6a(0x229)])return;const _0x4ae120=_0x3b84ae[0x0]==='ja'?'ja':'en';lang=_0x4ae120,_0x4f7e4c('lang',_0x4ae120);const _0x479a36=_0x4ae120==='ja'?'<近接VC>言語を日本語に設定しました':'<Proximity\x20VC>Language\x20set\x20to\x20English';await _0x4508cb[_0x24fa6a(0x1bb)](_0x479a36);}catch(_0x2b187f){}},'!help':async(_0x186f9f,_0x54ee75)=>{const _0x28a945=_0x3891b7;try{await _0x54ee75[_0x28a945(0x1bb)]('--------------------');if(lang=='ja'){await _0x54ee75[_0x28a945(0x1bb)](_0x28a945(0x1f0));const _0x557008=_0x186f9f[_0x28a945(0x1dc)][_0x28a945(0x229)];_0x54ee75[_0x28a945(0x229)]==_0x557008&&await _0x54ee75[_0x28a945(0x1bb)]('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x54ee75[_0x28a945(0x1bb)](_0x28a945(0x1b2));const _0x539a2c=_0x186f9f[_0x28a945(0x1dc)]['name'];_0x54ee75['name']==_0x539a2c&&await _0x54ee75[_0x28a945(0x1bb)](_0x28a945(0x1c4));}await _0x54ee75['sendMessage'](_0x28a945(0x214));}catch(_0x22512a){}}};_0x271440['on'](ServerEvent['PlayerChat'],async({sender:_0x268591,message:_0x5cd17b,world:_0x4feb0f})=>{const _0x46acea=_0x3891b7,[_0x2908bc,..._0xb90144]=_0x5cd17b[_0x46acea(0x218)]('\x20');if(_0x175dca[_0x2908bc])await _0x175dca[_0x2908bc](_0x4feb0f,_0x268591,_0xb90144);}),_0x271440['on'](ServerEvent[_0x3891b7(0x1a2)],()=>setupWebSocketServer()),_0x271440['on'](ServerEvent[_0x3891b7(0x1c1)],async({world:_0x41451f})=>{const _0x3d4a30=_0x3891b7;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x41451f,stop_roop=![],server_log_info(_0x3d4a30(0x1ba)+_0x41451f[_0x3d4a30(0x229)]);if(lang=='ja'){let _0x5ae6db='';proximity?_0x5ae6db='有効':_0x5ae6db='無効',_0x41451f[_0x3d4a30(0x1bb)]('接続を開始しました\x0a近接vc：'+_0x5ae6db+_0x3d4a30(0x20d)+distance+_0x3d4a30(0x1bd));}else{let _0x2e71b1='';proximity?_0x2e71b1=_0x3d4a30(0x1a3):_0x2e71b1='disabled',_0x41451f[_0x3d4a30(0x1bb)](_0x3d4a30(0x1a0)+_0x2e71b1+_0x3d4a30(0x224)+distance+_0x3d4a30(0x205));}await handleWorld(_0x41451f);}),_0x271440['on'](ServerEvent[_0x3891b7(0x1f6)],({world:_0x273dba})=>{const _0x3b908e=_0x3891b7;mainWorld=null,stop_roop=!![],server_log_info(_0x3b908e(0x1bc)+_0x273dba[_0x3b908e(0x229)]);}),_0x271440['on'](ServerEvent['PlayerLoad'],async({player:_0x12e039,world:_0x5824d8})=>{const _0x132d48=_0x3891b7;server_log_info(_0x132d48(0x1fd)+_0x12e039[_0x132d48(0x229)]);const _0x5e0a1c=setInterval(async()=>{const _0x525f46=_0x132d48;try{const _0x1c01ab=processName(_0x12e039['name']),_0x2a2cb2=_0x525f46(0x1c3)+roomId+_0x525f46(0x20c)+_0x1c01ab+'です',_0x13b6b0=_0x525f46(0x21f)+roomId+_0x525f46(0x210)+_0x1c01ab;await _0x12e039[_0x525f46(0x1bb)](lang==='ja'?_0x2a2cb2:_0x13b6b0);if(password){!passwords[_0x1c01ab]&&(passwords[_0x1c01ab]=Math['floor'](0x3e8+Math[_0x525f46(0x1cf)]()*0x2328)[_0x525f46(0x202)]());const _0x41973e=lang==='ja'?_0x525f46(0x1b3)+passwords[_0x1c01ab]+'です':'Password\x20is\x20'+passwords[_0x1c01ab];await _0x12e039[_0x525f46(0x1bb)](_0x41973e);}clearInterval(_0x5e0a1c);}catch(_0x3c2d1d){}},0x1f4);}),_0x271440['on'](ServerEvent['PlayerLeave'],({player:_0x480525})=>{const _0x54582c=_0x3891b7;server_log_info(_0x54582c(0x1e1)+_0x480525[_0x54582c(0x229)]),delete positions[processName(_0x480525[_0x54582c(0x229)])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info(_0x3891b7(0x22d)),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
