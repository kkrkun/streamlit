const _0x26e49d=_0x4a48;(function(_0x476d6a,_0x38608a){const _0x464d6a=_0x4a48,_0x521eee=_0x476d6a();while(!![]){try{const _0x51b8c1=-parseInt(_0x464d6a(0xc1))/0x1+-parseInt(_0x464d6a(0x126))/0x2*(parseInt(_0x464d6a(0x111))/0x3)+parseInt(_0x464d6a(0xea))/0x4*(-parseInt(_0x464d6a(0xe4))/0x5)+parseInt(_0x464d6a(0xeb))/0x6*(-parseInt(_0x464d6a(0x129))/0x7)+-parseInt(_0x464d6a(0x136))/0x8+parseInt(_0x464d6a(0x11a))/0x9*(-parseInt(_0x464d6a(0xa6))/0xa)+parseInt(_0x464d6a(0x128))/0xb;if(_0x51b8c1===_0x38608a)break;else _0x521eee['push'](_0x521eee['shift']());}catch(_0xdaea37){_0x521eee['push'](_0x521eee['shift']());}}}(_0x50cf,0xb0a40));function _0x4a48(_0x19d956,_0x7e90c9){const _0x50cf31=_0x50cf();return _0x4a48=function(_0x4a48b2,_0x54c02e){_0x4a48b2=_0x4a48b2-0x88;let _0x6366d3=_0x50cf31[_0x4a48b2];return _0x6366d3;},_0x4a48(_0x19d956,_0x7e90c9);}const {Server,ServerEvent}=require(_0x26e49d(0x12a)),WebSocket=require('ws'),fetch=require(_0x26e49d(0xd1)),wanakana=require(_0x26e49d(0xa5)),fs=require('fs'),JSON5=require(_0x26e49d(0x8a)),getPort=require(_0x26e49d(0xe6)),{Client}=require(_0x26e49d(0x100)),net=require(_0x26e49d(0xba)),express=require('express'),http=require(_0x26e49d(0x139)),path=require(_0x26e49d(0x91)),configPath=_0x26e49d(0xce),config=JSON5[_0x26e49d(0x127)](fs[_0x26e49d(0xca)](configPath,_0x26e49d(0x12b)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimensions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![],streamlit=![],useResetTimer=![];const server_log_info=_0x3fd1b1=>console[_0x26e49d(0x9b)]('\x1b[36m[Info]\x1b[0m\x20'+_0x3fd1b1),server_log_log=_0x2eb6fa=>console[_0x26e49d(0x9b)](_0x26e49d(0x138)+_0x2eb6fa),processName=_0x1bc87d=>wanakana[_0x26e49d(0x124)](_0x1bc87d[_0x26e49d(0x11b)](/ /g,'_'))[_0x26e49d(0x11b)](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0x26e49d(0xe7),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8;let inactivityTimer;const resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{const _0x3187e1=_0x4a48;process[_0x3187e1(0x118)](0x7c);},INACTIVITY_TIMEOUT);},filePath=path[_0x26e49d(0xbd)](__dirname,_0x26e49d(0xf7));fs['existsSync'](filePath)&&(streamlit=!![],resetTimer(),useResetTimer=!![]);function startSshForwarding(_0x106411,_0xa1b246,_0x343c4d){const _0x5dd010=_0x26e49d;if(!_0x106411||!username||!ssh_password)return;const _0xa59f1e=_0x343c4d==='vc',_0x1cdae3=_0xa59f1e?_0x5dd010(0xb0):_0x5dd010(0xac),_0x4be08d={'host':_0x5dd010(0x97),'port':0x16,'username':username,'password':ssh_password},_0x42a59d={'remoteAddr':_0x106411,'remotePort':0x50,'localAddr':_0x5dd010(0x105),'localPort':_0xa1b246},_0x4badc6=new Client();return _0x4badc6['on'](_0x5dd010(0xbf),()=>{const _0x4656d8=_0x5dd010;_0x4badc6['forwardIn'](_0x42a59d['remoteAddr'],_0x42a59d['remotePort'],_0x5d45e3=>{const _0x20bed4=_0x4a48;if(_0x5d45e3)return console[_0x20bed4(0xc9)](_0x1cdae3+_0x20bed4(0xcf)+_0x106411+'):',_0x5d45e3['message']),server_log_info(_0x1cdae3+'中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),connectToRelayServer(_0x343c4d),_0x4badc6[_0x20bed4(0xa3)]();console['log']('\x0a======================================================='),_0xa59f1e?(useRelay=![],vc_connected=!![],server_log_info(_0x20bed4(0xf5)+_0x106411),server_log_info('参加者はこのURLにアクセスしてください:'),server_log_info('Participants\x20should\x20access\x20this\x20URL'),server_log_info(_0x20bed4(0xb8)+_0x106411)):(server_log_info(_0x20bed4(0x12d)),server_log_info(_0x20bed4(0xd0)),server_log_info(_0x20bed4(0xd7)+_0x106411+'.tcpexposer.com')),console[_0x20bed4(0x9b)](_0x20bed4(0xcc));}),_0x4badc6['on'](_0x4656d8(0x12f),(_0x3c5f46,_0x11537)=>{const _0x3a382f=_0x4656d8,_0x5c0590=_0x11537(),_0x579193=net[_0x3a382f(0x90)]({'host':_0x42a59d[_0x3a382f(0xcb)],'port':_0x42a59d['localPort']});_0x579193['on'](_0x3a382f(0x11c),()=>_0x5c0590[_0x3a382f(0xb4)](_0x579193)['pipe'](_0x5c0590)),_0x579193['on'](_0x3a382f(0xc9),_0x134372=>{const _0x109680=_0x3a382f;console[_0x109680(0xc9)](_0x109680(0x13a)+_0x106411+'):',_0x134372['message']),_0x5c0590[_0x109680(0xe3)]();}),_0x5c0590['on'](_0x3a382f(0xe3),()=>_0x579193['end']());});})['on'](_0x5dd010(0xc9),_0x2139b6=>{const _0x2a897d=_0x5dd010;console[_0x2a897d(0xc9)](_0x2a897d(0xf4)+_0x106411+'):',_0x2139b6[_0x2a897d(0x93)]),server_log_info(_0x1cdae3+'中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),connectToRelayServer(_0x343c4d);}),_0x4badc6[_0x5dd010(0x11c)](_0x4be08d),_0x4badc6;}function _0x50cf(){const _0x2f23e3=['OPEN','Participants\x20should\x20access\x20this\x20URL','toString','https://proximity-vc-mcbe.pages.dev?roomid=','players','net','\x0a=======================================================','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','join','send','ready','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','1382645PRljxh','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','localPlayer','Spectator\x20and\x20VC\x20separated','Proximity\x20VC\x20disabled','sendMessage','スペクテイターとVCを分けました','error','readFileSync','localAddr','=======================================================\x0a','https://','./config.json','❌\x20ポートフォワーディング失敗\x20(','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','node-fetch','listen','sender','接続終了:\x20','distance','Changed\x20max\x20distance\x20to\x20','/connect\x20','specDim','Asia/Tokyo','enabled','WorldAdd','[MC\x20Local\x20WS\x20Error]','WebSocket\x20error:','clients','random','type','victim','/connect\x20localhost:','close','115yYnOaJ','writeFileSync','get-port','mcproxvc.tcpexposer.com','readyState','partner_connected','39772eFvzmJ','6qIBzFp','参加:\x20','❌\x20設定ファイルの更新に失敗しました:','correlationId','string','/room/','floor','position','退出:\x20','❌\x20SSH\x20Error\x20(','ROOM\x20ID:\x20','stringify','app.py','all','\x0a!help\x20for\x20command\x20list','testfor\x20@a[m=spectator]','querytarget\x20@e[type=player]','alive','<近接VC>言語を日本語に設定しました','password','?clientType=server_script','ssh2','forEach','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','/create-room','status','localhost','Connection\x20started\x0aProximity\x20voice\x20chat:','パスワードは','Open','dimension','声の最大距離を','\x20Relay\x20server\x20connected\x20(ID:\x20','assign','PlayerChat','ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます','Spectator\x20set\x20to\x20common\x20VC','Password\x20enabled','5319XmyWwG','\x20Relay\x20server\x20disconnected\x20(ID:\x20','name_command','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','disabled','dimensions','ws://127.0.0.1:','exit','WebSocketメッセージの解析に失敗:','1629aDUAWG','replace','connect','spectator','接続を開始しました\x0a近接vc：','<Proximity\x20VC>Language\x20set\x20to\x20English','from','initialization','disconnect_command','\x0aMax\x20distance:','toRomaji','action','244MJFyIK','parse','48551415sZyfyL','2759015kYJtzM','socket-be','utf8','includes','Minecraftから以下のコマンドで接続してください:','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使うゲーマータグを確認できます','tcp\x20connection','Spectator`s\x20VC\x20separated\x20by\x20dimension','value','\x20WebSocket\x20error:','[VC\x20Relay]\x20メッセージ処理エラー:','Password\x20is\x20','Error\x20handling\x20world:','809488yEqqaF','name','\x1b[33m[Log]\x1b[0m\x20','http','ローカル接続エラー\x20(','createServer','json','json5','data_update','yRots','\x0a声の届く距離：','yRot','です\x0aあなたのVCnameは','createConnection','path','--------------------','message','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20GamerTag','specListen','details','tcpexposer.com','lang','\x0aYour\x20VCname\x20is\x20','に変更しました','log','Proximity\x20VC\x20enabled','runCommand','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','Server','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','proximity','end','true','wanakana','75540WYToSB','パスワードを無効にしました','open','world_update','spectators','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','[MC\x20SSH]','近接vcを有効にしました','終了シグナル受信。SSH接続を停止します...','split','[VC\x20SSH]','false','roomId','body','pipe'];_0x50cf=function(){return _0x2f23e3;};return _0x50cf();}async function setupWebSocketServer(){const _0x259289=_0x26e49d;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0x259289(0x9f))]({'port':web_port}),wss['on']('connection',_0x36ee0f=>{const _0x40a987=_0x259289;_0x36ee0f['on']('message',_0x34944e=>{const _0x30c10f=_0x4a48;try{const {userName:_0x55b437,position:_0x24a757}=JSON[_0x30c10f(0x127)](_0x34944e);if(_0x55b437&&_0x24a757)positions[_0x55b437]=_0x24a757;}catch(_0x24955b){console['error'](_0x30c10f(0x119),_0x24955b);}}),_0x36ee0f['on']('error',_0x5bd39f=>console[_0x40a987(0xc9)](_0x40a987(0xdd),_0x5bd39f));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x259289(0x9b)](_0x259289(0xbb)),server_log_info(_0x259289(0x12d)),server_log_info(_0x259289(0xd0)),server_log_info(_0x259289(0xe2)+port),console[_0x259289(0x9b)]('=======================================================\x0a');process['on']('SIGINT',()=>{const _0xb5e0ba=_0x259289;console[_0xb5e0ba(0x9b)](_0xb5e0ba(0xae));if(vcSSHClient)vcSSHClient[_0xb5e0ba(0xa3)]();if(mcSSHClient)mcSSHClient[_0xb5e0ba(0xa3)]();process['exit']();});}function broadcastPositions(){const _0x174039=_0x26e49d,_0x439808=JSON[_0x174039(0xf6)]({'type':_0x174039(0xa9),'dimentions':dimensions,'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimensions':dimensions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x174039(0xe8)]===WebSocket[_0x174039(0xb5)])relayWs[_0x174039(0xbe)](_0x439808);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x174039(0xde)]['forEach'](_0x4666a4=>{const _0x1a6e25=_0x174039;_0x4666a4[_0x1a6e25(0xe8)]===WebSocket[_0x1a6e25(0xb5)]&&_0x4666a4[_0x1a6e25(0xbe)](_0x439808);});}async function handleWorld(_0x52153f){const _0x2dd818=_0x26e49d;try{const _0x1cdc07=Array[_0x2dd818(0x120)](_0x52153f[_0x2dd818(0xb9)]['values'](),_0x30306f=>String(_0x30306f[_0x2dd818(0x137)]));let _0x5085ec={'alive':[],'spectators':[],'details':[]};if(proximity){const [_0x4f2f0a,_0x22a81f,_0x4988bf]=await Promise[_0x2dd818(0xf8)]([_0x52153f[_0x2dd818(0x9d)]('testfor\x20@e[type=player]'),_0x52153f['runCommand'](_0x2dd818(0xfa)),_0x52153f[_0x2dd818(0x9d)](_0x2dd818(0xfb))]);_0x5085ec={'alive':_0x4f2f0a[_0x2dd818(0xe1)]||[],'spectators':_0x22a81f[_0x2dd818(0xe1)]||[],'details':JSON[_0x2dd818(0x127)](_0x4988bf[_0x2dd818(0x96)]||'[]')};}_0x1cdc07[_0x2dd818(0x101)](_0x1c8d17=>{const _0x249b97=_0x2dd818;if(useResetTimer)resetTimer();let _0xa58c91;if(proximity)_0xa58c91=_0x5085ec['alive']['indexOf'](_0x1c8d17);const _0xb18b00=processName(_0x1c8d17);_0x5085ec[_0x249b97(0xaa)][_0x249b97(0x12c)](_0x1c8d17)?spectators[_0xb18b00]=!![]:spectators[_0xb18b00]=![];if(!proximity)positions[_0xb18b00]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x5085ec[_0x249b97(0xfc)][_0x249b97(0x12c)](_0x1c8d17))positions[_0xb18b00]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x5085ec['spectators'][_0x249b97(0x12c)](_0x1c8d17)){if(specListen===!![])positions[_0xb18b00]=_0x5085ec[_0x249b97(0x96)][_0xa58c91][_0x249b97(0xf2)];else positions[_0xb18b00]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimensions[_0xb18b00]=_0x5085ec[_0x249b97(0x96)][_0xa58c91][_0x249b97(0x109)];}else _0x5085ec['details'][_0xa58c91]?.[_0x249b97(0xf2)]?(positions[_0xb18b00]=_0x5085ec['details'][_0xa58c91][_0x249b97(0xf2)],yRots[_0xb18b00]=_0x5085ec['details'][_0xa58c91][_0x249b97(0x8e)],dimensions[_0xb18b00]=_0x5085ec[_0x249b97(0x96)][_0xa58c91][_0x249b97(0x109)]):positions[_0xb18b00]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x169d6f){console[_0x2dd818(0xc9)](_0x2dd818(0x135),_0x169d6f);}if(!stop_roop)setTimeout(()=>handleWorld(_0x52153f),0x64);}async function connectToRelayServer(_0x2d4a61){const _0x195477=_0x26e49d,_0x3233e4=_0x2d4a61==='mc',_0x5b3c20=_0x3233e4?'[MC\x20Relay]':'[VC\x20Relay]';try{const _0xc2b835=await fetch(_0x195477(0xcd)+RELAY_SERVER_DOMAIN+_0x195477(0x103)),_0x579965=await _0xc2b835[_0x195477(0x89)](),_0x22d914=_0x579965[_0x195477(0xb2)];if(!_0x3233e4)roomId=_0x22d914;console[_0x195477(0x9b)](_0x195477(0xbb));_0x3233e4?(resetTimer(),useResetTimer=!![],server_log_info(_0x195477(0x12d)),server_log_info(_0x195477(0xd0)),server_log_info(_0x195477(0xd7)+RELAY_SERVER_DOMAIN+_0x195477(0xf0)+_0x22d914)):(useRelay=!![],vc_connected=!![],server_log_info(_0x195477(0xf5)+_0x22d914),server_log_info('参加者はこのURLにアクセスしてください:'),server_log_info(_0x195477(0xb6)),server_log_info('https://proximity-vc-mcbe.pages.dev?roomid='+_0x22d914));console['log'](_0x195477(0xcc));const _0xf4eb00=new WebSocket('wss://'+RELAY_SERVER_DOMAIN+_0x195477(0xf0)+_0x22d914+_0x195477(0xff));if(!_0x3233e4)relayWs=_0xf4eb00;_0xf4eb00['on'](_0x195477(0xa8),()=>console['log'](_0x5b3c20+_0x195477(0x10b)+_0x22d914+')')),_0xf4eb00['on'](_0x195477(0xe3),()=>console[_0x195477(0x9b)](_0x5b3c20+_0x195477(0x112)+_0x22d914+')')),_0xf4eb00['on'](_0x195477(0xc9),_0x561845=>console['error'](_0x5b3c20+_0x195477(0x132),_0x561845)),_0x3233e4?setupMcRelayListeners(_0xf4eb00):setupVcRelayListeners(_0xf4eb00);}catch(_0x27ea9c){console['error'](_0x5b3c20+'\x20処理中にエラーが発生しました:',_0x27ea9c);}}function setupVcRelayListeners(_0xecf97a){const _0x1e9801=_0x26e49d;_0xecf97a['on'](_0x1e9801(0x93),async _0x366bb5=>{const _0x4703f6=_0x1e9801;try{const _0x1b7e8e=JSON['parse'](_0x366bb5[_0x4703f6(0xb7)]());if(mainWorld&&_0x1b7e8e[_0x4703f6(0x125)]==='run_command'&&typeof _0x1b7e8e[_0x4703f6(0x131)]===_0x4703f6(0xef)){const _0x33a181=await mainWorld[_0x4703f6(0x9d)](_0x1b7e8e[_0x4703f6(0x131)]);_0xecf97a['send'](JSON[_0x4703f6(0xf6)]({'type':'command_result','payload':_0x33a181}));}}catch(_0x2d732c){console[_0x4703f6(0xc9)](_0x4703f6(0x133),_0x2d732c);}});}function name_command(_0xf5e092){const _0x3ee521=_0x26e49d,_0x5211a3=processName(_0xf5e092);!passwords[_0x5211a3]&&(passwords[_0x5211a3]=Math[_0x3ee521(0xf1)](0x3e8+Math[_0x3ee521(0xdf)]()*0x2328)[_0x3ee521(0xb7)]());const _0x5e7b71=lang==='ja'?_0x3ee521(0x107)+passwords[_0x5211a3]+'です':_0x3ee521(0x134)+passwords[_0x5211a3];return _0x5e7b71;}function data_update(_0x21c10d){const _0x12aca3=_0x26e49d;shouldBroadcast=!![];if(useResetTimer)resetTimer();for(const [_0x13c041,_0x59736e]of Object['entries'](_0x21c10d)){switch(_0x13c041){case _0x12aca3(0xe0):continue;case'proximity':_0x59736e!==proximity&&(updateConfig(_0x13c041,_0x59736e),proximity=_0x59736e);break;case'positions':positions=_0x59736e;break;case'distance':_0x59736e!==distance&&(updateConfig(_0x13c041,_0x59736e),distance=_0x59736e);break;case _0x12aca3(0x11d):_0x59736e!==spectator&&(updateConfig(_0x13c041,_0x59736e),spectator=_0x59736e);break;case _0x12aca3(0xaa):spectators=_0x59736e;break;case _0x12aca3(0x95):_0x59736e!==specListen&&(updateConfig(_0x13c041,_0x59736e),specListen=_0x59736e);break;case _0x12aca3(0xd8):_0x59736e!==specDim&&(updateConfig(_0x13c041,_0x59736e),specDim=_0x59736e);break;case _0x12aca3(0x116):dimensions=_0x59736e;break;case _0x12aca3(0x8c):yRots=_0x59736e;break;case _0x12aca3(0xfe):_0x59736e!==password&&(updateConfig(_0x13c041,_0x59736e),password=_0x59736e);case'lang':_0x59736e!==lang&&(updateConfig(_0x13c041,_0x59736e),lang=_0x59736e);break;}}}function setupMcRelayListeners(_0x57410e){const _0x22821a=_0x26e49d;let _0xff6eca;_0x57410e['on']('message',async _0x1b9b6a=>{const _0x11507d=_0x4a48;try{const _0x1c2229=JSON[_0x11507d(0x127)](_0x1b9b6a[_0x11507d(0xb7)]());if(_0x1c2229[_0x11507d(0xe0)]===_0x11507d(0xe9)){console[_0x11507d(0x9b)](_0x11507d(0x9e)),_0xff6eca=new WebSocket(_0x11507d(0x117)+port),_0xff6eca['on'](_0x11507d(0xa8),()=>console[_0x11507d(0x9b)](_0x11507d(0xab))),_0xff6eca['on'](_0x11507d(0x93),_0x26154c=>_0x57410e['readyState']===WebSocket[_0x11507d(0xb5)]&&_0x57410e[_0x11507d(0xbe)](_0x26154c)),_0xff6eca['on'](_0x11507d(0xe3),()=>_0x57410e[_0x11507d(0xe8)]===WebSocket[_0x11507d(0xb5)]&&_0x57410e['close']()),_0xff6eca['on'](_0x11507d(0xc9),_0x2ed279=>console[_0x11507d(0xc9)](_0x11507d(0xdc),_0x2ed279[_0x11507d(0x93)]));return;}else{if(_0x1c2229[_0x11507d(0xe0)]===_0x11507d(0x113))try{const _0x4acd63=name_command(_0x1c2229[_0x11507d(0xd3)]),_0x3e9727={'type':'name_command','message':_0x4acd63,'correlationId':_0x1c2229[_0x11507d(0xee)]};_0x57410e[_0x11507d(0xbe)](JSON['stringify'](_0x3e9727));}catch(_0x5f5df3){console[_0x11507d(0x9b)](_0x5f5df3);}else{if(_0x1c2229['type']===_0x11507d(0x121))try{mc_connected=!![];const _0x5d2044=JSON[_0x11507d(0xf6)]({'type':'initialization','roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang,'correlationId':_0x1c2229[_0x11507d(0xee)]});_0x57410e['send'](_0x5d2044);}catch(_0x74d9fe){console[_0x11507d(0x9b)](_0x74d9fe);}else{if(_0x1c2229[_0x11507d(0xe0)]==='data_update')try{data_update(_0x1c2229);}catch(_0x47f595){console[_0x11507d(0x9b)](_0x47f595);}else _0x1c2229['type']===_0x11507d(0x122)&&process[_0x11507d(0x118)](0x0);}}}}catch(_0x417944){}_0xff6eca?.[_0x11507d(0xe8)]===WebSocket['OPEN']&&_0xff6eca[_0x11507d(0xbe)](_0x1b9b6a);}),_0x57410e['on']('close',()=>_0xff6eca?.[_0x22821a(0xe3)]());}function updateConfig(_0x494e2c,_0x685bac){const _0x3db11b=_0x26e49d;try{let _0x43ca54=fs[_0x3db11b(0xca)](configPath,_0x3db11b(0x12b));const _0x267814=new RegExp('(\x22'+_0x494e2c+_0x3db11b(0xa0)),_0xe319fc=typeof _0x685bac==='string'?'\x22'+_0x685bac+'\x22':_0x685bac,_0x4fe8ad=_0x43ca54[_0x3db11b(0x11b)](_0x267814,'$1'+_0xe319fc);_0x4fe8ad!==_0x43ca54&&fs[_0x3db11b(0xe5)](configPath,_0x4fe8ad,_0x3db11b(0x12b));}catch(_0x286ea5){console[_0x3db11b(0xc9)](_0x3db11b(0xed),_0x286ea5);}};async function main(){const _0x3eea8d=_0x26e49d;port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info('socket-beサーバーのポート:\x20'+port);let _0x83003c;if(!streamlit){const _0x27a18e=express(),_0x58c381=http[_0x3eea8d(0x88)](_0x27a18e);_0x58c381[_0x3eea8d(0xd2)](port),_0x83003c=new Server({'webSocketOptions':{'server':_0x58c381},'timezone':_0x3eea8d(0xd9),'disableEncryption':!![]}),_0x27a18e['use'](express['json']()),_0x27a18e['post']('/',(_0x574083,_0x10614b)=>{const _0x73a024=_0x3eea8d;if(_0x574083['body'][_0x73a024(0xe0)]===_0x73a024(0x113)){const _0x511e1a=name_command(_0x574083[_0x73a024(0xb3)]['sender']),_0x3003ef={'type':_0x73a024(0x113),'message':_0x511e1a};_0x10614b['status'](0xc8)[_0x73a024(0x89)](_0x3003ef);}else{if(_0x574083[_0x73a024(0xb3)][_0x73a024(0xe0)]===_0x73a024(0x121)){mc_connected=!![];const _0x434c55={'type':_0x73a024(0x121),'roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang};_0x10614b['status'](0xc8)[_0x73a024(0x89)](_0x434c55);}else{if(_0x574083[_0x73a024(0xb3)][_0x73a024(0xe0)]===_0x73a024(0x8b))data_update(_0x574083['body']),_0x10614b[_0x73a024(0x104)](0xc8)['json']({'success':!![]});else _0x574083[_0x73a024(0xb3)]['type']===_0x73a024(0x122)&&process['exit'](0x0);}}});}else _0x83003c=new Server({'port':port,'timezone':_0x3eea8d(0xd9),'disableEncryption':!![]});const _0x5f93ac=(_0x2ac5ca,_0x110472,_0x35174c)=>async(_0x502891,_0x1887f6,_0x2afac3)=>{const _0x2aa67b=_0x3eea8d;if(_0x1887f6['name']!==_0x502891[_0x2aa67b(0xc4)][_0x2aa67b(0x137)])return;if(_0x2afac3[0x0]!=='true'&&_0x2afac3[0x0]!==_0x2aa67b(0xb1))return;const _0x5a1caf=_0x2afac3[0x0]===_0x2aa67b(0xa4);if(_0x2ac5ca===_0x2aa67b(0xfe))password=_0x5a1caf;else{if(_0x2ac5ca==='proximity')proximity=_0x5a1caf;else{if(_0x2ac5ca===_0x2aa67b(0x11d))spectator=_0x5a1caf;else{if(_0x2ac5ca===_0x2aa67b(0x95))specListen=_0x5a1caf;else{if(_0x2ac5ca===_0x2aa67b(0xd8))specDim=_0x5a1caf;}}}}updateConfig(_0x2ac5ca,_0x5a1caf),Object[_0x2aa67b(0x10c)](global,{[_0x2ac5ca]:_0x5a1caf});const _0x1eee2a=lang==='ja'?_0x5a1caf?_0x110472[_0x2aa67b(0xda)]:_0x110472[_0x2aa67b(0x115)]:_0x5a1caf?_0x35174c[_0x2aa67b(0xda)]:_0x35174c[_0x2aa67b(0x115)];await _0x502891[_0x2aa67b(0xc7)](_0x1eee2a);},_0x5bff75={'!dis':async(_0x1ed13f,_0x25ea3c,_0x1d0ef4)=>{const _0x36d91d=_0x3eea8d;try{if(_0x25ea3c[_0x36d91d(0x137)]!==_0x1ed13f[_0x36d91d(0xc4)][_0x36d91d(0x137)])return;const _0x2dc60a=Number(_0x1d0ef4[0x0]);if(!isNaN(_0x2dc60a)){distance=_0x2dc60a,updateConfig(_0x36d91d(0xd5),_0x2dc60a);const _0x3b66d8=lang==='ja'?_0x36d91d(0x10a)+distance+_0x36d91d(0x9a):_0x36d91d(0xd6)+distance;await _0x1ed13f['sendMessage'](_0x3b66d8);}}catch(_0x4930bb){}},'!name':async(_0x30ebe6,_0x2d849c)=>{const _0x211e95=_0x3eea8d;try{const _0x9b9ca5=processName(_0x2d849c[_0x211e95(0x137)]),_0x3a6604=_0x211e95(0xc0)+roomId+_0x211e95(0x8f)+_0x9b9ca5+'です',_0x28a7c9=_0x211e95(0x102)+roomId+_0x211e95(0x99)+_0x9b9ca5;await _0x2d849c[_0x211e95(0xc7)](lang==='ja'?_0x3a6604:_0x28a7c9);if(password){!passwords[_0x9b9ca5]&&(passwords[_0x9b9ca5]=Math[_0x211e95(0xf1)](0x3e8+Math['random']()*0x2328)[_0x211e95(0xb7)]());const _0x46372a=lang==='ja'?_0x211e95(0x107)+passwords[_0x9b9ca5]+'です':_0x211e95(0x134)+passwords[_0x9b9ca5];await _0x2d849c[_0x211e95(0xc7)](_0x46372a);}}catch(_0x441594){}},'!password':_0x5f93ac(_0x3eea8d(0xfe),{'enabled':'パスワードを有効にしました','disabled':_0x3eea8d(0xa7)},{'enabled':_0x3eea8d(0x110),'disabled':'Password\x20disabled'}),'!pvc':_0x5f93ac(_0x3eea8d(0xa2),{'enabled':_0x3eea8d(0xad),'disabled':'近接vcを無効にしました'},{'enabled':_0x3eea8d(0x9c),'disabled':_0x3eea8d(0xc6)}),'!spectator':_0x5f93ac(_0x3eea8d(0x11d),{'enabled':_0x3eea8d(0xc8),'disabled':'スペクテイターを共通のVCにしました'},{'enabled':_0x3eea8d(0xc5),'disabled':_0x3eea8d(0x10f)}),'!specListen':_0x5f93ac(_0x3eea8d(0x95),{'enable':'スペクテイターが他モードプレイヤーの会話を聞けるようになました','disable':'スペクテイターが他モードプレイヤーの会話を聞けなくなりました'},{'enable':_0x3eea8d(0xc2),'disable':'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players'}),'!specDim':_0x5f93ac(_0x3eea8d(0xd8),{'enable':'\x20スペクテイター同士の会話をディメンションごとに分けました','disable':'スペクテイター同士の会話を共通にしました'},{'enable':_0x3eea8d(0x130),'disable':_0x3eea8d(0xbc)}),'!lang':async(_0xe3a5bd,_0x4487ac,_0x5743d7)=>{const _0x244ab0=_0x3eea8d;try{if(_0x4487ac['name']!==_0xe3a5bd[_0x244ab0(0xc4)]['name'])return;const _0x1a14e4=_0x5743d7[0x0]==='ja'?'ja':'en';lang=_0x1a14e4,updateConfig(_0x244ab0(0x98),_0x1a14e4);const _0xeaa4ad=_0x1a14e4==='ja'?_0x244ab0(0xfd):_0x244ab0(0x11f);await _0xe3a5bd['sendMessage'](_0xeaa4ad);}catch(_0x2e32e2){}},'!help':async(_0x2902c0,_0x53e441)=>{const _0x5b3d7d=_0x3eea8d;try{await _0x53e441['sendMessage'](_0x5b3d7d(0x92));if(lang=='ja'){await _0x53e441[_0x5b3d7d(0xc7)](_0x5b3d7d(0x12e));const _0xdd0f40=_0x2902c0[_0x5b3d7d(0xc4)][_0x5b3d7d(0x137)];_0x53e441[_0x5b3d7d(0x137)]==_0xdd0f40&&await _0x53e441[_0x5b3d7d(0xc7)](_0x5b3d7d(0x10e));}else{await _0x53e441[_0x5b3d7d(0xc7)](_0x5b3d7d(0x94));const _0x5aff1a=_0x2902c0[_0x5b3d7d(0xc4)][_0x5b3d7d(0x137)];_0x53e441[_0x5b3d7d(0x137)]==_0x5aff1a&&await _0x53e441['sendMessage'](_0x5b3d7d(0x114));}await _0x53e441[_0x5b3d7d(0xc7)](_0x5b3d7d(0x92));}catch(_0x1686a8){}}};_0x83003c['on'](ServerEvent[_0x3eea8d(0x10d)],async({sender:_0x55377c,message:_0x5c126b,world:_0x8b99e9})=>{const _0x12396a=_0x3eea8d,[_0x5b5cdf,..._0x5eb459]=_0x5c126b[_0x12396a(0xaf)]('\x20');if(_0x5bff75[_0x5b5cdf])await _0x5bff75[_0x5b5cdf](_0x8b99e9,_0x55377c,_0x5eb459);}),_0x83003c['on'](ServerEvent[_0x3eea8d(0x108)],()=>setupWebSocketServer()),_0x83003c['on'](ServerEvent[_0x3eea8d(0xdb)],async({world:_0x1449b4})=>{const _0x1a8981=_0x3eea8d;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x1449b4,stop_roop=![],server_log_info('接続開始:\x20'+_0x1449b4[_0x1a8981(0x137)]);if(lang=='ja'){let _0x4c346c='';proximity?_0x4c346c='有効':_0x4c346c='無効',_0x1449b4[_0x1a8981(0xc7)](_0x1a8981(0x11e)+_0x4c346c+_0x1a8981(0x8d)+distance+'\x0a!help\x20でコマンド一覧を確認できます');}else{let _0x37bba0='';proximity?_0x37bba0=_0x1a8981(0xda):_0x37bba0=_0x1a8981(0x115),_0x1449b4[_0x1a8981(0xc7)](_0x1a8981(0x106)+_0x37bba0+_0x1a8981(0x123)+distance+_0x1a8981(0xf9));}await handleWorld(_0x1449b4);}),_0x83003c['on'](ServerEvent['WorldRemove'],({world:_0x4d4655})=>{const _0x5e1a14=_0x3eea8d;mainWorld=null,stop_roop=!![],server_log_info(_0x5e1a14(0xd4)+_0x4d4655[_0x5e1a14(0x137)]);}),_0x83003c['on'](ServerEvent['PlayerLoad'],async({player:_0x101017,world:_0x5b9dae})=>{const _0x4d0903=_0x3eea8d;server_log_info(_0x4d0903(0xec)+_0x101017[_0x4d0903(0x137)]);const _0x4ab043=setInterval(async()=>{const _0x40f3e5=_0x4d0903;try{const _0x47fc30=processName(_0x101017[_0x40f3e5(0x137)]),_0x3e2277=_0x40f3e5(0xa1)+roomId+'です\x0aあなたのVCnameは'+_0x47fc30+'です',_0x57109a=_0x40f3e5(0xc3)+roomId+'\x0aYour\x20VCname\x20is\x20'+_0x47fc30;await _0x101017[_0x40f3e5(0xc7)](lang==='ja'?_0x3e2277:_0x57109a);if(password){!passwords[_0x47fc30]&&(passwords[_0x47fc30]=Math[_0x40f3e5(0xf1)](0x3e8+Math['random']()*0x2328)['toString']());const _0x4d17e=lang==='ja'?_0x40f3e5(0x107)+passwords[_0x47fc30]+'です':_0x40f3e5(0x134)+passwords[_0x47fc30];await _0x101017[_0x40f3e5(0xc7)](_0x4d17e);}clearInterval(_0x4ab043);}catch(_0x4562fb){}},0x1f4);}),_0x83003c['on'](ServerEvent['PlayerLeave'],({player:_0x34d83c,world:_0x42c04a})=>{const _0x1e7a80=_0x3eea8d;server_log_info(_0x1e7a80(0xf3)+_0x34d83c[_0x1e7a80(0x137)]);const _0x1e6a02=_0x42c04a[_0x1e7a80(0xc4)]['name'];if(_0x34d83c[_0x1e7a80(0x137)]===_0x1e6a02)process[_0x1e7a80(0x118)](0x0);delete positions[processName(_0x34d83c['name'])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info('中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
