function _0x358e(_0x1e03ae,_0x5e76e7){const _0x129569=_0x1295();return _0x358e=function(_0x358e75,_0x6cda19){_0x358e75=_0x358e75-0x1bc;let _0x26745a=_0x129569[_0x358e75];return _0x26745a;},_0x358e(_0x1e03ae,_0x5e76e7);}const _0xec48e=_0x358e;(function(_0x2292c8,_0x572e42){const _0xdefdce=_0x358e,_0x1199f3=_0x2292c8();while(!![]){try{const _0x552155=-parseInt(_0xdefdce(0x1df))/0x1+parseInt(_0xdefdce(0x25c))/0x2+-parseInt(_0xdefdce(0x221))/0x3*(-parseInt(_0xdefdce(0x1da))/0x4)+parseInt(_0xdefdce(0x1d7))/0x5+-parseInt(_0xdefdce(0x22f))/0x6*(parseInt(_0xdefdce(0x1eb))/0x7)+-parseInt(_0xdefdce(0x1c3))/0x8+-parseInt(_0xdefdce(0x225))/0x9*(-parseInt(_0xdefdce(0x1c2))/0xa);if(_0x552155===_0x572e42)break;else _0x1199f3['push'](_0x1199f3['shift']());}catch(_0x3a3086){_0x1199f3['push'](_0x1199f3['shift']());}}}(_0x1295,0x2743d));const {Server,ServerEvent}=require(_0xec48e(0x236)),WebSocket=require('ws'),fetch=require(_0xec48e(0x248)),wanakana=require(_0xec48e(0x239)),fs=require('fs'),JSON5=require('json5'),getPort=require(_0xec48e(0x1d3)),{Client}=require(_0xec48e(0x1e7)),net=require(_0xec48e(0x218)),express=require('express'),http=require(_0xec48e(0x206)),configPath='./config.json',config=JSON5[_0xec48e(0x24a)](fs['readFileSync'](configPath,_0xec48e(0x226)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimensions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![];const server_log_info=_0x230dad=>console[_0xec48e(0x22d)]('\x1b[36m[Info]\x1b[0m\x20'+_0x230dad),server_log_log=_0xd86ee7=>console['log'](_0xec48e(0x263)+_0xd86ee7),processName=_0x2c1f98=>wanakana[_0xec48e(0x23b)](_0x2c1f98['replace'](/ /g,'_'))['replace'](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0xec48e(0x257),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8;let inactivityTimer;const resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{const _0x1db635=_0x358e;process[_0x1db635(0x1fe)](0x7c);},INACTIVITY_TIMEOUT);};function _0x1295(){const _0xf12fc8=['です\x0aあなたのVCnameは','\x20Relay\x20server\x20disconnected\x20(ID:\x20','❌\x20設定ファイルの更新に失敗しました:','スペクテイターを共通のVCにしました','Password\x20disabled','Proximity\x20VC\x20disabled','PlayerLoad','name_command','<Proximity\x20VC>Language\x20set\x20to\x20English','get-port','接続を開始しました\x0a近接vc：','message','replace','19580vBpmYQ','tcp\x20connection','roomId','88824iFSJxX','disabled','Connection\x20started\x0aProximity\x20voice\x20chat:','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','type','88229EdPOXM','action','socket-beサーバーのポート:\x20','\x0a=======================================================','value','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','initialization','runCommand','ssh2','querytarget\x20@e[type=player]','listen','positions','989842BYzVpS','localPlayer','spectators','dimension','enabled','victim','lang','localAddr','スペクテイターとVCを分けました','\x0a!help\x20for\x20command\x20list','data_update','name','近接vcを有効にしました','パスワードは','参加:\x20','スペクテイターが他モードプレイヤーの会話を聞けるようになました','Password\x20enabled','forwardIn','接続開始:\x20','exit','distance','floor','players','localhost','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','sendMessage','tcpexposer.com','http','Spectator`s\x20VC\x20separated\x20by\x20dimension','Participants\x20should\x20access\x20this\x20URL','password','use','specDim','world_update','pipe','退出:\x20','true','Spectator\x20set\x20to\x20common\x20VC','ready','ROOM\x20ID:\x20','\x0a声の届く距離：','values','Asia/Tokyo','status','spectator','net','toString','proximity','testfor\x20@e[type=player]','alive','Proximity\x20VC\x20enabled','remotePort','sender','Password\x20is\x20','15wqeKHk','send','/room/','close','135UjmXQP','utf8','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','[MC\x20Relay]','\x20Relay\x20server\x20connected\x20(ID:\x20','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','OPEN','[VC\x20Relay]','log','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','6LzbgZF','details','stringify','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','--------------------','position','correlationId','socket-be','includes','SIGINT','wanakana','createServer','toRomaji','command_result','localPort','body','readyState','/connect\x20','Open','PlayerLeave','yRot','wss://','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使うゲーマータグを確認できます','clients','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','node-fetch','error','parse','yRots','ws://127.0.0.1:','[MC\x20SSH]','readFileSync','\x0aYour\x20VCname\x20is\x20','indexOf','ローカル接続エラー\x20(','WorldRemove','specListen','writeFileSync','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','end','mcproxvc.tcpexposer.com','Minecraftから以下のコマンドで接続してください:','json','WebSocket\x20error:','接続終了:\x20','550528zzsHKz','参加者はこのURLにアクセスしてください:','https://proximity-vc-mcbe.pages.dev?roomid=','open','random','PlayerChat','/create-room','\x1b[33m[Log]\x1b[0m\x20','Changed\x20max\x20distance\x20to\x20','connect','post','.tcpexposer.com','\x20スペクテイター同士の会話をディメンションごとに分けました','split','?clientType=server_script','157150prpmKu','1883768hilVVo','パスワードを無効にしました','=======================================================\x0a','assign','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','string','WorldAdd'];_0x1295=function(){return _0xf12fc8;};return _0x1295();}function startSshForwarding(_0x581164,_0x351b14,_0x149b56){const _0xb48977=_0xec48e;if(!_0x581164||!username||!ssh_password)return;const _0x24c68d=_0x149b56==='vc',_0x169eb1=_0x24c68d?'[VC\x20SSH]':_0xb48977(0x24d),_0x1b14f7={'host':_0xb48977(0x205),'port':0x16,'username':username,'password':ssh_password},_0x5114c9={'remoteAddr':_0x581164,'remotePort':0x50,'localAddr':_0xb48977(0x202),'localPort':_0x351b14},_0x36bf3b=new Client();return _0x36bf3b['on'](_0xb48977(0x211),()=>{const _0x358141=_0xb48977;_0x36bf3b[_0x358141(0x1fc)](_0x5114c9['remoteAddr'],_0x5114c9[_0x358141(0x21e)],_0x2d6f14=>{const _0x258ae6=_0x358141;if(_0x2d6f14)return console['error'](_0x169eb1+'❌\x20ポートフォワーディング失敗\x20('+_0x581164+'):',_0x2d6f14[_0x258ae6(0x1d5)]),server_log_info(_0x169eb1+_0x258ae6(0x247)),connectToRelayServer(_0x149b56),_0x36bf3b[_0x258ae6(0x256)]();console[_0x258ae6(0x22d)]('\x0a======================================================='),_0x24c68d?(useRelay=![],vc_connected=!![],server_log_info('ROOM\x20ID:\x20'+_0x581164),server_log_info('参加者はこのURLにアクセスしてください:'),server_log_info(_0x258ae6(0x208)),server_log_info(_0x258ae6(0x25e)+_0x581164)):(server_log_info(_0x258ae6(0x258)),server_log_info(_0x258ae6(0x255)),server_log_info(_0x258ae6(0x240)+_0x581164+_0x258ae6(0x1be))),console['log'](_0x258ae6(0x1c5));}),_0x36bf3b['on'](_0x358141(0x1d8),(_0xa6f120,_0x45e4f7)=>{const _0x5ecf46=_0x358141,_0x4f2d45=_0x45e4f7(),_0x58a0aa=net['createConnection']({'host':_0x5114c9[_0x5ecf46(0x1f2)],'port':_0x5114c9[_0x5ecf46(0x23d)]});_0x58a0aa['on']('connect',()=>_0x4f2d45[_0x5ecf46(0x20d)](_0x58a0aa)[_0x5ecf46(0x20d)](_0x4f2d45)),_0x58a0aa['on'](_0x5ecf46(0x249),_0xe779da=>{const _0x205cdd=_0x5ecf46;console[_0x205cdd(0x249)](_0x205cdd(0x251)+_0x581164+'):',_0xe779da['message']),_0x4f2d45['close']();}),_0x4f2d45['on'](_0x5ecf46(0x224),()=>_0x58a0aa[_0x5ecf46(0x256)]());});})['on']('error',_0x1bfd4e=>{const _0x5c1534=_0xb48977;console[_0x5c1534(0x249)]('❌\x20SSH\x20Error\x20('+_0x581164+'):',_0x1bfd4e['message']),server_log_info(_0x169eb1+_0x5c1534(0x247)),connectToRelayServer(_0x149b56);}),_0x36bf3b[_0xb48977(0x1bc)](_0x1b14f7),_0x36bf3b;}async function setupWebSocketServer(){const _0x68fac=_0xec48e;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket['Server']({'port':web_port}),wss['on']('connection',_0x336f29=>{const _0x5a3ef2=_0x358e;_0x336f29['on'](_0x5a3ef2(0x1d5),_0x5900c3=>{const _0x1c05fd=_0x5a3ef2;try{const {userName:_0x3d7e31,position:_0x160d0c}=JSON['parse'](_0x5900c3);if(_0x3d7e31&&_0x160d0c)positions[_0x3d7e31]=_0x160d0c;}catch(_0xb0e4c7){console[_0x1c05fd(0x249)]('WebSocketメッセージの解析に失敗:',_0xb0e4c7);}}),_0x336f29['on'](_0x5a3ef2(0x249),_0x4f07ab=>console[_0x5a3ef2(0x249)](_0x5a3ef2(0x25a),_0x4f07ab));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x68fac(0x22d)](_0x68fac(0x1e2)),server_log_info(_0x68fac(0x258)),server_log_info(_0x68fac(0x255)),server_log_info('/connect\x20localhost:'+port),console[_0x68fac(0x22d)]('=======================================================\x0a');process['on'](_0x68fac(0x238),()=>{const _0xd61ea9=_0x68fac;console[_0xd61ea9(0x22d)]('終了シグナル受信。SSH接続を停止します...');if(vcSSHClient)vcSSHClient[_0xd61ea9(0x256)]();if(mcSSHClient)mcSSHClient[_0xd61ea9(0x256)]();process[_0xd61ea9(0x1fe)]();});}function broadcastPositions(){const _0x3e41bb=_0xec48e,_0xadfb7a=JSON[_0x3e41bb(0x231)]({'type':_0x3e41bb(0x20c),'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimensions':dimensions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x3e41bb(0x23f)]===WebSocket['OPEN'])relayWs[_0x3e41bb(0x222)](_0xadfb7a);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x3e41bb(0x246)]['forEach'](_0x67d19b=>{const _0x14bb15=_0x3e41bb;_0x67d19b[_0x14bb15(0x23f)]===WebSocket[_0x14bb15(0x22b)]&&_0x67d19b[_0x14bb15(0x222)](_0xadfb7a);});}async function handleWorld(_0x47b107){const _0xca85e9=_0xec48e;try{const _0x12870a=Array['from'](_0x47b107[_0xca85e9(0x201)][_0xca85e9(0x214)](),_0x46947a=>String(_0x46947a[_0xca85e9(0x1f6)]));let _0xb97a39={};if(proximity){const [_0x7f52e4,_0x148b31,_0xfa087a]=await Promise['all']([_0x47b107[_0xca85e9(0x1e6)](_0xca85e9(0x21b)),_0x47b107['runCommand']('testfor\x20@a[m=spectator]'),_0x47b107[_0xca85e9(0x1e6)](_0xca85e9(0x1e8))]);_0xb97a39={'alive':_0x7f52e4[_0xca85e9(0x1f0)]||[],'spectators':_0x148b31['victim']||[],'details':JSON[_0xca85e9(0x24a)](_0xfa087a[_0xca85e9(0x230)]||'[]')};}_0x12870a['forEach'](_0x455e76=>{const _0x399931=_0xca85e9;resetTimer();let _0x31a211;if(proximity)_0x31a211=_0xb97a39[_0x399931(0x21c)][_0x399931(0x250)](_0x455e76);const _0x3c9d63=processName(_0x455e76);_0xb97a39['spectators'][_0x399931(0x237)](_0x455e76)?spectators[_0x3c9d63]=!![]:spectators[_0x3c9d63]=![];if(!proximity)positions[_0x3c9d63]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0xb97a39[_0x399931(0x21c)][_0x399931(0x237)](_0x455e76))positions[_0x3c9d63]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0xb97a39[_0x399931(0x1ed)][_0x399931(0x237)](_0x455e76)){if(specListen===!![])positions[_0x3c9d63]=_0xb97a39[_0x399931(0x230)][_0x31a211][_0x399931(0x234)];else positions[_0x3c9d63]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimensions[_0x3c9d63]=_0xb97a39['details'][_0x31a211][_0x399931(0x1ee)];}else _0xb97a39['details'][_0x31a211]?.[_0x399931(0x234)]?(positions[_0x3c9d63]=_0xb97a39['details'][_0x31a211][_0x399931(0x234)],yRots[_0x3c9d63]=_0xb97a39[_0x399931(0x230)][_0x31a211][_0x399931(0x243)],dimensions[_0x3c9d63]=_0xb97a39['details'][_0x31a211][_0x399931(0x1ee)]):positions[_0x3c9d63]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x51addc){console[_0xca85e9(0x249)]('Error\x20handling\x20world:',_0x51addc);}if(!stop_roop)setTimeout(()=>handleWorld(_0x47b107),0x64);}async function connectToRelayServer(_0x385699){const _0x14b3d2=_0xec48e,_0x49e158=_0x385699==='mc',_0x314f86=_0x49e158?_0x14b3d2(0x228):_0x14b3d2(0x22c);try{const _0x25c215=await fetch('https://'+RELAY_SERVER_DOMAIN+_0x14b3d2(0x262)),_0x15f7bc=await _0x25c215['json'](),_0x21c948=_0x15f7bc[_0x14b3d2(0x1d9)];if(!_0x49e158)roomId=_0x21c948;console[_0x14b3d2(0x22d)](_0x14b3d2(0x1e2));_0x49e158?(server_log_info('Minecraftから以下のコマンドで接続してください:'),server_log_info('Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:'),server_log_info(_0x14b3d2(0x240)+RELAY_SERVER_DOMAIN+'/room/'+_0x21c948)):(useRelay=!![],vc_connected=!![],server_log_info(_0x14b3d2(0x212)+_0x21c948),server_log_info(_0x14b3d2(0x25d)),server_log_info(_0x14b3d2(0x208)),server_log_info(_0x14b3d2(0x25e)+_0x21c948));console['log'](_0x14b3d2(0x1c5));const _0x427f5f=new WebSocket(_0x14b3d2(0x244)+RELAY_SERVER_DOMAIN+_0x14b3d2(0x223)+_0x21c948+_0x14b3d2(0x1c1));if(!_0x49e158)relayWs=_0x427f5f;_0x427f5f['on'](_0x14b3d2(0x25f),()=>console[_0x14b3d2(0x22d)](_0x314f86+_0x14b3d2(0x229)+_0x21c948+')')),_0x427f5f['on'](_0x14b3d2(0x224),()=>console[_0x14b3d2(0x22d)](_0x314f86+_0x14b3d2(0x1cb)+_0x21c948+')')),_0x427f5f['on'](_0x14b3d2(0x249),_0x40ddb6=>console[_0x14b3d2(0x249)](_0x314f86+'\x20WebSocket\x20error:',_0x40ddb6)),_0x49e158?setupMcRelayListeners(_0x427f5f):setupVcRelayListeners(_0x427f5f);}catch(_0x16491c){console[_0x14b3d2(0x249)](_0x314f86+'\x20処理中にエラーが発生しました:',_0x16491c);}}function setupVcRelayListeners(_0x414a0d){_0x414a0d['on']('message',async _0x5bbea7=>{const _0x1673e8=_0x358e;try{const _0x3bcdd2=JSON[_0x1673e8(0x24a)](_0x5bbea7[_0x1673e8(0x219)]());if(mainWorld&&_0x3bcdd2[_0x1673e8(0x1e0)]==='run_command'&&typeof _0x3bcdd2[_0x1673e8(0x1e3)]==='string'){const _0x14e5bd=await mainWorld[_0x1673e8(0x1e6)](_0x3bcdd2[_0x1673e8(0x1e3)]);_0x414a0d[_0x1673e8(0x222)](JSON[_0x1673e8(0x231)]({'type':_0x1673e8(0x23c),'payload':_0x14e5bd}));}}catch(_0x4bc05e){console[_0x1673e8(0x249)]('[VC\x20Relay]\x20メッセージ処理エラー:',_0x4bc05e);}});}function name_command(_0x12828a){const _0x5a8526=_0xec48e,_0x7af229=processName(_0x12828a);!passwords[_0x7af229]&&(passwords[_0x7af229]=Math[_0x5a8526(0x200)](0x3e8+Math[_0x5a8526(0x260)]()*0x2328)[_0x5a8526(0x219)]());const _0x3ab8b5=lang==='ja'?_0x5a8526(0x1f8)+passwords[_0x7af229]+'です':'Password\x20is\x20'+passwords[_0x7af229];return _0x3ab8b5;}function data_update(_0x1eccee){const _0xebe150=_0xec48e;broadcastPositions(),resetTimer();for(const [_0x1bf83c,_0x4bc74f]of Object['entries'](_0x1eccee)){switch(_0x1bf83c){case _0xebe150(0x1de):continue;case'proximity':_0x4bc74f!==proximity&&(updateConfig(_0x1bf83c,_0x4bc74f),proximity=_0x4bc74f);break;case _0xebe150(0x1ea):positions=_0x4bc74f;break;case _0xebe150(0x1ff):_0x4bc74f!==distance&&(updateConfig(_0x1bf83c,_0x4bc74f),distance=_0x4bc74f);break;case'spectator':_0x4bc74f!==spectator&&(updateConfig(_0x1bf83c,_0x4bc74f),spectator=_0x4bc74f);break;case _0xebe150(0x1ed):spectators=_0x4bc74f;break;case _0xebe150(0x253):_0x4bc74f!==specListen&&(updateConfig(_0x1bf83c,_0x4bc74f),specListen=_0x4bc74f);break;case _0xebe150(0x20b):_0x4bc74f!==specDim&&(updateConfig(_0x1bf83c,_0x4bc74f),specDim=_0x4bc74f);break;case'dimensions':dimensions=_0x4bc74f;break;case _0xebe150(0x24b):yRots=_0x4bc74f;break;case _0xebe150(0x209):_0x4bc74f!==password&&(updateConfig(_0x1bf83c,_0x4bc74f),password=_0x4bc74f);case _0xebe150(0x1f1):_0x4bc74f!==lang&&(updateConfig(_0x1bf83c,_0x4bc74f),lang=_0x4bc74f);break;}}}function setupMcRelayListeners(_0x34da31){const _0x1b357a=_0xec48e;let _0x191dd3;_0x34da31['on'](_0x1b357a(0x1d5),async _0xb165d2=>{const _0x597080=_0x1b357a;try{const _0x2d5edd=JSON[_0x597080(0x24a)](_0xb165d2[_0x597080(0x219)]());if(_0x2d5edd[_0x597080(0x1de)]==='partner_connected'){console[_0x597080(0x22d)](_0x597080(0x1e4)),_0x191dd3=new WebSocket(_0x597080(0x24c)+port),_0x191dd3['on']('open',()=>console[_0x597080(0x22d)](_0x597080(0x203))),_0x191dd3['on'](_0x597080(0x1d5),_0x66f1c6=>_0x34da31[_0x597080(0x23f)]===WebSocket[_0x597080(0x22b)]&&_0x34da31[_0x597080(0x222)](_0x66f1c6)),_0x191dd3['on'](_0x597080(0x224),()=>_0x34da31[_0x597080(0x23f)]===WebSocket['OPEN']&&_0x34da31[_0x597080(0x224)]()),_0x191dd3['on']('error',_0x37d13d=>console['error']('[MC\x20Local\x20WS\x20Error]',_0x37d13d[_0x597080(0x1d5)]));return;}else{if(_0x2d5edd[_0x597080(0x1de)]===_0x597080(0x1d1))try{const _0x4b990c=name_command(_0x2d5edd[_0x597080(0x21f)]),_0x4b6d73={'type':_0x597080(0x1d1),'message':_0x4b990c,'correlationId':_0x2d5edd['correlationId']};_0x34da31['send'](JSON[_0x597080(0x231)](_0x4b6d73));}catch(_0x2f393d){console['log'](_0x2f393d);}else{if(_0x2d5edd[_0x597080(0x1de)]==='initialization')try{const _0x155642=JSON[_0x597080(0x231)]({'type':_0x597080(0x1e5),'roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang,'correlationId':_0x2d5edd[_0x597080(0x235)]});_0x34da31[_0x597080(0x222)](_0x155642);}catch(_0x3c7edf){console[_0x597080(0x22d)](_0x3c7edf);}else{if(_0x2d5edd[_0x597080(0x1de)]===_0x597080(0x1f5))try{data_update(_0x2d5edd);}catch(_0x4049b7){console[_0x597080(0x22d)](_0x4049b7);}else _0x2d5edd['type']==='disconnect_command'&&process['exit'](0x0);}}}}catch(_0x73de79){}_0x191dd3?.[_0x597080(0x23f)]===WebSocket[_0x597080(0x22b)]&&_0x191dd3[_0x597080(0x222)](_0xb165d2);}),_0x34da31['on'](_0x1b357a(0x224),()=>_0x191dd3?.[_0x1b357a(0x224)]());}function updateConfig(_0x1de46d,_0x57c30f){const _0x386073=_0xec48e;try{let _0x398de1=fs[_0x386073(0x24e)](configPath,_0x386073(0x226));const _0x261f17=new RegExp('(\x22'+_0x1de46d+_0x386073(0x1c7)),_0x177c69=typeof _0x57c30f===_0x386073(0x1c8)?'\x22'+_0x57c30f+'\x22':_0x57c30f,_0x500a9b=_0x398de1[_0x386073(0x1d6)](_0x261f17,'$1'+_0x177c69);_0x500a9b!==_0x398de1&&fs[_0x386073(0x254)](configPath,_0x500a9b,_0x386073(0x226));}catch(_0x236a46){console[_0x386073(0x249)](_0x386073(0x1cc),_0x236a46);}};async function main(){const _0x9fd7d=_0xec48e;resetTimer(),port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x9fd7d(0x1e1)+port);const _0x7b5e2e=express(),_0x385a4f=http[_0x9fd7d(0x23a)](_0x7b5e2e);_0x385a4f[_0x9fd7d(0x1e9)](port);const _0x165520=new Server({'webSocketOptions':{'server':_0x385a4f},'timezone':_0x9fd7d(0x215),'disableEncryption':!![]});_0x7b5e2e[_0x9fd7d(0x20a)](express[_0x9fd7d(0x259)]()),_0x7b5e2e[_0x9fd7d(0x1bd)]('/',(_0x36994b,_0x49a235)=>{const _0x25a4c3=_0x9fd7d;if(_0x36994b['body']['type']==='name_command'){const _0x503fef=name_command(_0x36994b[_0x25a4c3(0x23e)][_0x25a4c3(0x21f)]),_0x572f46={'type':'name_command','message':_0x503fef};_0x49a235[_0x25a4c3(0x216)](0xc8)[_0x25a4c3(0x259)](_0x572f46);}else{if(_0x36994b[_0x25a4c3(0x23e)][_0x25a4c3(0x1de)]===_0x25a4c3(0x1e5)){const _0x4bf404={'type':_0x25a4c3(0x1e5),'roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang};_0x49a235['status'](0xc8)[_0x25a4c3(0x259)](_0x4bf404);}else{if(_0x36994b['body'][_0x25a4c3(0x1de)]===_0x25a4c3(0x1f5))data_update(_0x36994b[_0x25a4c3(0x23e)]),_0x49a235[_0x25a4c3(0x216)](0xc8)[_0x25a4c3(0x259)]({'success':!![]});else _0x36994b[_0x25a4c3(0x23e)][_0x25a4c3(0x1de)]==='disconnect_command'&&process[_0x25a4c3(0x1fe)](0x0);}}});const _0x141ef1=(_0x4bc076,_0x22f5e6,_0x537805)=>async(_0x1c6ada,_0x15b220,_0x1ea5e2)=>{const _0x2a62d6=_0x9fd7d;if(_0x15b220[_0x2a62d6(0x1f6)]!==_0x1c6ada[_0x2a62d6(0x1ec)][_0x2a62d6(0x1f6)])return;if(_0x1ea5e2[0x0]!==_0x2a62d6(0x20f)&&_0x1ea5e2[0x0]!=='false')return;const _0xc50acb=_0x1ea5e2[0x0]===_0x2a62d6(0x20f);if(_0x4bc076===_0x2a62d6(0x209))password=_0xc50acb;else{if(_0x4bc076===_0x2a62d6(0x21a))proximity=_0xc50acb;else{if(_0x4bc076===_0x2a62d6(0x217))spectator=_0xc50acb;else{if(_0x4bc076==='specListen')specListen=_0xc50acb;else{if(_0x4bc076===_0x2a62d6(0x20b))specDim=_0xc50acb;}}}}updateConfig(_0x4bc076,_0xc50acb),Object[_0x2a62d6(0x1c6)](global,{[_0x4bc076]:_0xc50acb});const _0x1fd319=lang==='ja'?_0xc50acb?_0x22f5e6[_0x2a62d6(0x1ef)]:_0x22f5e6[_0x2a62d6(0x1db)]:_0xc50acb?_0x537805[_0x2a62d6(0x1ef)]:_0x537805[_0x2a62d6(0x1db)];await _0x1c6ada[_0x2a62d6(0x204)](_0x1fd319);},_0x322f2e={'!dis':async(_0x4a334a,_0x4c960b,_0x55678b)=>{const _0x3bacf6=_0x9fd7d;try{if(_0x4c960b['name']!==_0x4a334a[_0x3bacf6(0x1ec)][_0x3bacf6(0x1f6)])return;const _0x3de555=Number(_0x55678b[0x0]);if(!isNaN(_0x3de555)){distance=_0x3de555,updateConfig(_0x3bacf6(0x1ff),_0x3de555);const _0x2457f9=lang==='ja'?'声の最大距離を'+distance+'に変更しました':_0x3bacf6(0x264)+distance;await _0x4a334a[_0x3bacf6(0x204)](_0x2457f9);}}catch(_0x558e70){}},'!name':async(_0x4a598f,_0x5b3967)=>{const _0x153cec=_0x9fd7d;try{const _0x141215=processName(_0x5b3967['name']),_0x3d7e73='URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは'+roomId+_0x153cec(0x1ca)+_0x141215+'です',_0x1180ed='URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20'+roomId+_0x153cec(0x24f)+_0x141215;await _0x5b3967[_0x153cec(0x204)](lang==='ja'?_0x3d7e73:_0x1180ed);if(password){!passwords[_0x141215]&&(passwords[_0x141215]=Math['floor'](0x3e8+Math[_0x153cec(0x260)]()*0x2328)[_0x153cec(0x219)]());const _0x387b93=lang==='ja'?_0x153cec(0x1f8)+passwords[_0x141215]+'です':_0x153cec(0x220)+passwords[_0x141215];await _0x5b3967[_0x153cec(0x204)](_0x387b93);}}catch(_0x3fafaa){}},'!password':_0x141ef1(_0x9fd7d(0x209),{'enabled':'パスワードを有効にしました','disabled':_0x9fd7d(0x1c4)},{'enabled':_0x9fd7d(0x1fb),'disabled':_0x9fd7d(0x1ce)}),'!pvc':_0x141ef1('proximity',{'enabled':_0x9fd7d(0x1f7),'disabled':'近接vcを無効にしました'},{'enabled':_0x9fd7d(0x21d),'disabled':_0x9fd7d(0x1cf)}),'!spectator':_0x141ef1(_0x9fd7d(0x217),{'enabled':_0x9fd7d(0x1f3),'disabled':_0x9fd7d(0x1cd)},{'enabled':'Spectator\x20and\x20VC\x20separated','disabled':_0x9fd7d(0x210)}),'!specListen':_0x141ef1('specListen',{'enable':_0x9fd7d(0x1fa),'disable':_0x9fd7d(0x232)},{'enable':_0x9fd7d(0x227),'disable':_0x9fd7d(0x1dd)}),'!specDim':_0x141ef1('specDim',{'enable':_0x9fd7d(0x1bf),'disable':'スペクテイター同士の会話を共通にしました'},{'enable':_0x9fd7d(0x207),'disable':'Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions'}),'!lang':async(_0x300245,_0xf05622,_0x589481)=>{const _0x5a1933=_0x9fd7d;try{if(_0xf05622['name']!==_0x300245[_0x5a1933(0x1ec)][_0x5a1933(0x1f6)])return;const _0xc4621d=_0x589481[0x0]==='ja'?'ja':'en';lang=_0xc4621d,updateConfig(_0x5a1933(0x1f1),_0xc4621d);const _0x440f20=_0xc4621d==='ja'?'<近接VC>言語を日本語に設定しました':_0x5a1933(0x1d2);await _0x300245[_0x5a1933(0x204)](_0x440f20);}catch(_0x518b32){}},'!help':async(_0x289595,_0x3a1941)=>{const _0x2583d6=_0x9fd7d;try{await _0x3a1941['sendMessage'](_0x2583d6(0x233));if(lang=='ja'){await _0x3a1941[_0x2583d6(0x204)](_0x2583d6(0x245));const _0x46d58e=_0x289595[_0x2583d6(0x1ec)][_0x2583d6(0x1f6)];_0x3a1941[_0x2583d6(0x1f6)]==_0x46d58e&&await _0x3a1941[_0x2583d6(0x204)]('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x3a1941[_0x2583d6(0x204)]('Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20GamerTag');const _0x54057e=_0x289595[_0x2583d6(0x1ec)]['name'];_0x3a1941[_0x2583d6(0x1f6)]==_0x54057e&&await _0x3a1941[_0x2583d6(0x204)]('Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password');}await _0x3a1941[_0x2583d6(0x204)](_0x2583d6(0x233));}catch(_0x4c3e86){}}};_0x165520['on'](ServerEvent[_0x9fd7d(0x261)],async({sender:_0x146be4,message:_0x234c66,world:_0x62ec1e})=>{const _0x313787=_0x9fd7d,[_0x13a29e,..._0x352749]=_0x234c66[_0x313787(0x1c0)]('\x20');if(_0x322f2e[_0x13a29e])await _0x322f2e[_0x13a29e](_0x62ec1e,_0x146be4,_0x352749);}),_0x165520['on'](ServerEvent[_0x9fd7d(0x241)],()=>setupWebSocketServer()),_0x165520['on'](ServerEvent[_0x9fd7d(0x1c9)],async({world:_0x419f93})=>{const _0x5d62b7=_0x9fd7d;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x419f93,stop_roop=![],server_log_info(_0x5d62b7(0x1fd)+_0x419f93[_0x5d62b7(0x1f6)]);if(lang=='ja'){let _0x5bc4b7='';proximity?_0x5bc4b7='有効':_0x5bc4b7='無効',_0x419f93[_0x5d62b7(0x204)](_0x5d62b7(0x1d4)+_0x5bc4b7+_0x5d62b7(0x213)+distance+'\x0a!help\x20でコマンド一覧を確認できます');}else{let _0xf784b='';proximity?_0xf784b=_0x5d62b7(0x1ef):_0xf784b=_0x5d62b7(0x1db),_0x419f93['sendMessage'](_0x5d62b7(0x1dc)+_0xf784b+'\x0aMax\x20distance:'+distance+_0x5d62b7(0x1f4));}await handleWorld(_0x419f93);}),_0x165520['on'](ServerEvent[_0x9fd7d(0x252)],({world:_0xb7b34d})=>{const _0x12b12a=_0x9fd7d;mainWorld=null,stop_roop=!![],server_log_info(_0x12b12a(0x25b)+_0xb7b34d[_0x12b12a(0x1f6)]);}),_0x165520['on'](ServerEvent[_0x9fd7d(0x1d0)],async({player:_0x239c4f,world:_0x5bee0c})=>{const _0x58a6b1=_0x9fd7d;server_log_info(_0x58a6b1(0x1f9)+_0x239c4f[_0x58a6b1(0x1f6)]);const _0x5a972e=setInterval(async()=>{const _0x452315=_0x58a6b1;try{const _0x50a4fb=processName(_0x239c4f[_0x452315(0x1f6)]),_0x3951d0=_0x452315(0x22e)+roomId+'です\x0aあなたのVCnameは'+_0x50a4fb+'です',_0x84431b=_0x452315(0x22a)+roomId+'\x0aYour\x20VCname\x20is\x20'+_0x50a4fb;await _0x239c4f[_0x452315(0x204)](lang==='ja'?_0x3951d0:_0x84431b);if(password){!passwords[_0x50a4fb]&&(passwords[_0x50a4fb]=Math['floor'](0x3e8+Math[_0x452315(0x260)]()*0x2328)['toString']());const _0x1cf135=lang==='ja'?_0x452315(0x1f8)+passwords[_0x50a4fb]+'です':_0x452315(0x220)+passwords[_0x50a4fb];await _0x239c4f[_0x452315(0x204)](_0x1cf135);}clearInterval(_0x5a972e);}catch(_0x3bdcd7){}},0x1f4);}),_0x165520['on'](ServerEvent[_0x9fd7d(0x242)],({player:_0x26780e,world:_0x16629c})=>{const _0x5846b0=_0x9fd7d;server_log_info(_0x5846b0(0x20e)+_0x26780e['name']);const _0x1ac345=_0x16629c[_0x5846b0(0x1ec)][_0x5846b0(0x1f6)];if(_0x26780e[_0x5846b0(0x1f6)]===_0x1ac345)process[_0x5846b0(0x1fe)](0x0);delete positions[processName(_0x26780e[_0x5846b0(0x1f6)])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info(_0x9fd7d(0x247)),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
