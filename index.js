const _0x4175eb=_0x2c7f;function _0x2c7f(_0x476b80,_0x20fdd7){const _0x29277b=_0x2927();return _0x2c7f=function(_0x2c7f0c,_0x45dc4c){_0x2c7f0c=_0x2c7f0c-0x93;let _0x4030d0=_0x29277b[_0x2c7f0c];return _0x4030d0;},_0x2c7f(_0x476b80,_0x20fdd7);}(function(_0x41246b,_0x1bb763){const _0x1ee2d5=_0x2c7f,_0x377b42=_0x41246b();while(!![]){try{const _0x569bb0=parseInt(_0x1ee2d5(0x117))/0x1*(parseInt(_0x1ee2d5(0xf1))/0x2)+parseInt(_0x1ee2d5(0x11d))/0x3+-parseInt(_0x1ee2d5(0xb0))/0x4+parseInt(_0x1ee2d5(0xd8))/0x5*(parseInt(_0x1ee2d5(0xfc))/0x6)+parseInt(_0x1ee2d5(0xf7))/0x7*(parseInt(_0x1ee2d5(0x98))/0x8)+-parseInt(_0x1ee2d5(0xd0))/0x9+parseInt(_0x1ee2d5(0xa2))/0xa;if(_0x569bb0===_0x1bb763)break;else _0x377b42['push'](_0x377b42['shift']());}catch(_0x46b0df){_0x377b42['push'](_0x377b42['shift']());}}}(_0x2927,0xa6fe5));const {Server,ServerEvent}=require(_0x4175eb(0x102)),WebSocket=require('ws'),fetch=require(_0x4175eb(0xbf)),wanakana=require(_0x4175eb(0x108)),fs=require('fs'),JSON5=require(_0x4175eb(0x11f)),getPort=require(_0x4175eb(0x136)),{Client}=require(_0x4175eb(0xde)),net=require('net'),configPath=_0x4175eb(0xe9),config=JSON5[_0x4175eb(0xbd)](fs[_0x4175eb(0xfb)](configPath,_0x4175eb(0xc6)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimentions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![];const server_log_info=_0x11a955=>console['log'](_0x4175eb(0x96)+_0x11a955),server_log_log=_0x2f45a7=>console[_0x4175eb(0x123)](_0x4175eb(0x112)+_0x2f45a7),processName=_0x313238=>wanakana['toRomaji'](_0x313238['replace'](/ /g,'_'))[_0x4175eb(0x107)](/n'/g,'n'),RELAY_SERVER_DOMAIN='mcproxvc.tcpexposer.com';function startSshForwarding(_0x4f016a,_0x280924,_0x39c156){const _0x1720c3=_0x4175eb;if(!_0x4f016a||!username||!ssh_password)return;const _0x36fd2e=_0x39c156==='vc',_0xdb6fcb=_0x36fd2e?_0x1720c3(0xef):'[MC\x20SSH]',_0x5cde26={'host':'tcpexposer.com','port':0x16,'username':username,'password':ssh_password},_0x278db4={'remoteAddr':_0x4f016a,'remotePort':0x50,'localAddr':_0x1720c3(0xb8),'localPort':_0x280924},_0x1bf510=new Client();return _0x1bf510['on'](_0x1720c3(0xce),()=>{const _0x57ed58=_0x1720c3;_0x1bf510[_0x57ed58(0x12b)](_0x278db4[_0x57ed58(0xd5)],_0x278db4[_0x57ed58(0xf9)],_0x38ce23=>{const _0xe47da9=_0x57ed58;if(_0x38ce23)return console[_0xe47da9(0x134)](_0xdb6fcb+_0xe47da9(0xc2)+_0x4f016a+'):',_0x38ce23[_0xe47da9(0xfd)]),server_log_info(_0xdb6fcb+_0xe47da9(0xa8)),connectToRelayServer(_0x39c156),_0x1bf510[_0xe47da9(0xa4)]();console[_0xe47da9(0x123)](_0xe47da9(0x132)),_0x36fd2e?(useRelay=![],vc_connected=!![],server_log_info(_0xe47da9(0xe7)+_0x4f016a),server_log_info(_0xe47da9(0xae)),server_log_info(_0xe47da9(0x100)),server_log_info(_0xe47da9(0x111)+_0x4f016a)):(server_log_info(_0xe47da9(0x101)),server_log_info(_0xe47da9(0xfe)),server_log_info('/connect\x20'+_0x4f016a+_0xe47da9(0xeb))),console[_0xe47da9(0x123)](_0xe47da9(0x9e));}),_0x1bf510['on'](_0x57ed58(0xe8),(_0x3eeb2c,_0x145c49)=>{const _0x5d5e45=_0x57ed58,_0x5914d3=_0x145c49(),_0x11a5b2=net[_0x5d5e45(0x119)]({'host':_0x278db4[_0x5d5e45(0xc7)],'port':_0x278db4[_0x5d5e45(0x10a)]});_0x11a5b2['on'](_0x5d5e45(0xaf),()=>_0x5914d3[_0x5d5e45(0xd6)](_0x11a5b2)[_0x5d5e45(0xd6)](_0x5914d3)),_0x11a5b2['on']('error',_0x42466a=>{const _0x38171c=_0x5d5e45;console['error'](_0x38171c(0xf5)+_0x4f016a+'):',_0x42466a[_0x38171c(0xfd)]),_0x5914d3[_0x38171c(0xe3)]();}),_0x5914d3['on'](_0x5d5e45(0xe3),()=>_0x11a5b2[_0x5d5e45(0xa4)]());});})['on'](_0x1720c3(0x134),_0x499ae3=>{const _0x82ad9d=_0x1720c3;console[_0x82ad9d(0x134)](_0x82ad9d(0xbc)+_0x4f016a+'):',_0x499ae3[_0x82ad9d(0xfd)]),server_log_info(_0xdb6fcb+'中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),connectToRelayServer(_0x39c156);}),_0x1bf510[_0x1720c3(0xaf)](_0x5cde26),_0x1bf510;}async function setupWebSocketServer(){const _0x270302=_0x4175eb;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket['Server']({'port':web_port}),wss['on'](_0x270302(0xc3),_0x1cc03f=>{const _0x3d38eb=_0x270302;_0x1cc03f['on'](_0x3d38eb(0xfd),_0x5af7ed=>{const _0x1cb84f=_0x3d38eb;try{const {userName:_0x5b919a,position:_0x334b3f}=JSON['parse'](_0x5af7ed);if(_0x5b919a&&_0x334b3f)positions[_0x5b919a]=_0x334b3f;}catch(_0x44c058){console[_0x1cb84f(0x134)](_0x1cb84f(0xcf),_0x44c058);}}),_0x1cc03f['on']('error',_0x535599=>console[_0x3d38eb(0x134)](_0x3d38eb(0xf3),_0x535599));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console['log'](_0x270302(0x132)),server_log_info(_0x270302(0x101)),server_log_info(_0x270302(0xfe)),server_log_info(_0x270302(0x10d)+port),console['log'](_0x270302(0x9e));process['on'](_0x270302(0xe0),()=>{const _0x360570=_0x270302;console[_0x360570(0x123)](_0x360570(0xe4));if(vcSSHClient)vcSSHClient[_0x360570(0xa4)]();if(mcSSHClient)mcSSHClient[_0x360570(0xa4)]();process['exit']();});}function broadcastPositions(){const _0x4bb3e6=_0x4175eb,_0x5a55a9=JSON[_0x4bb3e6(0xee)]({'type':_0x4bb3e6(0xb6),'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimentions':dimentions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x4bb3e6(0x97)]===WebSocket[_0x4bb3e6(0xe1)])relayWs['send'](_0x5a55a9);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x4bb3e6(0x13a)][_0x4bb3e6(0xa3)](_0x2f04e1=>{const _0x1ea8df=_0x4bb3e6;_0x2f04e1[_0x1ea8df(0x97)]===WebSocket[_0x1ea8df(0xe1)]&&_0x2f04e1[_0x1ea8df(0x118)](_0x5a55a9);});}async function handleWorld(_0x936beb){const _0xdda569=_0x4175eb;try{const _0x4504d6=Array[_0xdda569(0x11a)](_0x936beb[_0xdda569(0x10e)][_0xdda569(0x109)](),_0x2ee108=>String(_0x2ee108[_0xdda569(0x110)]));let _0xce981b={};if(proximity){const [_0x4e874c,_0x3cd1f7,_0x3a57e5]=await Promise[_0xdda569(0x9a)]([_0x936beb[_0xdda569(0x131)](_0xdda569(0xa6)),_0x936beb[_0xdda569(0x131)](_0xdda569(0xc8)),_0x936beb[_0xdda569(0x131)](_0xdda569(0x94))]);_0xce981b={'alive':_0x4e874c['victim']||[],'spectators':_0x3cd1f7['victim']||[],'details':JSON['parse'](_0x3a57e5[_0xdda569(0xab)]||'[]')};}_0x4504d6['forEach'](_0x18115a=>{const _0x534858=_0xdda569;let _0x3f14fb;if(proximity)_0x3f14fb=_0xce981b[_0x534858(0xdc)][_0x534858(0x130)](_0x18115a);const _0x5307f2=processName(_0x18115a);_0xce981b['spectators'][_0x534858(0xaa)](_0x18115a)?spectators[_0x5307f2]=!![]:spectators[_0x5307f2]=![];if(!proximity)positions[_0x5307f2]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0xce981b[_0x534858(0xdc)][_0x534858(0xaa)](_0x18115a))positions[_0x5307f2]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0xce981b[_0x534858(0x120)]['includes'](_0x18115a)){if(specListen===!![])positions[_0x5307f2]=_0xce981b[_0x534858(0xab)][_0x3f14fb][_0x534858(0x9f)];else positions[_0x5307f2]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimentions[_0x5307f2]=_0xce981b[_0x534858(0xab)][_0x3f14fb][_0x534858(0xcd)];}else _0xce981b[_0x534858(0xab)][_0x3f14fb]?.[_0x534858(0x9f)]?(positions[_0x5307f2]=_0xce981b[_0x534858(0xab)][_0x3f14fb][_0x534858(0x9f)],yRots[_0x5307f2]=_0xce981b[_0x534858(0xab)][_0x3f14fb][_0x534858(0x127)],dimentions[_0x5307f2]=_0xce981b['details'][_0x3f14fb][_0x534858(0xcd)]):positions[_0x5307f2]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x552955){console['error'](_0xdda569(0x93),_0x552955);}if(!stop_roop)setTimeout(()=>handleWorld(_0x936beb),0x64);}async function connectToRelayServer(_0x2ee5b7){const _0x253f0a=_0x4175eb,_0x36b9b5=_0x2ee5b7==='mc',_0x42aee7=_0x36b9b5?_0x253f0a(0xa5):_0x253f0a(0xf4);try{const _0x2f6563=await fetch('https://'+RELAY_SERVER_DOMAIN+_0x253f0a(0x115)),_0x554d4b=await _0x2f6563[_0x253f0a(0xd1)](),_0x4094e2=_0x554d4b[_0x253f0a(0xcc)];if(!_0x36b9b5)roomId=_0x4094e2;console['log'](_0x253f0a(0x132));_0x36b9b5?(server_log_info(_0x253f0a(0x101)),server_log_info(_0x253f0a(0xfe)),server_log_info(_0x253f0a(0xc1)+RELAY_SERVER_DOMAIN+'/room/'+_0x4094e2)):(useRelay=!![],vc_connected=!![],server_log_info(_0x253f0a(0xe7)+_0x4094e2),server_log_info(_0x253f0a(0xae)),server_log_info(_0x253f0a(0x100)),server_log_info(_0x253f0a(0x111)+_0x4094e2));console[_0x253f0a(0x123)](_0x253f0a(0x9e));const _0x32c9ee=new WebSocket('wss://'+RELAY_SERVER_DOMAIN+_0x253f0a(0xec)+_0x4094e2+_0x253f0a(0x10b));if(!_0x36b9b5)relayWs=_0x32c9ee;_0x32c9ee['on'](_0x253f0a(0x106),()=>console[_0x253f0a(0x123)](_0x42aee7+_0x253f0a(0xbe)+_0x4094e2+')')),_0x32c9ee['on'](_0x253f0a(0xe3),()=>console['log'](_0x42aee7+'\x20Relay\x20server\x20disconnected\x20(ID:\x20'+_0x4094e2+')')),_0x32c9ee['on'](_0x253f0a(0x134),_0x118eef=>console['error'](_0x42aee7+'\x20WebSocket\x20error:',_0x118eef)),_0x36b9b5?setupMcRelayListeners(_0x32c9ee):setupVcRelayListeners(_0x32c9ee);}catch(_0x101382){console[_0x253f0a(0x134)](_0x42aee7+'\x20処理中にエラーが発生しました:',_0x101382);}}function setupVcRelayListeners(_0x48eb75){const _0x25cb82=_0x4175eb;_0x48eb75['on'](_0x25cb82(0xfd),async _0x25ff11=>{const _0x571335=_0x25cb82;try{const _0x507008=JSON[_0x571335(0xbd)](_0x25ff11['toString']());if(mainWorld&&_0x507008[_0x571335(0xa7)]===_0x571335(0x116)&&typeof _0x507008[_0x571335(0xf0)]===_0x571335(0x12e)){const _0x2830e2=await mainWorld[_0x571335(0x131)](_0x507008['value']);_0x48eb75[_0x571335(0x118)](JSON[_0x571335(0xee)]({'type':_0x571335(0xea),'payload':_0x2830e2}));}}catch(_0x553a15){console[_0x571335(0x134)](_0x571335(0xff),_0x553a15);}});}function _0x2927(){const _0x31bbc6=['\x0a声の届く距離：','/create-room','run_command','197tDzTAt','send','createConnection','from','\x20スペクテイター同士の会話をディメンションごとに分けました','toString','3506295HFqcmS','disabled','json5','spectators','<近接VC>言語を日本語に設定しました','<Proximity\x20VC>Language\x20set\x20to\x20English','log','Password\x20is\x20','spectator','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','yRot','Connection\x20started\x0aProximity\x20voice\x20chat:','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','random','forwardIn','floor','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','string','\x0a!help\x20でコマンド一覧を確認できます','indexOf','runCommand','\x0a=======================================================','WorldAdd','error','Password\x20enabled','get-port','\x0a!help\x20for\x20command\x20list','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20name','です\x0aあなたのVCnameは','clients','specListen','Error\x20handling\x20world:','querytarget\x20@e[type=player]','distance','\x1b[36m[Info]\x1b[0m\x20','readyState','195592hfuhMC','Spectator\x20and\x20VC\x20separated','all','sendMessage','lang','近接vcを有効にしました','=======================================================\x0a','position','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','近接vcを無効にしました','1597810YXkplb','forEach','end','[MC\x20Relay]','testfor\x20@e[type=player]','action','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','proximity','includes','details','split','に変更しました','参加者はこのURLにアクセスしてください:','connect','2015272sgdwle','Changed\x20max\x20distance\x20to\x20','--------------------','\x0aMax\x20distance:','partner_connected','PlayerLoad','world_update','Spectator`s\x20VC\x20separated\x20by\x20dimension','localhost','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','type','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使う名前を確認できます','❌\x20SSH\x20Error\x20(','parse','\x20Relay\x20server\x20connected\x20(ID:\x20','node-fetch','Spectator\x20set\x20to\x20common\x20VC','/connect\x20','❌\x20ポートフォワーディング失敗\x20(','connection','PlayerChat','false','utf8','localAddr','testfor\x20@a[m=spectator]','password','Password\x20disabled','Open','roomId','dimension','ready','WebSocketメッセージの解析に失敗:','11206539iyhKeP','json','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','localPlayer','パスワードは','remoteAddr','pipe','Asia/Tokyo','4650EQIJFn','Proximity\x20VC\x20disabled','スペクテイターが他モードプレイヤーの会話を聞けるようになました','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','alive','true','ssh2','\x0aYour\x20VCname\x20is\x20','SIGINT','OPEN','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','close','終了シグナル受信。SSH接続を停止します...','enabled','パスワードを有効にしました','ROOM\x20ID:\x20','tcp\x20connection','./config.json','command_result','.tcpexposer.com','/room/','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','stringify','[VC\x20SSH]','value','3194PRFaim','PlayerLeave','WebSocket\x20error:','[VC\x20Relay]','ローカル接続エラー\x20(','specDim','7HSVHux','❌\x20設定ファイルの更新に失敗しました:','remotePort','socket-beサーバーのポート:\x20','readFileSync','4938PLlhfl','message','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','[VC\x20Relay]\x20メッセージ処理エラー:','Participants\x20should\x20access\x20this\x20URL','Minecraftから以下のコマンドで接続してください:','socket-be','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','Proximity\x20VC\x20enabled','パスワードを無効にしました','open','replace','wanakana','values','localPort','?clientType=server_script','スペクテイターを共通のVCにしました','/connect\x20localhost:','players','writeFileSync','name','https://proximity-vc-mcbe.pages.dev?roomid=','\x1b[33m[Log]\x1b[0m\x20','スペクテイターとVCを分けました'];_0x2927=function(){return _0x31bbc6;};return _0x2927();}function setupMcRelayListeners(_0x394cd8){const _0x5d3c76=_0x4175eb;let _0x280945;_0x394cd8['on']('message',_0x305d41=>{const _0x46f7f0=_0x2c7f;try{const _0x3c0a7b=JSON[_0x46f7f0(0xbd)](_0x305d41[_0x46f7f0(0x11c)]());if(_0x3c0a7b[_0x46f7f0(0xba)]===_0x46f7f0(0xb4)){console[_0x46f7f0(0x123)](_0x46f7f0(0x103)),_0x280945=new WebSocket('ws://127.0.0.1:'+port),_0x280945['on']('open',()=>console[_0x46f7f0(0x123)](_0x46f7f0(0xd2))),_0x280945['on'](_0x46f7f0(0xfd),_0x132a75=>_0x394cd8[_0x46f7f0(0x97)]===WebSocket[_0x46f7f0(0xe1)]&&_0x394cd8['send'](_0x132a75)),_0x280945['on'](_0x46f7f0(0xe3),()=>_0x394cd8[_0x46f7f0(0x97)]===WebSocket[_0x46f7f0(0xe1)]&&_0x394cd8[_0x46f7f0(0xe3)]()),_0x280945['on']('error',_0xec9066=>console[_0x46f7f0(0x134)]('[MC\x20Local\x20WS\x20Error]',_0xec9066[_0x46f7f0(0xfd)]));return;}}catch(_0x8fdb1){}_0x280945?.[_0x46f7f0(0x97)]===WebSocket[_0x46f7f0(0xe1)]&&_0x280945[_0x46f7f0(0x118)](_0x305d41);}),_0x394cd8['on'](_0x5d3c76(0xe3),()=>_0x280945?.[_0x5d3c76(0xe3)]());}async function main(){const _0x192274=_0x4175eb;port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x192274(0xfa)+port);const _0x58ab0d=new Server({'port':port,'disableEncryption':!![],'timezone':_0x192274(0xd7)}),_0x663cce=(_0x94798c,_0x589be3)=>{const _0x1bf39c=_0x192274;try{let _0x51d427=fs[_0x1bf39c(0xfb)](configPath,_0x1bf39c(0xc6));const _0xfe79a9=new RegExp('(\x22'+_0x94798c+'\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)'),_0x36c9fd=typeof _0x589be3===_0x1bf39c(0x12e)?'\x22'+_0x589be3+'\x22':_0x589be3,_0x617c81=_0x51d427['replace'](_0xfe79a9,'$1'+_0x36c9fd);_0x617c81!==_0x51d427&&fs[_0x1bf39c(0x10f)](configPath,_0x617c81,_0x1bf39c(0xc6));}catch(_0xc1fc01){console[_0x1bf39c(0x134)](_0x1bf39c(0xf8),_0xc1fc01);}},_0x3cc2c2=(_0x5f20b2,_0x4735f7,_0x36084d)=>async(_0x2549d8,_0x26c97d,_0x220bee)=>{const _0x567dd7=_0x192274;if(_0x26c97d[_0x567dd7(0x110)]!==_0x2549d8[_0x567dd7(0xd3)]['name'])return;if(_0x220bee[0x0]!==_0x567dd7(0xdd)&&_0x220bee[0x0]!==_0x567dd7(0xc5))return;const _0x3776fd=_0x220bee[0x0]===_0x567dd7(0xdd);if(_0x5f20b2===_0x567dd7(0xc9))password=_0x3776fd;else{if(_0x5f20b2===_0x567dd7(0xa9))proximity=_0x3776fd;else{if(_0x5f20b2===_0x567dd7(0x125))spectator=_0x3776fd;else{if(_0x5f20b2===_0x567dd7(0x13b))specListen=_0x3776fd;else{if(_0x5f20b2===_0x567dd7(0xf6))specDim=_0x3776fd;}}}}_0x663cce(_0x5f20b2,_0x3776fd),Object['assign'](global,{[_0x5f20b2]:_0x3776fd});const _0x542e09=lang==='ja'?_0x3776fd?_0x4735f7[_0x567dd7(0xe5)]:_0x4735f7[_0x567dd7(0x11e)]:_0x3776fd?_0x36084d[_0x567dd7(0xe5)]:_0x36084d[_0x567dd7(0x11e)];await _0x2549d8[_0x567dd7(0x9b)](_0x542e09);},_0x516e49={'!dis':async(_0x477c7,_0x36f25f,_0x58a316)=>{const _0x113c2a=_0x192274;try{if(_0x36f25f[_0x113c2a(0x110)]!==_0x477c7[_0x113c2a(0xd3)][_0x113c2a(0x110)])return;const _0x1df293=Number(_0x58a316[0x0]);if(!isNaN(_0x1df293)){distance=_0x1df293,_0x663cce(_0x113c2a(0x95),_0x1df293);const _0x45d075=lang==='ja'?'声の最大距離を'+distance+_0x113c2a(0xad):_0x113c2a(0xb1)+distance;await _0x477c7[_0x113c2a(0x9b)](_0x45d075);}}catch(_0x7d770d){}},'!name':async(_0x506df9,_0x5e6fe1)=>{const _0xbfe58a=_0x192274;try{const _0x2e092b=processName(_0x5e6fe1[_0xbfe58a(0x110)]),_0xc3568=_0xbfe58a(0xb9)+roomId+_0xbfe58a(0x139)+_0x2e092b+'です',_0x2cf98a=_0xbfe58a(0xdb)+roomId+_0xbfe58a(0xdf)+_0x2e092b;await _0x5e6fe1[_0xbfe58a(0x9b)](lang==='ja'?_0xc3568:_0x2cf98a);if(password){!passwords[_0x2e092b]&&(passwords[_0x2e092b]=Math[_0xbfe58a(0x12c)](0x3e8+Math[_0xbfe58a(0x12a)]()*0x2328)['toString']());const _0x54a9f8=lang==='ja'?_0xbfe58a(0xd4)+passwords[_0x2e092b]+'です':_0xbfe58a(0x124)+passwords[_0x2e092b];await _0x5e6fe1[_0xbfe58a(0x9b)](_0x54a9f8);}}catch(_0x724304){}},'!password':_0x3cc2c2(_0x192274(0xc9),{'enabled':_0x192274(0xe6),'disabled':_0x192274(0x105)},{'enabled':_0x192274(0x135),'disabled':_0x192274(0xca)}),'!pvc':_0x3cc2c2(_0x192274(0xa9),{'enabled':_0x192274(0x9d),'disabled':_0x192274(0xa1)},{'enabled':_0x192274(0x104),'disabled':_0x192274(0xd9)}),'!spectator':_0x3cc2c2(_0x192274(0x125),{'enabled':_0x192274(0x113),'disabled':_0x192274(0x10c)},{'enabled':_0x192274(0x99),'disabled':_0x192274(0xc0)}),'!specListen':_0x3cc2c2('specListen',{'enable':_0x192274(0xda),'disable':_0x192274(0x12d)},{'enable':_0x192274(0x126),'disable':_0x192274(0x129)}),'!specDim':_0x3cc2c2('specDim',{'enable':_0x192274(0x11b),'disable':'スペクテイター同士の会話を共通にしました'},{'enable':_0x192274(0xb7),'disable':_0x192274(0xa0)}),'!lang':async(_0x29f7c7,_0x17a07f,_0x533a7d)=>{const _0x221bdb=_0x192274;try{if(_0x17a07f[_0x221bdb(0x110)]!==_0x29f7c7['localPlayer'][_0x221bdb(0x110)])return;const _0x3c3fc0=_0x533a7d[0x0]==='ja'?'ja':'en';lang=_0x3c3fc0,_0x663cce(_0x221bdb(0x9c),_0x3c3fc0);const _0xc11846=_0x3c3fc0==='ja'?_0x221bdb(0x121):_0x221bdb(0x122);await _0x29f7c7[_0x221bdb(0x9b)](_0xc11846);}catch(_0x468d68){}},'!help':async(_0x52dcb5,_0x1a393c)=>{const _0x15db42=_0x192274;try{await _0x1a393c[_0x15db42(0x9b)](_0x15db42(0xb2));if(lang=='ja'){await _0x1a393c[_0x15db42(0x9b)](_0x15db42(0xbb));const _0x3b158e=_0x52dcb5[_0x15db42(0xd3)][_0x15db42(0x110)];_0x1a393c[_0x15db42(0x110)]==_0x3b158e&&await _0x1a393c[_0x15db42(0x9b)]('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x1a393c['sendMessage'](_0x15db42(0x138));const _0x2e8cf8=_0x52dcb5['localPlayer'][_0x15db42(0x110)];_0x1a393c['name']==_0x2e8cf8&&await _0x1a393c['sendMessage']('Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password');}await _0x1a393c[_0x15db42(0x9b)](_0x15db42(0xb2));}catch(_0x230482){}}};_0x58ab0d['on'](ServerEvent[_0x192274(0xc4)],async({sender:_0x1d805a,message:_0xdfb4a7,world:_0x43e5f7})=>{const _0x461fac=_0x192274,[_0x22ec33,..._0x1b085b]=_0xdfb4a7[_0x461fac(0xac)]('\x20');if(_0x516e49[_0x22ec33])await _0x516e49[_0x22ec33](_0x43e5f7,_0x1d805a,_0x1b085b);}),_0x58ab0d['on'](ServerEvent[_0x192274(0xcb)],()=>setupWebSocketServer()),_0x58ab0d['on'](ServerEvent[_0x192274(0x133)],async({world:_0x57510c})=>{const _0x2abd90=_0x192274;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x57510c,stop_roop=![],server_log_info('接続開始:\x20'+_0x57510c[_0x2abd90(0x110)]);if(lang=='ja'){let _0x368f06='';proximity?_0x368f06='有効':_0x368f06='無効',_0x57510c[_0x2abd90(0x9b)]('接続を開始しました\x0a近接vc：'+_0x368f06+_0x2abd90(0x114)+distance+_0x2abd90(0x12f));}else{let _0xe92382='';proximity?_0xe92382='enabled':_0xe92382=_0x2abd90(0x11e),_0x57510c[_0x2abd90(0x9b)](_0x2abd90(0x128)+_0xe92382+_0x2abd90(0xb3)+distance+_0x2abd90(0x137));}await handleWorld(_0x57510c);}),_0x58ab0d['on'](ServerEvent['WorldRemove'],({world:_0xa16867})=>{const _0x3963e0=_0x192274;mainWorld=null,stop_roop=!![],server_log_info('接続終了:\x20'+_0xa16867[_0x3963e0(0x110)]);}),_0x58ab0d['on'](ServerEvent[_0x192274(0xb5)],async({player:_0x53e985,world:_0x605f0})=>{const _0x5ac3cd=_0x192274;server_log_info('参加:\x20'+_0x53e985[_0x5ac3cd(0x110)]);const _0x1adcef=setInterval(async()=>{const _0x24b43f=_0x5ac3cd;try{const _0x127d22=processName(_0x53e985[_0x24b43f(0x110)]),_0x4e0430=_0x24b43f(0xed)+roomId+_0x24b43f(0x139)+_0x127d22+'です',_0x3dae27=_0x24b43f(0xe2)+roomId+_0x24b43f(0xdf)+_0x127d22;await _0x53e985['sendMessage'](lang==='ja'?_0x4e0430:_0x3dae27);if(password){!passwords[_0x127d22]&&(passwords[_0x127d22]=Math[_0x24b43f(0x12c)](0x3e8+Math[_0x24b43f(0x12a)]()*0x2328)[_0x24b43f(0x11c)]());const _0x4b206c=lang==='ja'?_0x24b43f(0xd4)+passwords[_0x127d22]+'です':_0x24b43f(0x124)+passwords[_0x127d22];await _0x53e985[_0x24b43f(0x9b)](_0x4b206c);}clearInterval(_0x1adcef);}catch(_0x52df69){}},0x1f4);}),_0x58ab0d['on'](ServerEvent[_0x192274(0xf2)],({player:_0x438b13})=>{const _0x5ef196=_0x192274;server_log_info('退出:\x20'+_0x438b13['name']),delete positions[processName(_0x438b13[_0x5ef196(0x110)])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info('中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
