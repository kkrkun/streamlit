const _0x129c44=_0xfe6d;(function(_0x177bbe,_0x1a70e1){const _0x5c4eee=_0xfe6d,_0x1b0e24=_0x177bbe();while(!![]){try{const _0x3f984c=-parseInt(_0x5c4eee(0x19a))/0x1+-parseInt(_0x5c4eee(0x16e))/0x2+parseInt(_0x5c4eee(0x164))/0x3+-parseInt(_0x5c4eee(0x1bc))/0x4+-parseInt(_0x5c4eee(0x1c6))/0x5+parseInt(_0x5c4eee(0x200))/0x6*(-parseInt(_0x5c4eee(0x1c4))/0x7)+parseInt(_0x5c4eee(0x1b4))/0x8;if(_0x3f984c===_0x1a70e1)break;else _0x1b0e24['push'](_0x1b0e24['shift']());}catch(_0x9b374a){_0x1b0e24['push'](_0x1b0e24['shift']());}}}(_0x5e90,0x22aff));const {Server,ServerEvent}=require(_0x129c44(0x1a1)),WebSocket=require('ws'),fetch=require('node-fetch'),wanakana=require(_0x129c44(0x20d)),fs=require('fs'),JSON5=require(_0x129c44(0x1c3)),getPort=require(_0x129c44(0x1a6)),{Client}=require('ssh2'),net=require(_0x129c44(0x1e1)),express=require('express'),http=require('http'),configPath='./config.json',config=JSON5[_0x129c44(0x1f5)](fs[_0x129c44(0x199)](configPath,_0x129c44(0x19c)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimensions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![];const server_log_info=_0x17b0db=>console['log']('\x1b[36m[Info]\x1b[0m\x20'+_0x17b0db),server_log_log=_0x36ec93=>console['log'](_0x129c44(0x207)+_0x36ec93),processName=_0x3dc26b=>wanakana[_0x129c44(0x193)](_0x3dc26b[_0x129c44(0x1ef)](/ /g,'_'))[_0x129c44(0x1ef)](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0x129c44(0x1f2),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8;let inactivityTimer;function _0xfe6d(_0x20028c,_0x2028dd){const _0x5e90d3=_0x5e90();return _0xfe6d=function(_0xfe6d98,_0x1ddb84){_0xfe6d98=_0xfe6d98-0x160;let _0x489d20=_0x5e90d3[_0xfe6d98];return _0x489d20;},_0xfe6d(_0x20028c,_0x2028dd);}const resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{const _0x38eb55=_0xfe6d;process[_0x38eb55(0x1c0)](0x7c);},INACTIVITY_TIMEOUT);};function startSshForwarding(_0x23527c,_0x477989,_0x3666b9){const _0x108782=_0x129c44;if(!_0x23527c||!username||!ssh_password)return;const _0x18e5b7=_0x3666b9==='vc',_0x8d9d3b=_0x18e5b7?_0x108782(0x16b):_0x108782(0x1f6),_0x4c3517={'host':'tcpexposer.com','port':0x16,'username':username,'password':ssh_password},_0x47121a={'remoteAddr':_0x23527c,'remotePort':0x50,'localAddr':'localhost','localPort':_0x477989},_0x11e25c=new Client();return _0x11e25c['on']('ready',()=>{const _0x43905f=_0x108782;_0x11e25c[_0x43905f(0x1e8)](_0x47121a['remoteAddr'],_0x47121a['remotePort'],_0x5b57a0=>{const _0x3ae57f=_0x43905f;if(_0x5b57a0)return console[_0x3ae57f(0x1b7)](_0x8d9d3b+_0x3ae57f(0x1eb)+_0x23527c+'):',_0x5b57a0[_0x3ae57f(0x202)]),server_log_info(_0x8d9d3b+_0x3ae57f(0x167)),connectToRelayServer(_0x3666b9),_0x11e25c['end']();console[_0x3ae57f(0x1e0)](_0x3ae57f(0x1f7)),_0x18e5b7?(useRelay=![],vc_connected=!![],server_log_info(_0x3ae57f(0x162)+_0x23527c),server_log_info(_0x3ae57f(0x17a)),server_log_info(_0x3ae57f(0x1bb)),server_log_info('https://proximity-vc-mcbe.pages.dev?roomid='+_0x23527c)):(server_log_info(_0x3ae57f(0x1a2)),server_log_info(_0x3ae57f(0x172)),server_log_info('/connect\x20'+_0x23527c+'.tcpexposer.com')),console[_0x3ae57f(0x1e0)](_0x3ae57f(0x20a));}),_0x11e25c['on']('tcp\x20connection',(_0xe4e5c8,_0x414acb)=>{const _0xac1a3=_0x43905f,_0x94f5d9=_0x414acb(),_0x533014=net['createConnection']({'host':_0x47121a[_0xac1a3(0x1d5)],'port':_0x47121a[_0xac1a3(0x1ab)]});_0x533014['on']('connect',()=>_0x94f5d9['pipe'](_0x533014)['pipe'](_0x94f5d9)),_0x533014['on'](_0xac1a3(0x1b7),_0x2f0ece=>{const _0xf905a5=_0xac1a3;console[_0xf905a5(0x1b7)](_0xf905a5(0x1b0)+_0x23527c+'):',_0x2f0ece[_0xf905a5(0x202)]),_0x94f5d9['close']();}),_0x94f5d9['on'](_0xac1a3(0x206),()=>_0x533014['end']());});})['on'](_0x108782(0x1b7),_0x312640=>{const _0x4f8deb=_0x108782;console[_0x4f8deb(0x1b7)]('❌\x20SSH\x20Error\x20('+_0x23527c+'):',_0x312640['message']),server_log_info(_0x8d9d3b+_0x4f8deb(0x167)),connectToRelayServer(_0x3666b9);}),_0x11e25c[_0x108782(0x1d0)](_0x4c3517),_0x11e25c;}function _0x5e90(){const _0x29e394=['Changed\x20max\x20distance\x20to\x20','参加者はこのURLにアクセスしてください:','https://proximity-vc-mcbe.pages.dev?roomid=','name','参加:\x20','victim','?clientType=server_script','post','proximity','initialization','enabled','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','status','WebSocketメッセージの解析に失敗:','roomId','\x0aYour\x20VCname\x20is\x20','Proximity\x20VC\x20disabled','Spectator`s\x20VC\x20separated\x20by\x20dimension','<近接VC>言語を日本語に設定しました','OPEN','\x20WebSocket\x20error:','\x20処理中にエラーが発生しました:','type','split','ws://127.0.0.1:','body','toRomaji','string','スペクテイターが他モードプレイヤーの会話を聞けるようになました','random','open','\x20スペクテイター同士の会話をディメンションごとに分けました','readFileSync','49124SicMGh','接続を開始しました\x0a近接vc：','utf8','value','specListen','readyState','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','socket-be','Minecraftから以下のコマンドで接続してください:','entries','[VC\x20Relay]\x20メッセージ処理エラー:','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','get-port','\x20Relay\x20server\x20disconnected\x20(ID:\x20','createServer','https://','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使うゲーマータグを確認できます','localPort','assign','[MC\x20Local\x20WS\x20Error]','声の最大距離を','に変更しました','ローカル接続エラー\x20(','name_command','spectators','sender','4482328OdeEjJ','Password\x20is\x20','testfor\x20@e[type=player]','error','PlayerChat','スペクテイター同士の会話を共通にしました','\x20Relay\x20server\x20connected\x20(ID:\x20','Participants\x20should\x20access\x20this\x20URL','90040bgyIas','includes','Proximity\x20VC\x20enabled','近接vcを無効にしました','exit','players','floor','json5','196AyCQur','wss://','1170845XwGPbX','\x0aMax\x20distance:','sendMessage','です\x0aあなたのVCnameは','runCommand','<Proximity\x20VC>Language\x20set\x20to\x20English','退出:\x20','specDim','position','alive','connect','Error\x20handling\x20world:','indexOf','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','disconnect_command','localAddr','WorldRemove','パスワードを有効にしました','clients','testfor\x20@a[m=spectator]','PlayerLoad','all','action','Open','スペクテイターを共通のVCにしました','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20GamerTag','log','net','distance','end','Spectator\x20and\x20VC\x20separated','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','dimensions','\x0a声の届く距離：','forwardIn','querytarget\x20@e[type=player]','world_update','❌\x20ポートフォワーディング失敗\x20(','Server','lang','send','replace','/room/','/create-room','mcproxvc.tcpexposer.com','values','toString','parse','[MC\x20SSH]','\x0a=======================================================','パスワードは','spectator','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','\x0a!help\x20for\x20command\x20list','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','false','from','connection','35916aNnORh','details','message','json','パスワードを無効にしました','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','close','\x1b[33m[Log]\x1b[0m\x20','localPlayer','スペクテイターとVCを分けました','=======================================================\x0a','stringify','socket-beサーバーのポート:\x20','wanakana','yRots','❌\x20設定ファイルの更新に失敗しました:','Asia/Tokyo','correlationId','ROOM\x20ID:\x20','disabled','664890XDdWXp','Password\x20enabled','Spectator\x20set\x20to\x20common\x20VC','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','[VC\x20Relay]','true','/connect\x20','[VC\x20SSH]','writeFileSync','接続終了:\x20','332862jgCBck','近接vcを有効にしました','dimension','Connection\x20started\x0aProximity\x20voice\x20chat:','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','Password\x20disabled','SIGINT','forEach','use','data_update','password'];_0x5e90=function(){return _0x29e394;};return _0x5e90();}async function setupWebSocketServer(){const _0x8ebb16=_0x129c44;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0x8ebb16(0x1ec))]({'port':web_port}),wss['on'](_0x8ebb16(0x1ff),_0x3646e9=>{const _0x3339ac=_0x8ebb16;_0x3646e9['on'](_0x3339ac(0x202),_0x3cdde5=>{const _0x19c22c=_0x3339ac;try{const {userName:_0xbb433,position:_0x416268}=JSON[_0x19c22c(0x1f5)](_0x3cdde5);if(_0xbb433&&_0x416268)positions[_0xbb433]=_0x416268;}catch(_0x3704cb){console['error'](_0x19c22c(0x186),_0x3704cb);}}),_0x3646e9['on']('error',_0x2ba5b4=>console[_0x3339ac(0x1b7)]('WebSocket\x20error:',_0x2ba5b4));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x8ebb16(0x1e0)](_0x8ebb16(0x1f7)),server_log_info('Minecraftから以下のコマンドで接続してください:'),server_log_info(_0x8ebb16(0x172)),server_log_info('/connect\x20localhost:'+port),console[_0x8ebb16(0x1e0)](_0x8ebb16(0x20a));process['on'](_0x8ebb16(0x174),()=>{const _0x1f5819=_0x8ebb16;console['log']('終了シグナル受信。SSH接続を停止します...');if(vcSSHClient)vcSSHClient[_0x1f5819(0x1e3)]();if(mcSSHClient)mcSSHClient['end']();process[_0x1f5819(0x1c0)]();});}function broadcastPositions(){const _0x1cae6d=_0x129c44,_0x914fcb=JSON[_0x1cae6d(0x20b)]({'type':_0x1cae6d(0x1ea),'dimentions':dimensions,'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimensions':dimensions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x1cae6d(0x19f)]===WebSocket[_0x1cae6d(0x18c)])relayWs[_0x1cae6d(0x1ee)](_0x914fcb);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x1cae6d(0x1d8)][_0x1cae6d(0x175)](_0x370042=>{const _0x5b69e2=_0x1cae6d;_0x370042[_0x5b69e2(0x19f)]===WebSocket['OPEN']&&_0x370042[_0x5b69e2(0x1ee)](_0x914fcb);});}async function handleWorld(_0x1d927d){const _0x32e513=_0x129c44;try{const _0x4a9255=Array[_0x32e513(0x1fe)](_0x1d927d[_0x32e513(0x1c1)][_0x32e513(0x1f3)](),_0x396cf8=>String(_0x396cf8['name']));let _0x1dfbc0={};if(proximity){const [_0x2442a2,_0x5cee44,_0x583f92]=await Promise[_0x32e513(0x1db)]([_0x1d927d[_0x32e513(0x1ca)](_0x32e513(0x1b6)),_0x1d927d['runCommand'](_0x32e513(0x1d9)),_0x1d927d[_0x32e513(0x1ca)](_0x32e513(0x1e9))]);_0x1dfbc0={'alive':_0x2442a2[_0x32e513(0x17e)]||[],'spectators':_0x5cee44[_0x32e513(0x17e)]||[],'details':JSON[_0x32e513(0x1f5)](_0x583f92['details']||'[]')};}_0x4a9255['forEach'](_0x33d9f1=>{const _0x5dc9cf=_0x32e513;resetTimer();let _0x2b419f;if(proximity)_0x2b419f=_0x1dfbc0[_0x5dc9cf(0x1cf)][_0x5dc9cf(0x1d2)](_0x33d9f1);const _0x56a190=processName(_0x33d9f1);_0x1dfbc0[_0x5dc9cf(0x1b2)][_0x5dc9cf(0x1bd)](_0x33d9f1)?spectators[_0x56a190]=!![]:spectators[_0x56a190]=![];if(!proximity)positions[_0x56a190]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x1dfbc0[_0x5dc9cf(0x1cf)]['includes'](_0x33d9f1))positions[_0x56a190]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x1dfbc0[_0x5dc9cf(0x1b2)][_0x5dc9cf(0x1bd)](_0x33d9f1)){if(specListen===!![])positions[_0x56a190]=_0x1dfbc0[_0x5dc9cf(0x201)][_0x2b419f][_0x5dc9cf(0x1ce)];else positions[_0x56a190]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimensions[_0x56a190]=_0x1dfbc0[_0x5dc9cf(0x201)][_0x2b419f][_0x5dc9cf(0x170)];}else _0x1dfbc0[_0x5dc9cf(0x201)][_0x2b419f]?.[_0x5dc9cf(0x1ce)]?(positions[_0x56a190]=_0x1dfbc0[_0x5dc9cf(0x201)][_0x2b419f][_0x5dc9cf(0x1ce)],yRots[_0x56a190]=_0x1dfbc0[_0x5dc9cf(0x201)][_0x2b419f]['yRot'],dimensions[_0x56a190]=_0x1dfbc0[_0x5dc9cf(0x201)][_0x2b419f][_0x5dc9cf(0x170)]):positions[_0x56a190]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x56aad8){console['error'](_0x32e513(0x1d1),_0x56aad8);}if(!stop_roop)setTimeout(()=>handleWorld(_0x1d927d),0x64);}async function connectToRelayServer(_0x282f6c){const _0x3e8a5d=_0x129c44,_0x4ede39=_0x282f6c==='mc',_0x15c560=_0x4ede39?'[MC\x20Relay]':_0x3e8a5d(0x168);try{const _0x1fa1e0=await fetch(_0x3e8a5d(0x1a9)+RELAY_SERVER_DOMAIN+_0x3e8a5d(0x1f1)),_0x364770=await _0x1fa1e0[_0x3e8a5d(0x203)](),_0x3638d0=_0x364770[_0x3e8a5d(0x187)];if(!_0x4ede39)roomId=_0x3638d0;console[_0x3e8a5d(0x1e0)](_0x3e8a5d(0x1f7));_0x4ede39?(server_log_info(_0x3e8a5d(0x1a2)),server_log_info(_0x3e8a5d(0x172)),server_log_info(_0x3e8a5d(0x16a)+RELAY_SERVER_DOMAIN+_0x3e8a5d(0x1f0)+_0x3638d0)):(useRelay=!![],vc_connected=!![],server_log_info(_0x3e8a5d(0x162)+_0x3638d0),server_log_info(_0x3e8a5d(0x17a)),server_log_info('Participants\x20should\x20access\x20this\x20URL'),server_log_info(_0x3e8a5d(0x17b)+_0x3638d0));console[_0x3e8a5d(0x1e0)](_0x3e8a5d(0x20a));const _0x6dc34d=new WebSocket(_0x3e8a5d(0x1c5)+RELAY_SERVER_DOMAIN+_0x3e8a5d(0x1f0)+_0x3638d0+_0x3e8a5d(0x17f));if(!_0x4ede39)relayWs=_0x6dc34d;_0x6dc34d['on'](_0x3e8a5d(0x197),()=>console['log'](_0x15c560+_0x3e8a5d(0x1ba)+_0x3638d0+')')),_0x6dc34d['on'](_0x3e8a5d(0x206),()=>console[_0x3e8a5d(0x1e0)](_0x15c560+_0x3e8a5d(0x1a7)+_0x3638d0+')')),_0x6dc34d['on'](_0x3e8a5d(0x1b7),_0x50ee57=>console[_0x3e8a5d(0x1b7)](_0x15c560+_0x3e8a5d(0x18d),_0x50ee57)),_0x4ede39?setupMcRelayListeners(_0x6dc34d):setupVcRelayListeners(_0x6dc34d);}catch(_0x15b856){console[_0x3e8a5d(0x1b7)](_0x15c560+_0x3e8a5d(0x18e),_0x15b856);}}function setupVcRelayListeners(_0x10d214){_0x10d214['on']('message',async _0x15e232=>{const _0x29eb71=_0xfe6d;try{const _0xd782d5=JSON['parse'](_0x15e232['toString']());if(mainWorld&&_0xd782d5[_0x29eb71(0x1dc)]==='run_command'&&typeof _0xd782d5[_0x29eb71(0x19d)]===_0x29eb71(0x194)){const _0x204aa5=await mainWorld[_0x29eb71(0x1ca)](_0xd782d5[_0x29eb71(0x19d)]);_0x10d214[_0x29eb71(0x1ee)](JSON[_0x29eb71(0x20b)]({'type':'command_result','payload':_0x204aa5}));}}catch(_0x273f7f){console[_0x29eb71(0x1b7)](_0x29eb71(0x1a4),_0x273f7f);}});}function name_command(_0x3c348e){const _0x442d9b=_0x129c44,_0x114906=processName(_0x3c348e);!passwords[_0x114906]&&(passwords[_0x114906]=Math[_0x442d9b(0x1c2)](0x3e8+Math['random']()*0x2328)[_0x442d9b(0x1f4)]());const _0x596a97=lang==='ja'?'パスワードは'+passwords[_0x114906]+'です':_0x442d9b(0x1b5)+passwords[_0x114906];return _0x596a97;}function data_update(_0x8cc88){const _0xc97f1d=_0x129c44;shouldBroadcast=!![],resetTimer();for(const [_0x4d433f,_0x29360a]of Object[_0xc97f1d(0x1a3)](_0x8cc88)){switch(_0x4d433f){case _0xc97f1d(0x18f):continue;case _0xc97f1d(0x181):_0x29360a!==proximity&&(updateConfig(_0x4d433f,_0x29360a),proximity=_0x29360a);break;case'positions':positions=_0x29360a;break;case _0xc97f1d(0x1e2):_0x29360a!==distance&&(updateConfig(_0x4d433f,_0x29360a),distance=_0x29360a);break;case _0xc97f1d(0x1f9):_0x29360a!==spectator&&(updateConfig(_0x4d433f,_0x29360a),spectator=_0x29360a);break;case _0xc97f1d(0x1b2):spectators=_0x29360a;break;case _0xc97f1d(0x19e):_0x29360a!==specListen&&(updateConfig(_0x4d433f,_0x29360a),specListen=_0x29360a);break;case _0xc97f1d(0x1cd):_0x29360a!==specDim&&(updateConfig(_0x4d433f,_0x29360a),specDim=_0x29360a);break;case _0xc97f1d(0x1e6):dimensions=_0x29360a;break;case _0xc97f1d(0x20e):yRots=_0x29360a;break;case'password':_0x29360a!==password&&(updateConfig(_0x4d433f,_0x29360a),password=_0x29360a);case'lang':_0x29360a!==lang&&(updateConfig(_0x4d433f,_0x29360a),lang=_0x29360a);break;}}}function setupMcRelayListeners(_0x3a3b46){const _0x4d10ce=_0x129c44;let _0x3a800e;_0x3a3b46['on'](_0x4d10ce(0x202),async _0x535421=>{const _0x5e515f=_0x4d10ce;try{const _0x2c1e7a=JSON[_0x5e515f(0x1f5)](_0x535421[_0x5e515f(0x1f4)]());if(_0x2c1e7a[_0x5e515f(0x18f)]==='partner_connected'){console[_0x5e515f(0x1e0)](_0x5e515f(0x1d3)),_0x3a800e=new WebSocket(_0x5e515f(0x191)+port),_0x3a800e['on'](_0x5e515f(0x197),()=>console[_0x5e515f(0x1e0)]('[MC\x20Relay]\x20ローカルのsocket-beに接続成功。')),_0x3a800e['on'](_0x5e515f(0x202),_0x24a278=>_0x3a3b46[_0x5e515f(0x19f)]===WebSocket[_0x5e515f(0x18c)]&&_0x3a3b46[_0x5e515f(0x1ee)](_0x24a278)),_0x3a800e['on'](_0x5e515f(0x206),()=>_0x3a3b46[_0x5e515f(0x19f)]===WebSocket[_0x5e515f(0x18c)]&&_0x3a3b46[_0x5e515f(0x206)]()),_0x3a800e['on'](_0x5e515f(0x1b7),_0x5133c2=>console[_0x5e515f(0x1b7)](_0x5e515f(0x1ad),_0x5133c2['message']));return;}else{if(_0x2c1e7a[_0x5e515f(0x18f)]===_0x5e515f(0x1b1))try{const _0x36f73c=name_command(_0x2c1e7a[_0x5e515f(0x1b3)]),_0xf19b88={'type':_0x5e515f(0x1b1),'message':_0x36f73c,'correlationId':_0x2c1e7a[_0x5e515f(0x161)]};_0x3a3b46[_0x5e515f(0x1ee)](JSON[_0x5e515f(0x20b)](_0xf19b88));}catch(_0x3f326f){console['log'](_0x3f326f);}else{if(_0x2c1e7a[_0x5e515f(0x18f)]===_0x5e515f(0x182))try{mc_connected=!![];const _0x18246a=JSON['stringify']({'type':_0x5e515f(0x182),'roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang,'correlationId':_0x2c1e7a[_0x5e515f(0x161)]});_0x3a3b46[_0x5e515f(0x1ee)](_0x18246a);}catch(_0x1ffbbb){console[_0x5e515f(0x1e0)](_0x1ffbbb);}else{if(_0x2c1e7a[_0x5e515f(0x18f)]===_0x5e515f(0x177))try{data_update(_0x2c1e7a);}catch(_0xcade94){console[_0x5e515f(0x1e0)](_0xcade94);}else _0x2c1e7a['type']===_0x5e515f(0x1d4)&&process[_0x5e515f(0x1c0)](0x0);}}}}catch(_0x31f9ca){}_0x3a800e?.[_0x5e515f(0x19f)]===WebSocket[_0x5e515f(0x18c)]&&_0x3a800e['send'](_0x535421);}),_0x3a3b46['on'](_0x4d10ce(0x206),()=>_0x3a800e?.['close']());}function updateConfig(_0x15ef51,_0x5c2e91){const _0x5c55ef=_0x129c44;try{let _0x17d7dd=fs[_0x5c55ef(0x199)](configPath,_0x5c55ef(0x19c));const _0x339b52=new RegExp('(\x22'+_0x15ef51+_0x5c55ef(0x1fc)),_0x5a1088=typeof _0x5c2e91===_0x5c55ef(0x194)?'\x22'+_0x5c2e91+'\x22':_0x5c2e91,_0x4c8f84=_0x17d7dd[_0x5c55ef(0x1ef)](_0x339b52,'$1'+_0x5a1088);_0x4c8f84!==_0x17d7dd&&fs[_0x5c55ef(0x16c)](configPath,_0x4c8f84,_0x5c55ef(0x19c));}catch(_0x5ebb9f){console[_0x5c55ef(0x1b7)](_0x5c55ef(0x20f),_0x5ebb9f);}};async function main(){const _0x4a1cb5=_0x129c44;resetTimer(),port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x4a1cb5(0x20c)+port);const _0x5a6c2e=express(),_0x486182=http[_0x4a1cb5(0x1a8)](_0x5a6c2e);_0x486182['listen'](port);const _0x276631=new Server({'webSocketOptions':{'server':_0x486182},'timezone':_0x4a1cb5(0x160),'disableEncryption':!![]});_0x5a6c2e[_0x4a1cb5(0x176)](express[_0x4a1cb5(0x203)]()),_0x5a6c2e[_0x4a1cb5(0x180)]('/',(_0x342c12,_0x33d390)=>{const _0x1e8106=_0x4a1cb5;if(_0x342c12[_0x1e8106(0x192)][_0x1e8106(0x18f)]===_0x1e8106(0x1b1)){const _0x44f7d6=name_command(_0x342c12['body'][_0x1e8106(0x1b3)]),_0x233a8b={'type':_0x1e8106(0x1b1),'message':_0x44f7d6};_0x33d390['status'](0xc8)[_0x1e8106(0x203)](_0x233a8b);}else{if(_0x342c12[_0x1e8106(0x192)][_0x1e8106(0x18f)]===_0x1e8106(0x182)){mc_connected=!![];const _0x503ec6={'type':'initialization','roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang};_0x33d390['status'](0xc8)[_0x1e8106(0x203)](_0x503ec6);}else{if(_0x342c12[_0x1e8106(0x192)][_0x1e8106(0x18f)]==='data_update')data_update(_0x342c12[_0x1e8106(0x192)]),_0x33d390[_0x1e8106(0x185)](0xc8)[_0x1e8106(0x203)]({'success':!![]});else _0x342c12[_0x1e8106(0x192)][_0x1e8106(0x18f)]===_0x1e8106(0x1d4)&&process['exit'](0x0);}}});const _0x275dbe=(_0x21c55e,_0x5d4896,_0x12983e)=>async(_0x170a1c,_0x1d90f2,_0x498c49)=>{const _0x5dd4f6=_0x4a1cb5;if(_0x1d90f2[_0x5dd4f6(0x17c)]!==_0x170a1c['localPlayer'][_0x5dd4f6(0x17c)])return;if(_0x498c49[0x0]!==_0x5dd4f6(0x169)&&_0x498c49[0x0]!==_0x5dd4f6(0x1fd))return;const _0x4b29ca=_0x498c49[0x0]===_0x5dd4f6(0x169);if(_0x21c55e===_0x5dd4f6(0x178))password=_0x4b29ca;else{if(_0x21c55e===_0x5dd4f6(0x181))proximity=_0x4b29ca;else{if(_0x21c55e===_0x5dd4f6(0x1f9))spectator=_0x4b29ca;else{if(_0x21c55e===_0x5dd4f6(0x19e))specListen=_0x4b29ca;else{if(_0x21c55e===_0x5dd4f6(0x1cd))specDim=_0x4b29ca;}}}}updateConfig(_0x21c55e,_0x4b29ca),Object[_0x5dd4f6(0x1ac)](global,{[_0x21c55e]:_0x4b29ca});const _0x482aa0=lang==='ja'?_0x4b29ca?_0x5d4896[_0x5dd4f6(0x183)]:_0x5d4896[_0x5dd4f6(0x163)]:_0x4b29ca?_0x12983e[_0x5dd4f6(0x183)]:_0x12983e[_0x5dd4f6(0x163)];await _0x170a1c[_0x5dd4f6(0x1c8)](_0x482aa0);},_0x4df99c={'!dis':async(_0x4f6064,_0x57f1b2,_0x52e54e)=>{const _0x25f696=_0x4a1cb5;try{if(_0x57f1b2['name']!==_0x4f6064[_0x25f696(0x208)][_0x25f696(0x17c)])return;const _0xc234a7=Number(_0x52e54e[0x0]);if(!isNaN(_0xc234a7)){distance=_0xc234a7,updateConfig(_0x25f696(0x1e2),_0xc234a7);const _0x2a7a20=lang==='ja'?_0x25f696(0x1ae)+distance+_0x25f696(0x1af):_0x25f696(0x179)+distance;await _0x4f6064[_0x25f696(0x1c8)](_0x2a7a20);}}catch(_0x4c0695){}},'!name':async(_0x2ae709,_0x57c8fc)=>{const _0x3a2d0f=_0x4a1cb5;try{const _0x3788d5=processName(_0x57c8fc['name']),_0x4d301b='URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは'+roomId+_0x3a2d0f(0x1c9)+_0x3788d5+'です',_0x3d86a6='URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20'+roomId+'\x0aYour\x20VCname\x20is\x20'+_0x3788d5;await _0x57c8fc[_0x3a2d0f(0x1c8)](lang==='ja'?_0x4d301b:_0x3d86a6);if(password){!passwords[_0x3788d5]&&(passwords[_0x3788d5]=Math[_0x3a2d0f(0x1c2)](0x3e8+Math['random']()*0x2328)[_0x3a2d0f(0x1f4)]());const _0x585138=lang==='ja'?'パスワードは'+passwords[_0x3788d5]+'です':_0x3a2d0f(0x1b5)+passwords[_0x3788d5];await _0x57c8fc['sendMessage'](_0x585138);}}catch(_0x2687d5){}},'!password':_0x275dbe(_0x4a1cb5(0x178),{'enabled':_0x4a1cb5(0x1d7),'disabled':_0x4a1cb5(0x204)},{'enabled':_0x4a1cb5(0x165),'disabled':_0x4a1cb5(0x173)}),'!pvc':_0x275dbe(_0x4a1cb5(0x181),{'enabled':_0x4a1cb5(0x16f),'disabled':_0x4a1cb5(0x1bf)},{'enabled':_0x4a1cb5(0x1be),'disabled':_0x4a1cb5(0x189)}),'!spectator':_0x275dbe(_0x4a1cb5(0x1f9),{'enabled':_0x4a1cb5(0x209),'disabled':_0x4a1cb5(0x1de)},{'enabled':_0x4a1cb5(0x1e4),'disabled':_0x4a1cb5(0x166)}),'!specListen':_0x275dbe(_0x4a1cb5(0x19e),{'enable':_0x4a1cb5(0x195),'disable':'スペクテイターが他モードプレイヤーの会話を聞けなくなりました'},{'enable':_0x4a1cb5(0x184),'disable':_0x4a1cb5(0x1a5)}),'!specDim':_0x275dbe(_0x4a1cb5(0x1cd),{'enable':_0x4a1cb5(0x198),'disable':_0x4a1cb5(0x1b9)},{'enable':_0x4a1cb5(0x18a),'disable':_0x4a1cb5(0x1fa)}),'!lang':async(_0x819e7c,_0x4f9691,_0x511989)=>{const _0x55d3a3=_0x4a1cb5;try{if(_0x4f9691[_0x55d3a3(0x17c)]!==_0x819e7c[_0x55d3a3(0x208)][_0x55d3a3(0x17c)])return;const _0x3fb505=_0x511989[0x0]==='ja'?'ja':'en';lang=_0x3fb505,updateConfig(_0x55d3a3(0x1ed),_0x3fb505);const _0x5a42d4=_0x3fb505==='ja'?_0x55d3a3(0x18b):_0x55d3a3(0x1cb);await _0x819e7c['sendMessage'](_0x5a42d4);}catch(_0x19ce43){}},'!help':async(_0x37dfcf,_0x158d1e)=>{const _0x1197cb=_0x4a1cb5;try{await _0x158d1e[_0x1197cb(0x1c8)]('--------------------');if(lang=='ja'){await _0x158d1e[_0x1197cb(0x1c8)](_0x1197cb(0x1aa));const _0x5e15fe=_0x37dfcf['localPlayer'][_0x1197cb(0x17c)];_0x158d1e[_0x1197cb(0x17c)]==_0x5e15fe&&await _0x158d1e[_0x1197cb(0x1c8)]('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x158d1e[_0x1197cb(0x1c8)](_0x1197cb(0x1df));const _0x5069b4=_0x37dfcf[_0x1197cb(0x208)][_0x1197cb(0x17c)];_0x158d1e[_0x1197cb(0x17c)]==_0x5069b4&&await _0x158d1e[_0x1197cb(0x1c8)](_0x1197cb(0x1a0));}await _0x158d1e[_0x1197cb(0x1c8)]('--------------------');}catch(_0x2060a0){}}};_0x276631['on'](ServerEvent[_0x4a1cb5(0x1b8)],async({sender:_0x30311c,message:_0x50aaf3,world:_0x38bb6a})=>{const _0xe5eff3=_0x4a1cb5,[_0x35fa90,..._0x5d0da0]=_0x50aaf3[_0xe5eff3(0x190)]('\x20');if(_0x4df99c[_0x35fa90])await _0x4df99c[_0x35fa90](_0x38bb6a,_0x30311c,_0x5d0da0);}),_0x276631['on'](ServerEvent[_0x4a1cb5(0x1dd)],()=>setupWebSocketServer()),_0x276631['on'](ServerEvent['WorldAdd'],async({world:_0x3b8511})=>{const _0x161865=_0x4a1cb5;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x3b8511,stop_roop=![],server_log_info('接続開始:\x20'+_0x3b8511[_0x161865(0x17c)]);if(lang=='ja'){let _0x23b9b1='';proximity?_0x23b9b1='有効':_0x23b9b1='無効',_0x3b8511[_0x161865(0x1c8)](_0x161865(0x19b)+_0x23b9b1+_0x161865(0x1e7)+distance+'\x0a!help\x20でコマンド一覧を確認できます');}else{let _0x449203='';proximity?_0x449203=_0x161865(0x183):_0x449203='disabled',_0x3b8511['sendMessage'](_0x161865(0x171)+_0x449203+_0x161865(0x1c7)+distance+_0x161865(0x1fb));}await handleWorld(_0x3b8511);}),_0x276631['on'](ServerEvent[_0x4a1cb5(0x1d6)],({world:_0x462762})=>{const _0x13fb7d=_0x4a1cb5;mainWorld=null,stop_roop=!![],server_log_info(_0x13fb7d(0x16d)+_0x462762[_0x13fb7d(0x17c)]);}),_0x276631['on'](ServerEvent[_0x4a1cb5(0x1da)],async({player:_0x16f733,world:_0x5e26dc})=>{const _0x40ef3d=_0x4a1cb5;server_log_info(_0x40ef3d(0x17d)+_0x16f733[_0x40ef3d(0x17c)]);const _0x1b1912=setInterval(async()=>{const _0x1c72cb=_0x40ef3d;try{const _0x40a3d0=processName(_0x16f733['name']),_0x54f211=_0x1c72cb(0x205)+roomId+_0x1c72cb(0x1c9)+_0x40a3d0+'です',_0x32d645=_0x1c72cb(0x1e5)+roomId+_0x1c72cb(0x188)+_0x40a3d0;await _0x16f733[_0x1c72cb(0x1c8)](lang==='ja'?_0x54f211:_0x32d645);if(password){!passwords[_0x40a3d0]&&(passwords[_0x40a3d0]=Math[_0x1c72cb(0x1c2)](0x3e8+Math[_0x1c72cb(0x196)]()*0x2328)[_0x1c72cb(0x1f4)]());const _0xc7648d=lang==='ja'?_0x1c72cb(0x1f8)+passwords[_0x40a3d0]+'です':'Password\x20is\x20'+passwords[_0x40a3d0];await _0x16f733[_0x1c72cb(0x1c8)](_0xc7648d);}clearInterval(_0x1b1912);}catch(_0x4c7655){}},0x1f4);}),_0x276631['on'](ServerEvent['PlayerLeave'],({player:_0x9a3d95,world:_0x255387})=>{const _0x26f332=_0x4a1cb5;server_log_info(_0x26f332(0x1cc)+_0x9a3d95[_0x26f332(0x17c)]);const _0xbbc667=_0x255387[_0x26f332(0x208)][_0x26f332(0x17c)];if(_0x9a3d95[_0x26f332(0x17c)]===_0xbbc667)process['exit'](0x0);delete positions[processName(_0x9a3d95[_0x26f332(0x17c)])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info(_0x4a1cb5(0x167)),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
