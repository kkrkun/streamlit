const _0x493580=_0x522f;(function(_0x5bacb9,_0x5ed925){const _0x1b91e7=_0x522f,_0xfa7960=_0x5bacb9();while(!![]){try{const _0x3d1016=parseInt(_0x1b91e7(0x153))/0x1+parseInt(_0x1b91e7(0xc7))/0x2*(parseInt(_0x1b91e7(0xee))/0x3)+-parseInt(_0x1b91e7(0xea))/0x4+parseInt(_0x1b91e7(0x12f))/0x5+-parseInt(_0x1b91e7(0x116))/0x6+-parseInt(_0x1b91e7(0xcb))/0x7+-parseInt(_0x1b91e7(0xce))/0x8*(-parseInt(_0x1b91e7(0x14c))/0x9);if(_0x3d1016===_0x5ed925)break;else _0xfa7960['push'](_0xfa7960['shift']());}catch(_0x22c3e4){_0xfa7960['push'](_0xfa7960['shift']());}}}(_0x27bf,0x4df50));const {Server,ServerEvent}=require(_0x493580(0x13d)),WebSocket=require('ws'),fetch=require(_0x493580(0xd3)),wanakana=require('wanakana'),fs=require('fs'),JSON5=require(_0x493580(0x12d)),getPort=require(_0x493580(0xd5)),{Client}=require('ssh2'),net=require('net'),configPath=_0x493580(0x10b),config=JSON5['parse'](fs['readFileSync'](configPath,'utf8'));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimentions={},shouldBroadcast=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={};const server_log_info=_0x17e1fa=>console['log'](_0x493580(0x11e)+_0x17e1fa),server_log_log=_0x54b1e0=>console[_0x493580(0x151)](_0x493580(0x150)+_0x54b1e0),processName=_0x43560f=>wanakana[_0x493580(0x10d)](_0x43560f[_0x493580(0xcc)](/ /g,'_'))[_0x493580(0xcc)](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0x493580(0xc0);function startSshForwarding(_0xbe1276,_0x35a021,_0x248d1d){const _0x1f9d26=_0x493580;if(!_0xbe1276||!username||!ssh_password)return;const _0x141ead=_0x248d1d==='vc',_0x362895=_0x141ead?_0x1f9d26(0x140):'[MC\x20SSH]',_0x1882eb={'host':_0x1f9d26(0x14e),'port':0x16,'username':username,'password':ssh_password},_0x26faad={'remoteAddr':_0xbe1276,'remotePort':0x50,'localAddr':_0x1f9d26(0xc1),'localPort':_0x35a021},_0x30d11a=new Client();return _0x30d11a['on'](_0x1f9d26(0xbd),()=>{const _0x380af7=_0x1f9d26;_0x30d11a['forwardIn'](_0x26faad[_0x380af7(0x105)],_0x26faad[_0x380af7(0xc8)],_0x1e3e75=>{const _0x1da5ab=_0x380af7;if(_0x1e3e75)return console[_0x1da5ab(0x142)](_0x362895+_0x1da5ab(0xe7)+_0xbe1276+'):',_0x1e3e75[_0x1da5ab(0xf9)]),server_log_info(_0x362895+_0x1da5ab(0xe0)),connectToRelayServer(_0x248d1d),_0x30d11a[_0x1da5ab(0xd1)]();console[_0x1da5ab(0x151)](_0x1da5ab(0x138)),_0x141ead?(server_log_info('ROOM\x20ID:\x20'+_0xbe1276),server_log_info(_0x1da5ab(0x147)),server_log_info('Participants\x20should\x20access\x20this\x20URL'),server_log_info(_0x1da5ab(0x155)+_0xbe1276)):(server_log_info(_0x1da5ab(0xfa)),server_log_info(_0x1da5ab(0xc6)),server_log_info('/connect\x20'+_0xbe1276+_0x1da5ab(0x11f))),console[_0x1da5ab(0x151)](_0x1da5ab(0xfd));}),_0x30d11a['on'](_0x380af7(0xbb),(_0x1144f3,_0x3ca5ce)=>{const _0x5646ea=_0x380af7,_0x15ea84=_0x3ca5ce(),_0x3bb2ad=net[_0x5646ea(0xde)]({'host':_0x26faad[_0x5646ea(0xf8)],'port':_0x26faad[_0x5646ea(0xc9)]});_0x3bb2ad['on'](_0x5646ea(0x10a),()=>_0x15ea84['pipe'](_0x3bb2ad)[_0x5646ea(0xbf)](_0x15ea84)),_0x3bb2ad['on'](_0x5646ea(0x142),_0x54d64d=>{const _0x579521=_0x5646ea;console['error'](_0x579521(0x117)+_0xbe1276+'):',_0x54d64d[_0x579521(0xf9)]),_0x15ea84[_0x579521(0xb4)]();}),_0x15ea84['on']('close',()=>_0x3bb2ad['end']());});})['on'](_0x1f9d26(0x142),_0x2380bd=>{const _0x3c43b0=_0x1f9d26;console[_0x3c43b0(0x142)](_0x3c43b0(0x136)+_0xbe1276+'):',_0x2380bd[_0x3c43b0(0xf9)]),server_log_info(_0x362895+_0x3c43b0(0xe0)),connectToRelayServer(_0x248d1d);}),_0x30d11a[_0x1f9d26(0x10a)](_0x1882eb),_0x30d11a;}async function setupWebSocketServer(){const _0x3af24f=_0x493580;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0x3af24f(0x132))]({'port':web_port}),wss['on'](_0x3af24f(0x12c),_0x4ac8f2=>{const _0x243206=_0x3af24f;_0x4ac8f2['on'](_0x243206(0xf9),_0x419d06=>{const _0xbaaf5d=_0x243206;try{const {userName:_0x2908ed,position:_0x1e8a63}=JSON[_0xbaaf5d(0x11d)](_0x419d06);if(_0x2908ed&&_0x1e8a63)positions[_0x2908ed]=_0x1e8a63;}catch(_0x3e6b98){console['error']('WebSocketメッセージの解析に失敗:',_0x3e6b98);}}),_0x4ac8f2['on']('error',_0x166d68=>console[_0x243206(0x142)](_0x243206(0xd9),_0x166d68));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x3af24f(0x151)](_0x3af24f(0x138)),server_log_info(_0x3af24f(0xfa)),server_log_info(_0x3af24f(0xc6)),server_log_info(_0x3af24f(0x12a)+port),console[_0x3af24f(0x151)]('=======================================================\x0a');process['on']('SIGINT',()=>{const _0x35df7a=_0x3af24f;console[_0x35df7a(0x151)](_0x35df7a(0xb7));if(vcSSHClient)vcSSHClient['end']();if(mcSSHClient)mcSSHClient['end']();process[_0x35df7a(0x107)]();});}function broadcastPositions(){const _0x498517=_0x493580,_0x5b4edd=JSON[_0x498517(0xf4)]({'type':_0x498517(0xd6),'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimentions':dimentions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password==='')&&relayWs?.[_0x498517(0x108)]===WebSocket[_0x498517(0x11a)])relayWs[_0x498517(0x101)](_0x5b4edd);else sub_domain&&username&&ssh_password&&wss[_0x498517(0x131)][_0x498517(0x13a)](_0x5372f9=>{const _0x53c2d3=_0x498517;_0x5372f9[_0x53c2d3(0x108)]===WebSocket[_0x53c2d3(0x11a)]&&_0x5372f9[_0x53c2d3(0x101)](_0x5b4edd);});}async function handleWorld(_0x4c5fed){const _0x35efa3=_0x493580;try{const _0x56f042=Array[_0x35efa3(0xed)](_0x4c5fed[_0x35efa3(0xaf)]['values'](),_0x236dc2=>String(_0x236dc2[_0x35efa3(0x109)]));let _0x16a837={};if(proximity){const [_0x2e11d9,_0x3a6ab7,_0x437dbd]=await Promise[_0x35efa3(0xdb)]([_0x4c5fed[_0x35efa3(0xd0)](_0x35efa3(0xca)),_0x4c5fed[_0x35efa3(0xd0)](_0x35efa3(0x106)),_0x4c5fed[_0x35efa3(0xd0)](_0x35efa3(0xf7))]);_0x16a837={'alive':_0x2e11d9['victim']||[],'spectators':_0x3a6ab7[_0x35efa3(0x118)]||[],'details':JSON[_0x35efa3(0x11d)](_0x437dbd[_0x35efa3(0x14a)]||'[]')};}_0x56f042[_0x35efa3(0x13a)](_0x365c1a=>{const _0x5060c8=_0x35efa3;let _0x1cd3a6;if(proximity)_0x1cd3a6=_0x16a837[_0x5060c8(0x149)][_0x5060c8(0x152)](_0x365c1a);const _0x12ae63=processName(_0x365c1a);_0x16a837['spectators'][_0x5060c8(0xb1)](_0x365c1a)?spectators[_0x12ae63]=!![]:spectators[_0x12ae63]=![];if(!proximity)positions[_0x12ae63]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x16a837[_0x5060c8(0x149)][_0x5060c8(0xb1)](_0x365c1a))positions[_0x12ae63]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x16a837[_0x5060c8(0xb0)][_0x5060c8(0xb1)](_0x365c1a)){if(specListen===!![])positions[_0x12ae63]=_0x16a837[_0x5060c8(0x14a)][_0x1cd3a6][_0x5060c8(0x113)];else positions[_0x12ae63]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimentions[_0x12ae63]=_0x16a837['details'][_0x1cd3a6][_0x5060c8(0x129)];}else _0x16a837[_0x5060c8(0x14a)][_0x1cd3a6]?.[_0x5060c8(0x113)]?(positions[_0x12ae63]=_0x16a837['details'][_0x1cd3a6][_0x5060c8(0x113)],yRots[_0x12ae63]=_0x16a837[_0x5060c8(0x14a)][_0x1cd3a6][_0x5060c8(0xae)],dimentions[_0x12ae63]=_0x16a837[_0x5060c8(0x14a)][_0x1cd3a6][_0x5060c8(0x129)]):positions[_0x12ae63]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x143361){console[_0x35efa3(0x142)]('Error\x20handling\x20world:',_0x143361);}if(!stop_roop)setTimeout(()=>handleWorld(_0x4c5fed),0x64);}async function connectToRelayServer(_0xdf2ee8){const _0x157892=_0x493580,_0x44730a=_0xdf2ee8==='mc',_0x22ecd9=_0x44730a?_0x157892(0xb6):_0x157892(0xf5);try{const _0x150aec=await fetch(_0x157892(0xb9)+RELAY_SERVER_DOMAIN+_0x157892(0xd2)),_0x4bf32a=await _0x150aec[_0x157892(0xb3)](),_0x55e819=_0x4bf32a['roomId'];if(!_0x44730a)roomId=_0x55e819;console[_0x157892(0x151)]('\x0a=======================================================');_0x44730a?(server_log_info('Minecraftから以下のコマンドで接続してください:'),server_log_info(_0x157892(0xc6)),server_log_info(_0x157892(0xe8)+RELAY_SERVER_DOMAIN+'/room/'+_0x55e819)):(server_log_info(_0x157892(0x145)+_0x55e819),server_log_info(_0x157892(0x147)),server_log_info(_0x157892(0xd8)),server_log_info(_0x157892(0x155)+_0x55e819));console[_0x157892(0x151)]('=======================================================\x0a');const _0x51709e=new WebSocket(_0x157892(0x12b)+RELAY_SERVER_DOMAIN+'/room/'+_0x55e819+_0x157892(0x110));if(!_0x44730a)relayWs=_0x51709e;_0x51709e['on']('open',()=>console[_0x157892(0x151)](_0x22ecd9+_0x157892(0xff)+_0x55e819+')')),_0x51709e['on'](_0x157892(0xb4),()=>console[_0x157892(0x151)](_0x22ecd9+'\x20Relay\x20server\x20disconnected\x20(ID:\x20'+_0x55e819+')')),_0x51709e['on'](_0x157892(0x142),_0x1a1014=>console['error'](_0x22ecd9+_0x157892(0xc5),_0x1a1014)),_0x44730a?setupMcRelayListeners(_0x51709e):setupVcRelayListeners(_0x51709e);}catch(_0x330dde){console[_0x157892(0x142)](_0x22ecd9+_0x157892(0x11b),_0x330dde);}}function _0x522f(_0x3f3a53,_0x4359d3){const _0x27bf0a=_0x27bf();return _0x522f=function(_0x522f2b,_0x2ff057){_0x522f2b=_0x522f2b-0xae;let _0x40639c=_0x27bf0a[_0x522f2b];return _0x40639c;},_0x522f(_0x3f3a53,_0x4359d3);}function _0x27bf(){const _0x282530=['/connect\x20','Spectator\x20set\x20to\x20common\x20VC','1383316JLAVki','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','proximity','from','974061PJUyHb','パスワードを無効にしました','パスワードは','スペクテイター同士の会話を共通にしました','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20name','disabled','stringify','[VC\x20Relay]','Password\x20is\x20','querytarget\x20@e[type=player]','localAddr','message','Minecraftから以下のコマンドで接続してください:','PlayerLoad','floor','=======================================================\x0a','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','\x20Relay\x20server\x20connected\x20(ID:\x20','specListen','send','Password\x20disabled','\x0aYour\x20VCname\x20is\x20','enabled','remoteAddr','testfor\x20@a[m=spectator]','exit','readyState','name','connect','./config.json','参加:\x20','toRomaji','command_result','value','?clientType=server_script','Open','distance','position','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','近接vcを無効にしました','3422298kLHvVR','ローカル接続エラー\x20(','victim','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','OPEN','\x20処理中にエラーが発生しました:','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','parse','\x1b[36m[Info]\x1b[0m\x20','.tcpexposer.com','split','partner_connected','Changed\x20max\x20distance\x20to\x20','\x0aMax\x20distance:','Spectator`s\x20VC\x20separated\x20by\x20dimension','Proximity\x20VC\x20enabled','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使う名前を確認できます','に変更しました','WorldRemove','dimension','/connect\x20localhost:','wss://','connection','json5','[VC\x20Relay]\x20メッセージ処理エラー:','555720DObdhs','run_command','clients','Server','\x20スペクテイター同士の会話をディメンションごとに分けました','です\x0aあなたのVCnameは','\x0a!help\x20でコマンド一覧を確認できます','❌\x20SSH\x20Error\x20(','--------------------','\x0a=======================================================','Password\x20enabled','forEach','❌\x20設定ファイルの更新に失敗しました:','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','socket-be','sendMessage','[MC\x20Local\x20WS\x20Error]','[VC\x20SSH]','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','error','ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます','random','ROOM\x20ID:\x20','接続終了:\x20','参加者はこのURLにアクセスしてください:','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','alive','details','退出:\x20','7539354edGolA','\x0a!help\x20for\x20command\x20list','tcpexposer.com','string','\x1b[33m[Log]\x1b[0m\x20','log','indexOf','421759yqRjYS','socket-beサーバーのポート:\x20','https://proximity-vc-mcbe.pages.dev?roomid=','yRot','players','spectators','includes','utf8','json','close','<Proximity\x20VC>Language\x20set\x20to\x20English','[MC\x20Relay]','終了シグナル受信。SSH接続を停止します...','接続開始:\x20','https://','toString','tcp\x20connection','スペクテイターとVCを分けました','ready','false','pipe','mcproxvc.tcpexposer.com','localhost','type','localPlayer','ws://127.0.0.1:','\x20WebSocket\x20error:','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','2SmlRvN','remotePort','localPort','testfor\x20@e[type=player]','3218404lFgMOD','replace','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','8ZJTnKS','スペクテイターが他モードプレイヤーの会話を聞けるようになました','runCommand','end','/create-room','node-fetch','近接vcを有効にしました','get-port','world_update','Proximity\x20VC\x20disabled','Participants\x20should\x20access\x20this\x20URL','WebSocket\x20error:','<近接VC>言語を日本語に設定しました','all','true','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','createConnection','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','open','WorldAdd','assign','spectator','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','specDim','❌\x20ポートフォワーディング失敗\x20('];_0x27bf=function(){return _0x282530;};return _0x27bf();}function setupVcRelayListeners(_0x4685c4){const _0x55e284=_0x493580;_0x4685c4['on'](_0x55e284(0xf9),async _0x43c99a=>{const _0x319897=_0x55e284;try{const _0x44d0a9=JSON[_0x319897(0x11d)](_0x43c99a[_0x319897(0xba)]());if(mainWorld&&_0x44d0a9['action']===_0x319897(0x130)&&typeof _0x44d0a9[_0x319897(0x10f)]==='string'){const _0x20133a=await mainWorld[_0x319897(0xd0)](_0x44d0a9[_0x319897(0x10f)]);_0x4685c4['send'](JSON[_0x319897(0xf4)]({'type':_0x319897(0x10e),'payload':_0x20133a}));}}catch(_0x54fd85){console[_0x319897(0x142)](_0x319897(0x12e),_0x54fd85);}});}function setupMcRelayListeners(_0x4a74fd){const _0x510b04=_0x493580;let _0x5c7370;_0x4a74fd['on'](_0x510b04(0xf9),_0x5f5c15=>{const _0x495b2f=_0x510b04;try{const _0x17bed3=JSON[_0x495b2f(0x11d)](_0x5f5c15['toString']());if(_0x17bed3[_0x495b2f(0xc2)]===_0x495b2f(0x121)){console[_0x495b2f(0x151)](_0x495b2f(0x114)),_0x5c7370=new WebSocket(_0x495b2f(0xc4)+port),_0x5c7370['on'](_0x495b2f(0xe1),()=>console[_0x495b2f(0x151)](_0x495b2f(0x11c))),_0x5c7370['on'](_0x495b2f(0xf9),_0x2a105c=>_0x4a74fd[_0x495b2f(0x108)]===WebSocket[_0x495b2f(0x11a)]&&_0x4a74fd[_0x495b2f(0x101)](_0x2a105c)),_0x5c7370['on']('close',()=>_0x4a74fd[_0x495b2f(0x108)]===WebSocket[_0x495b2f(0x11a)]&&_0x4a74fd[_0x495b2f(0xb4)]()),_0x5c7370['on'](_0x495b2f(0x142),_0x793941=>console[_0x495b2f(0x142)](_0x495b2f(0x13f),_0x793941[_0x495b2f(0xf9)]));return;}}catch(_0x1f8ddd){}_0x5c7370?.[_0x495b2f(0x108)]===WebSocket[_0x495b2f(0x11a)]&&_0x5c7370['send'](_0x5f5c15);}),_0x4a74fd['on']('close',()=>_0x5c7370?.[_0x510b04(0xb4)]());}async function main(){const _0x27a0cf=_0x493580;port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x27a0cf(0x154)+port);const _0x2b8a47=new Server({'port':port,'disableEncryption':!![],'timezone':'Asia/Tokyo'}),_0x1dd8f0=(_0x2c3c12,_0x1eca21)=>{const _0x5ac1aa=_0x27a0cf;try{let _0x3f9e75=fs['readFileSync'](configPath,_0x5ac1aa(0xb2));const _0x491015=new RegExp('(\x22'+_0x2c3c12+_0x5ac1aa(0xfe)),_0x225e8f=typeof _0x1eca21===_0x5ac1aa(0x14f)?'\x22'+_0x1eca21+'\x22':_0x1eca21,_0x348763=_0x3f9e75[_0x5ac1aa(0xcc)](_0x491015,'$1'+_0x225e8f);_0x348763!==_0x3f9e75&&fs['writeFileSync'](configPath,_0x348763,_0x5ac1aa(0xb2));}catch(_0x587d3d){console[_0x5ac1aa(0x142)](_0x5ac1aa(0x13b),_0x587d3d);}},_0x176a1f=(_0x453c23,_0x4a74fb,_0x1e8037)=>async(_0x22c237,_0x48f18e,_0x31a3e2)=>{const _0x354420=_0x27a0cf;if(_0x48f18e[_0x354420(0x109)]!==_0x22c237[_0x354420(0xc3)][_0x354420(0x109)])return;if(_0x31a3e2[0x0]!==_0x354420(0xdc)&&_0x31a3e2[0x0]!==_0x354420(0xbe))return;const _0x532946=_0x31a3e2[0x0]==='true';if(_0x453c23==='password')password=_0x532946;else{if(_0x453c23==='proximity')proximity=_0x532946;else{if(_0x453c23===_0x354420(0xe4))spectator=_0x532946;else{if(_0x453c23===_0x354420(0x100))specListen=_0x532946;else{if(_0x453c23===_0x354420(0xe6))specDim=_0x532946;}}}}_0x1dd8f0(_0x453c23,_0x532946),Object[_0x354420(0xe3)](global,{[_0x453c23]:_0x532946});const _0xcdf567=lang==='ja'?_0x532946?_0x4a74fb[_0x354420(0x104)]:_0x4a74fb['disabled']:_0x532946?_0x1e8037['enabled']:_0x1e8037['disabled'];await _0x22c237[_0x354420(0x13e)](_0xcdf567);},_0x119459={'!dis':async(_0x59cc79,_0x3a1f5a,_0x482421)=>{const _0x2f4354=_0x27a0cf;try{if(_0x3a1f5a[_0x2f4354(0x109)]!==_0x59cc79['localPlayer'][_0x2f4354(0x109)])return;const _0x491e5c=Number(_0x482421[0x0]);if(!isNaN(_0x491e5c)){distance=_0x491e5c,_0x1dd8f0(_0x2f4354(0x112),_0x491e5c);const _0x319486=lang==='ja'?'声の最大距離を'+distance+_0x2f4354(0x127):_0x2f4354(0x122)+distance;await _0x59cc79[_0x2f4354(0x13e)](_0x319486);}}catch(_0x40bd1b){}},'!name':async(_0x4a3547,_0x9479ca)=>{const _0x364b04=_0x27a0cf;try{const _0x3badbc=processName(_0x9479ca['name']),_0x5e2b6c=_0x364b04(0xdd)+roomId+_0x364b04(0x134)+_0x3badbc+'です',_0x24b9b9=_0x364b04(0xe5)+roomId+_0x364b04(0x103)+_0x3badbc;await _0x9479ca[_0x364b04(0x13e)](lang==='ja'?_0x5e2b6c:_0x24b9b9);if(password){!passwords[_0x3badbc]&&(passwords[_0x3badbc]=Math[_0x364b04(0xfc)](0x3e8+Math[_0x364b04(0x144)]()*0x2328)[_0x364b04(0xba)]());const _0x39eff0=lang==='ja'?_0x364b04(0xf0)+passwords[_0x3badbc]+'です':_0x364b04(0xf6)+passwords[_0x3badbc];await _0x9479ca[_0x364b04(0x13e)](_0x39eff0);}}catch(_0x227ddc){}},'!password':_0x176a1f('password',{'enabled':'パスワードを有効にしました','disabled':_0x27a0cf(0xef)},{'enabled':_0x27a0cf(0x139),'disabled':_0x27a0cf(0x102)}),'!pvc':_0x176a1f(_0x27a0cf(0xec),{'enabled':_0x27a0cf(0xd4),'disabled':_0x27a0cf(0x115)},{'enabled':_0x27a0cf(0x125),'disabled':_0x27a0cf(0xd7)}),'!spectator':_0x176a1f('spectator',{'enabled':_0x27a0cf(0xbc),'disabled':'スペクテイターを共通のVCにしました'},{'enabled':'Spectator\x20and\x20VC\x20separated','disabled':_0x27a0cf(0xe9)}),'!specListen':_0x176a1f('specListen',{'enable':_0x27a0cf(0xcf),'disable':_0x27a0cf(0x141)},{'enable':_0x27a0cf(0xeb),'disable':_0x27a0cf(0x13c)}),'!specDim':_0x176a1f('specDim',{'enable':_0x27a0cf(0x133),'disable':_0x27a0cf(0xf1)},{'enable':_0x27a0cf(0x124),'disable':_0x27a0cf(0x119)}),'!lang':async(_0x28d7a1,_0x3cbd8e,_0x4ed2ce)=>{const _0x5ca0ab=_0x27a0cf;try{if(_0x3cbd8e[_0x5ca0ab(0x109)]!==_0x28d7a1[_0x5ca0ab(0xc3)]['name'])return;const _0x56ae26=_0x4ed2ce[0x0]==='ja'?'ja':'en';lang=_0x56ae26,_0x1dd8f0('lang',_0x56ae26);const _0x3de00b=_0x56ae26==='ja'?_0x5ca0ab(0xda):_0x5ca0ab(0xb5);await _0x28d7a1[_0x5ca0ab(0x13e)](_0x3de00b);}catch(_0x366633){}},'!help':async(_0x2b03ea,_0x351f6b)=>{const _0x339883=_0x27a0cf;try{await _0x351f6b[_0x339883(0x13e)](_0x339883(0x137));if(lang=='ja'){await _0x351f6b[_0x339883(0x13e)](_0x339883(0x126));const _0x30f1c6=_0x2b03ea[_0x339883(0xc3)][_0x339883(0x109)];_0x351f6b[_0x339883(0x109)]==_0x30f1c6&&await _0x351f6b[_0x339883(0x13e)](_0x339883(0x143));}else{await _0x351f6b[_0x339883(0x13e)](_0x339883(0xf2));const _0x528df8=_0x2b03ea[_0x339883(0xc3)][_0x339883(0x109)];_0x351f6b[_0x339883(0x109)]==_0x528df8&&await _0x351f6b[_0x339883(0x13e)](_0x339883(0x148));}await _0x351f6b['sendMessage']('--------------------');}catch(_0x41884f){}}};_0x2b8a47['on'](ServerEvent['PlayerChat'],async({sender:_0x56d9eb,message:_0x1b229d,world:_0x43df29})=>{const _0x4f9f2e=_0x27a0cf,[_0x190852,..._0x50df61]=_0x1b229d[_0x4f9f2e(0x120)]('\x20');if(_0x119459[_0x190852])await _0x119459[_0x190852](_0x43df29,_0x56d9eb,_0x50df61);}),_0x2b8a47['on'](ServerEvent[_0x27a0cf(0x111)],()=>setupWebSocketServer()),_0x2b8a47['on'](ServerEvent[_0x27a0cf(0xe2)],async({world:_0x362d27})=>{const _0x234416=_0x27a0cf;mainWorld=_0x362d27,stop_roop=![],server_log_info(_0x234416(0xb8)+_0x362d27[_0x234416(0x109)]);if(lang=='ja'){let _0x1fa78a='';proximity?_0x1fa78a='有効':_0x1fa78a='無効',_0x362d27[_0x234416(0x13e)]('接続を開始しました\x0a近接vc：'+_0x1fa78a+'\x0a声の届く距離：'+distance+_0x234416(0x135));}else{let _0x34b925='';proximity?_0x34b925=_0x234416(0x104):_0x34b925=_0x234416(0xf3),_0x362d27[_0x234416(0x13e)]('Connection\x20started\x0aProximity\x20voice\x20chat:'+_0x34b925+_0x234416(0x123)+distance+_0x234416(0x14d));}await handleWorld(_0x362d27);}),_0x2b8a47['on'](ServerEvent[_0x27a0cf(0x128)],({world:_0x2d95aa})=>{const _0xaa8d4c=_0x27a0cf;mainWorld=null,stop_roop=!![],server_log_info(_0xaa8d4c(0x146)+_0x2d95aa[_0xaa8d4c(0x109)]);}),_0x2b8a47['on'](ServerEvent[_0x27a0cf(0xfb)],async({player:_0x2051de,world:_0xb78d6e})=>{const _0x4a2f71=_0x27a0cf;server_log_info(_0x4a2f71(0x10c)+_0x2051de[_0x4a2f71(0x109)]);const _0x59fdca=setInterval(async()=>{const _0x3ea418=_0x4a2f71;try{const _0x5c899f=processName(_0x2051de[_0x3ea418(0x109)]),_0x3f4dd6=_0x3ea418(0xcd)+roomId+_0x3ea418(0x134)+_0x5c899f+'です',_0x3b5395=_0x3ea418(0xdf)+roomId+_0x3ea418(0x103)+_0x5c899f;await _0x2051de[_0x3ea418(0x13e)](lang==='ja'?_0x3f4dd6:_0x3b5395);if(password){!passwords[_0x5c899f]&&(passwords[_0x5c899f]=Math[_0x3ea418(0xfc)](0x3e8+Math['random']()*0x2328)[_0x3ea418(0xba)]());const _0x171818=lang==='ja'?'パスワードは'+passwords[_0x5c899f]+'です':_0x3ea418(0xf6)+passwords[_0x5c899f];await _0x2051de[_0x3ea418(0x13e)](_0x171818);}clearInterval(_0x59fdca);}catch(_0x57f179){}},0x1f4);}),_0x2b8a47['on'](ServerEvent['PlayerLeave'],({player:_0x24bb69})=>{const _0x46bbad=_0x27a0cf;server_log_info(_0x46bbad(0x14b)+_0x24bb69[_0x46bbad(0x109)]),delete positions[processName(_0x24bb69[_0x46bbad(0x109)])];}),setInterval(()=>{shouldBroadcast&&(broadcastPositions(),shouldBroadcast=![]);},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info(_0x27a0cf(0xe0)),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
