const _0x1fa054=_0x28cf;(function(_0x2876bb,_0x1b0867){const _0x49d633=_0x28cf,_0x2210c2=_0x2876bb();while(!![]){try{const _0x58952c=-parseInt(_0x49d633(0x19e))/0x1*(-parseInt(_0x49d633(0x159))/0x2)+parseInt(_0x49d633(0x1ad))/0x3+-parseInt(_0x49d633(0x1b3))/0x4+-parseInt(_0x49d633(0x18f))/0x5+parseInt(_0x49d633(0x15a))/0x6*(-parseInt(_0x49d633(0x19f))/0x7)+-parseInt(_0x49d633(0x179))/0x8+parseInt(_0x49d633(0x167))/0x9;if(_0x58952c===_0x1b0867)break;else _0x2210c2['push'](_0x2210c2['shift']());}catch(_0x493c9a){_0x2210c2['push'](_0x2210c2['shift']());}}}(_0x2fba,0xd02f1));const {Server,ServerEvent}=require(_0x1fa054(0x1f5)),WebSocket=require('ws'),fetch=require('node-fetch'),wanakana=require('wanakana'),fs=require('fs'),JSON5=require(_0x1fa054(0x193)),getPort=require(_0x1fa054(0x172)),{Client}=require(_0x1fa054(0x1b5)),net=require(_0x1fa054(0x17d)),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8,configPath=_0x1fa054(0x16a),config=JSON5['parse'](fs[_0x1fa054(0x157)](configPath,_0x1fa054(0x1d6)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimentions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![],inactivityTimer;function _0x28cf(_0x25f6c3,_0xba210b){const _0x2fba4d=_0x2fba();return _0x28cf=function(_0x28cf4f,_0x1db4ca){_0x28cf4f=_0x28cf4f-0x157;let _0x546d37=_0x2fba4d[_0x28cf4f];return _0x546d37;},_0x28cf(_0x25f6c3,_0xba210b);}function _0x2fba(){const _0xa8dcda=['=======================================================\x0a','接続終了:\x20','random','\x0aYour\x20VCname\x20is\x20','forEach','7289975aMUXdh','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','run_command','testfor\x20@e[type=player]','json5','testfor\x20@a[m=spectator]','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','alive','runCommand','Minecraftから以下のコマンドで接続してください:','Spectator\x20and\x20VC\x20separated','Connection\x20started\x0aProximity\x20voice\x20chat:','パスワードは','Proximity\x20VC\x20disabled','Open','11147OCIksm','372827Qfyjug','❌\x20設定ファイルの更新に失敗しました:','sendMessage','パスワードを無効にしました','tcp\x20connection','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','スペクテイターが他モードプレイヤーの会話を聞けるようになました','end','\x0a!help\x20でコマンド一覧を確認できます','\x0a=======================================================','[MC\x20Local\x20WS\x20Error]','<Proximity\x20VC>Language\x20set\x20to\x20English','です\x0aあなたのVCnameは','players','3002799xzEwrF','ROOM\x20ID:\x20','Spectator`s\x20VC\x20separated\x20by\x20dimension','❌\x20SSH\x20Error\x20(','Participants\x20should\x20access\x20this\x20URL','\x20WebSocket\x20error:','598408UrTzQK','\x0aMax\x20distance:','ssh2','json','OPEN','\x20処理中にエラーが発生しました:','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','floor','PlayerLoad','接続開始:\x20','assign','/create-room','lang','終了シグナル受信。SSH接続を停止します...','open','createConnection','writeFileSync','victim','disabled','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','parse','/room/','pipe','socket-beサーバーのポート:\x20','stringify','Spectator\x20set\x20to\x20common\x20VC','toRomaji','indexOf','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','localPlayer','に変更しました','PlayerChat','ready','[MC\x20Relay]','includes','utf8','details','command_result','roomId','localhost','ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','spectator','position','remoteAddr','querytarget\x20@e[type=player]','--------------------','参加者はこのURLにアクセスしてください:','enabled','.tcpexposer.com','yRot','clients','参加:\x20','send','action','[VC\x20Relay]','exit','退出:\x20','readyState','toString','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','message','\x1b[33m[Log]\x1b[0m\x20','\x20Relay\x20server\x20disconnected\x20(ID:\x20','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','\x20スペクテイター同士の会話をディメンションごとに分けました','socket-be','readFileSync','https://','110VHgbFQ','144oLfQkw','true','specListen','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','Changed\x20max\x20distance\x20to\x20','Password\x20enabled','connection','distance','Error\x20handling\x20world:','string','Asia/Tokyo','\x0a声の届く距離：','❌\x20ポートフォワーディング失敗\x20(','34378290AfmrAS','replace','connect','./config.json','tcpexposer.com','/connect\x20','dimension','<近接VC>言語を日本語に設定しました','Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20name','name','partner_connected','get-port','WorldAdd','password','error','value','world_update','close','13561968EFsULi','\x0a!help\x20for\x20command\x20list','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使う名前を確認できます','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','net','log','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','Proximity\x20VC\x20enabled','スペクテイター同士の会話を共通にしました','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','localPort','ws://127.0.0.1:','スペクテイターとVCを分けました','spectators','false','/connect\x20localhost:','[VC\x20Relay]\x20メッセージ処理エラー:'];_0x2fba=function(){return _0xa8dcda;};return _0x2fba();}const server_log_info=_0xf17df0=>console[_0x1fa054(0x17e)]('\x1b[36m[Info]\x1b[0m\x20'+_0xf17df0),server_log_log=_0x5b0b61=>console['log'](_0x1fa054(0x1f1)+_0x5b0b61),processName=_0x368cb3=>wanakana[_0x1fa054(0x1cd)](_0x368cb3[_0x1fa054(0x168)](/ /g,'_'))['replace'](/n'/g,'n'),resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{process['exit'](0x7c);},INACTIVITY_TIMEOUT);},RELAY_SERVER_DOMAIN='mcproxvc.tcpexposer.com';function startSshForwarding(_0x16b596,_0x2b91f8,_0x55cc8b){const _0x477dc2=_0x1fa054;if(!_0x16b596||!username||!ssh_password)return;const _0x57d932=_0x55cc8b==='vc',_0x313b5e=_0x57d932?'[VC\x20SSH]':'[MC\x20SSH]',_0x6d0b23={'host':_0x477dc2(0x16b),'port':0x16,'username':username,'password':ssh_password},_0x50bfb1={'remoteAddr':_0x16b596,'remotePort':0x50,'localAddr':_0x477dc2(0x1da),'localPort':_0x2b91f8},_0x469bc5=new Client();return _0x469bc5['on'](_0x477dc2(0x1d3),()=>{const _0x1e08f0=_0x477dc2;_0x469bc5['forwardIn'](_0x50bfb1[_0x1e08f0(0x1df)],_0x50bfb1['remotePort'],_0x5946ec=>{const _0x5132f2=_0x1e08f0;if(_0x5946ec)return console[_0x5132f2(0x17e)](_0x313b5e+_0x5132f2(0x166)+_0x16b596+'):',_0x5946ec[_0x5132f2(0x1f0)]),server_log_info(_0x313b5e+_0x5132f2(0x15d)),connectToRelayServer(_0x55cc8b),_0x469bc5[_0x5132f2(0x1a6)]();console[_0x5132f2(0x17e)]('\x0a======================================================='),_0x57d932?(useRelay=![],vc_connected=!![],server_log_info(_0x5132f2(0x1ae)+_0x16b596),server_log_info(_0x5132f2(0x1e2)),server_log_info(_0x5132f2(0x1b1)),server_log_info('https://proximity-vc-mcbe.pages.dev?roomid='+_0x16b596)):(server_log_info(_0x5132f2(0x198)),server_log_info(_0x5132f2(0x1a4)),server_log_info(_0x5132f2(0x16c)+_0x16b596+_0x5132f2(0x1e4))),console[_0x5132f2(0x17e)](_0x5132f2(0x18a));}),_0x469bc5['on'](_0x1e08f0(0x1a3),(_0x3e84da,_0x3b619f)=>{const _0xbbbb1a=_0x1e08f0,_0x3ccfc2=_0x3b619f(),_0x163f21=net[_0xbbbb1a(0x1c2)]({'host':_0x50bfb1['localAddr'],'port':_0x50bfb1[_0xbbbb1a(0x183)]});_0x163f21['on'](_0xbbbb1a(0x169),()=>_0x3ccfc2['pipe'](_0x163f21)[_0xbbbb1a(0x1c9)](_0x3ccfc2)),_0x163f21['on'](_0xbbbb1a(0x175),_0x57000a=>{const _0x4a14d3=_0xbbbb1a;console[_0x4a14d3(0x175)]('ローカル接続エラー\x20('+_0x16b596+'):',_0x57000a['message']),_0x3ccfc2[_0x4a14d3(0x178)]();}),_0x3ccfc2['on'](_0xbbbb1a(0x178),()=>_0x163f21[_0xbbbb1a(0x1a6)]());});})['on'](_0x477dc2(0x175),_0x280809=>{const _0x76fcf3=_0x477dc2;console['log'](_0x313b5e+_0x76fcf3(0x1b0)+_0x16b596+'):',_0x280809['message']),server_log_info(_0x313b5e+_0x76fcf3(0x15d)),connectToRelayServer(_0x55cc8b);}),_0x469bc5[_0x477dc2(0x169)](_0x6d0b23),_0x469bc5;}async function setupWebSocketServer(){const _0x4267b5=_0x1fa054;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket['Server']({'port':web_port}),wss['on'](_0x4267b5(0x160),_0x16353b=>{const _0x5634a7=_0x4267b5;_0x16353b['on'](_0x5634a7(0x1f0),_0x25127a=>{const _0x51b553=_0x5634a7;try{const {userName:_0x2f5be1,position:_0x4f83e7}=JSON[_0x51b553(0x1c7)](_0x25127a);if(_0x2f5be1&&_0x4f83e7)positions[_0x2f5be1]=_0x4f83e7;}catch(_0x5b7a70){console[_0x51b553(0x175)]('WebSocketメッセージの解析に失敗:',_0x5b7a70);}}),_0x16353b['on']('error',_0xc41317=>console[_0x5634a7(0x175)]('WebSocket\x20error:',_0xc41317));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0x4267b5(0x17e)](_0x4267b5(0x1a8)),server_log_info(_0x4267b5(0x198)),server_log_info(_0x4267b5(0x1a4)),server_log_info(_0x4267b5(0x188)+port),console[_0x4267b5(0x17e)](_0x4267b5(0x18a));process['on']('SIGINT',()=>{const _0x546b87=_0x4267b5;console[_0x546b87(0x17e)](_0x546b87(0x1c0));if(vcSSHClient)vcSSHClient[_0x546b87(0x1a6)]();if(mcSSHClient)mcSSHClient[_0x546b87(0x1a6)]();process[_0x546b87(0x1eb)]();});}function broadcastPositions(){const _0x4014c7=_0x1fa054,_0x5b0f19=JSON[_0x4014c7(0x1cb)]({'type':_0x4014c7(0x177),'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimentions':dimentions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x4014c7(0x1ed)]===WebSocket[_0x4014c7(0x1b7)])relayWs[_0x4014c7(0x1e8)](_0x5b0f19);else sub_domain&&username&&ssh_password&&!useRelay&&wss[_0x4014c7(0x1e6)][_0x4014c7(0x18e)](_0x28b58e=>{const _0x5438e3=_0x4014c7;_0x28b58e[_0x5438e3(0x1ed)]===WebSocket[_0x5438e3(0x1b7)]&&_0x28b58e[_0x5438e3(0x1e8)](_0x5b0f19);});}async function handleWorld(_0x5158c2){const _0x17f063=_0x1fa054;try{const _0x11e15d=Array['from'](_0x5158c2[_0x17f063(0x1ac)]['values'](),_0xfc53ec=>String(_0xfc53ec['name']));let _0x503a03={};if(proximity){const [_0x4ab8fc,_0x1d1051,_0x29a270]=await Promise['all']([_0x5158c2['runCommand'](_0x17f063(0x192)),_0x5158c2[_0x17f063(0x197)](_0x17f063(0x194)),_0x5158c2[_0x17f063(0x197)](_0x17f063(0x1e0))]);_0x503a03={'alive':_0x4ab8fc[_0x17f063(0x1c4)]||[],'spectators':_0x1d1051[_0x17f063(0x1c4)]||[],'details':JSON[_0x17f063(0x1c7)](_0x29a270[_0x17f063(0x1d7)]||'[]')};}_0x11e15d[_0x17f063(0x18e)](_0x565577=>{const _0x43edf2=_0x17f063;resetTimer();let _0x2a537e;if(proximity)_0x2a537e=_0x503a03[_0x43edf2(0x196)][_0x43edf2(0x1ce)](_0x565577);const _0x20e234=processName(_0x565577);_0x503a03['spectators'][_0x43edf2(0x1d5)](_0x565577)?spectators[_0x20e234]=!![]:spectators[_0x20e234]=![];if(!proximity)positions[_0x20e234]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x503a03[_0x43edf2(0x196)][_0x43edf2(0x1d5)](_0x565577))positions[_0x20e234]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x503a03[_0x43edf2(0x186)][_0x43edf2(0x1d5)](_0x565577)){if(specListen===!![])positions[_0x20e234]=_0x503a03[_0x43edf2(0x1d7)][_0x2a537e]['position'];else positions[_0x20e234]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimentions[_0x20e234]=_0x503a03['details'][_0x2a537e][_0x43edf2(0x16d)];}else _0x503a03[_0x43edf2(0x1d7)][_0x2a537e]?.[_0x43edf2(0x1de)]?(positions[_0x20e234]=_0x503a03[_0x43edf2(0x1d7)][_0x2a537e][_0x43edf2(0x1de)],yRots[_0x20e234]=_0x503a03[_0x43edf2(0x1d7)][_0x2a537e][_0x43edf2(0x1e5)],dimentions[_0x20e234]=_0x503a03[_0x43edf2(0x1d7)][_0x2a537e][_0x43edf2(0x16d)]):positions[_0x20e234]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x456a95){console[_0x17f063(0x17e)](_0x17f063(0x162),_0x456a95);}if(!stop_roop)setTimeout(()=>handleWorld(_0x5158c2),0x64);}async function connectToRelayServer(_0x40448e){const _0x1027fe=_0x1fa054,_0x42571a=_0x40448e==='mc',_0x207dcf=_0x42571a?_0x1027fe(0x1d4):_0x1027fe(0x1ea);try{const _0x2ba40b=await fetch(_0x1027fe(0x158)+RELAY_SERVER_DOMAIN+_0x1027fe(0x1be)),_0x4a15c4=await _0x2ba40b[_0x1027fe(0x1b6)](),_0x3dbe65=_0x4a15c4[_0x1027fe(0x1d9)];if(!_0x42571a)roomId=_0x3dbe65;console[_0x1027fe(0x17e)](_0x1027fe(0x1a8));_0x42571a?(server_log_info(_0x1027fe(0x198)),server_log_info(_0x1027fe(0x1a4)),server_log_info('/connect\x20'+RELAY_SERVER_DOMAIN+'/room/'+_0x3dbe65)):(useRelay=!![],vc_connected=!![],server_log_info('ROOM\x20ID:\x20'+_0x3dbe65),server_log_info(_0x1027fe(0x1e2)),server_log_info(_0x1027fe(0x1b1)),server_log_info('https://proximity-vc-mcbe.pages.dev?roomid='+_0x3dbe65));console[_0x1027fe(0x17e)](_0x1027fe(0x18a));const _0xe8040f=new WebSocket('wss://'+RELAY_SERVER_DOMAIN+_0x1027fe(0x1c8)+_0x3dbe65+'?clientType=server_script');if(!_0x42571a)relayWs=_0xe8040f;_0xe8040f['on'](_0x1027fe(0x1c1),()=>console['log'](_0x207dcf+'\x20Relay\x20server\x20connected\x20(ID:\x20'+_0x3dbe65+')')),_0xe8040f['on'](_0x1027fe(0x178),()=>console[_0x1027fe(0x17e)](_0x207dcf+_0x1027fe(0x1f2)+_0x3dbe65+')')),_0xe8040f['on'](_0x1027fe(0x175),_0x45aabb=>console['error'](_0x207dcf+_0x1027fe(0x1b2),_0x45aabb)),_0x42571a?setupMcRelayListeners(_0xe8040f):setupVcRelayListeners(_0xe8040f);}catch(_0x1335fb){console[_0x1027fe(0x175)](_0x207dcf+_0x1027fe(0x1b8),_0x1335fb);}}function setupVcRelayListeners(_0x132c10){_0x132c10['on']('message',async _0x467add=>{const _0x39c34d=_0x28cf;try{const _0x461652=JSON[_0x39c34d(0x1c7)](_0x467add[_0x39c34d(0x1ee)]());if(mainWorld&&_0x461652[_0x39c34d(0x1e9)]===_0x39c34d(0x191)&&typeof _0x461652[_0x39c34d(0x176)]===_0x39c34d(0x163)){const _0x40aeab=await mainWorld[_0x39c34d(0x197)](_0x461652[_0x39c34d(0x176)]);_0x132c10[_0x39c34d(0x1e8)](JSON[_0x39c34d(0x1cb)]({'type':_0x39c34d(0x1d8),'payload':_0x40aeab}));}}catch(_0x3553f4){console[_0x39c34d(0x175)](_0x39c34d(0x189),_0x3553f4);}});}function setupMcRelayListeners(_0x1168d1){const _0x513f8f=_0x1fa054;let _0x575be2;_0x1168d1['on']('message',_0xce3ade=>{const _0x5f13ed=_0x28cf;try{const _0x1b37a2=JSON[_0x5f13ed(0x1c7)](_0xce3ade[_0x5f13ed(0x1ee)]());if(_0x1b37a2['type']===_0x5f13ed(0x171)){console[_0x5f13ed(0x17e)](_0x5f13ed(0x182)),_0x575be2=new WebSocket(_0x5f13ed(0x184)+port),_0x575be2['on'](_0x5f13ed(0x1c1),()=>console[_0x5f13ed(0x17e)](_0x5f13ed(0x1cf))),_0x575be2['on'](_0x5f13ed(0x1f0),_0xc9a808=>_0x1168d1[_0x5f13ed(0x1ed)]===WebSocket[_0x5f13ed(0x1b7)]&&_0x1168d1[_0x5f13ed(0x1e8)](_0xc9a808)),_0x575be2['on'](_0x5f13ed(0x178),()=>_0x1168d1[_0x5f13ed(0x1ed)]===WebSocket['OPEN']&&_0x1168d1['close']()),_0x575be2['on'](_0x5f13ed(0x175),_0x37b5c6=>console[_0x5f13ed(0x175)](_0x5f13ed(0x1a9),_0x37b5c6[_0x5f13ed(0x1f0)]));return;}}catch(_0x5c9b61){}_0x575be2?.[_0x5f13ed(0x1ed)]===WebSocket[_0x5f13ed(0x1b7)]&&_0x575be2['send'](_0xce3ade);}),_0x1168d1['on'](_0x513f8f(0x178),()=>_0x575be2?.[_0x513f8f(0x178)]());}async function main(){const _0x46352e=_0x1fa054;resetTimer(),port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x46352e(0x1ca)+port);const _0x4fbf77=new Server({'port':port,'disableEncryption':!![],'timezone':_0x46352e(0x164)}),_0x60a7f3=(_0x30bbcd,_0x4ee4b9)=>{const _0x18e9fa=_0x46352e;try{let _0x550e59=fs['readFileSync'](configPath,'utf8');const _0x404970=new RegExp('(\x22'+_0x30bbcd+_0x18e9fa(0x1dc)),_0x4e4245=typeof _0x4ee4b9===_0x18e9fa(0x163)?'\x22'+_0x4ee4b9+'\x22':_0x4ee4b9,_0x35849a=_0x550e59[_0x18e9fa(0x168)](_0x404970,'$1'+_0x4e4245);_0x35849a!==_0x550e59&&fs[_0x18e9fa(0x1c3)](configPath,_0x35849a,'utf8');}catch(_0x4d3f06){console[_0x18e9fa(0x175)](_0x18e9fa(0x1a0),_0x4d3f06);}},_0x44ad3f=(_0x2f65ed,_0x3d6765,_0x3e35d2)=>async(_0x52f121,_0x262ae8,_0x2a57d7)=>{const _0x12b145=_0x46352e;if(_0x262ae8[_0x12b145(0x170)]!==_0x52f121['localPlayer'][_0x12b145(0x170)])return;if(_0x2a57d7[0x0]!==_0x12b145(0x15b)&&_0x2a57d7[0x0]!==_0x12b145(0x187))return;const _0x574c97=_0x2a57d7[0x0]==='true';if(_0x2f65ed===_0x12b145(0x174))password=_0x574c97;else{if(_0x2f65ed==='proximity')proximity=_0x574c97;else{if(_0x2f65ed===_0x12b145(0x1dd))spectator=_0x574c97;else{if(_0x2f65ed===_0x12b145(0x15c))specListen=_0x574c97;else{if(_0x2f65ed==='specDim')specDim=_0x574c97;}}}}_0x60a7f3(_0x2f65ed,_0x574c97),Object[_0x12b145(0x1bd)](global,{[_0x2f65ed]:_0x574c97});const _0x4de7cf=lang==='ja'?_0x574c97?_0x3d6765[_0x12b145(0x1e3)]:_0x3d6765['disabled']:_0x574c97?_0x3e35d2[_0x12b145(0x1e3)]:_0x3e35d2[_0x12b145(0x1c5)];await _0x52f121[_0x12b145(0x1a1)](_0x4de7cf);},_0x29cc1e={'!dis':async(_0x25f6f6,_0x173465,_0x1ad2a5)=>{const _0x253398=_0x46352e;try{if(_0x173465[_0x253398(0x170)]!==_0x25f6f6[_0x253398(0x1d0)][_0x253398(0x170)])return;const _0x34147b=Number(_0x1ad2a5[0x0]);if(!isNaN(_0x34147b)){distance=_0x34147b,_0x60a7f3(_0x253398(0x161),_0x34147b);const _0x4e9aa8=lang==='ja'?'声の最大距離を'+distance+_0x253398(0x1d1):_0x253398(0x15e)+distance;await _0x25f6f6[_0x253398(0x1a1)](_0x4e9aa8);}}catch(_0x18889e){}},'!name':async(_0x3f55f6,_0x163d54)=>{const _0x4a6a12=_0x46352e;try{const _0xabfb1d=processName(_0x163d54[_0x4a6a12(0x170)]),_0x455c16=_0x4a6a12(0x17f)+roomId+'です\x0aあなたのVCnameは'+_0xabfb1d+'です',_0x35bb0e=_0x4a6a12(0x1b9)+roomId+_0x4a6a12(0x18d)+_0xabfb1d;await _0x163d54[_0x4a6a12(0x1a1)](lang==='ja'?_0x455c16:_0x35bb0e);if(password){!passwords[_0xabfb1d]&&(passwords[_0xabfb1d]=Math[_0x4a6a12(0x1ba)](0x3e8+Math[_0x4a6a12(0x18c)]()*0x2328)[_0x4a6a12(0x1ee)]());const _0x14a6a6=lang==='ja'?_0x4a6a12(0x19b)+passwords[_0xabfb1d]+'です':'Password\x20is\x20'+passwords[_0xabfb1d];await _0x163d54[_0x4a6a12(0x1a1)](_0x14a6a6);}}catch(_0x5c8aa8){}},'!password':_0x44ad3f(_0x46352e(0x174),{'enabled':'パスワードを有効にしました','disabled':_0x46352e(0x1a2)},{'enabled':_0x46352e(0x15f),'disabled':'Password\x20disabled'}),'!pvc':_0x44ad3f('proximity',{'enabled':'近接vcを有効にしました','disabled':'近接vcを無効にしました'},{'enabled':_0x46352e(0x180),'disabled':_0x46352e(0x19c)}),'!spectator':_0x44ad3f(_0x46352e(0x1dd),{'enabled':_0x46352e(0x185),'disabled':'スペクテイターを共通のVCにしました'},{'enabled':_0x46352e(0x199),'disabled':_0x46352e(0x1cc)}),'!specListen':_0x44ad3f(_0x46352e(0x15c),{'enable':_0x46352e(0x1a5),'disable':_0x46352e(0x1c6)},{'enable':_0x46352e(0x17c),'disable':'Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players'}),'!specDim':_0x44ad3f('specDim',{'enable':_0x46352e(0x1f4),'disable':_0x46352e(0x181)},{'enable':_0x46352e(0x1af),'disable':_0x46352e(0x190)}),'!lang':async(_0x271ca0,_0x4498be,_0x35955e)=>{const _0x4a434f=_0x46352e;try{if(_0x4498be[_0x4a434f(0x170)]!==_0x271ca0[_0x4a434f(0x1d0)][_0x4a434f(0x170)])return;const _0x430dfa=_0x35955e[0x0]==='ja'?'ja':'en';lang=_0x430dfa,_0x60a7f3(_0x4a434f(0x1bf),_0x430dfa);const _0x27c769=_0x430dfa==='ja'?_0x4a434f(0x16e):_0x4a434f(0x1aa);await _0x271ca0[_0x4a434f(0x1a1)](_0x27c769);}catch(_0x3fdc3d){}},'!help':async(_0x1ffe7d,_0x166cb6)=>{const _0x41e52a=_0x46352e;try{await _0x166cb6[_0x41e52a(0x1a1)](_0x41e52a(0x1e1));if(lang=='ja'){await _0x166cb6[_0x41e52a(0x1a1)](_0x41e52a(0x17b));const _0x7a38b3=_0x1ffe7d[_0x41e52a(0x1d0)]['name'];_0x166cb6[_0x41e52a(0x170)]==_0x7a38b3&&await _0x166cb6[_0x41e52a(0x1a1)](_0x41e52a(0x1db));}else{await _0x166cb6['sendMessage'](_0x41e52a(0x16f));const _0x2bc8ce=_0x1ffe7d[_0x41e52a(0x1d0)][_0x41e52a(0x170)];_0x166cb6['name']==_0x2bc8ce&&await _0x166cb6['sendMessage'](_0x41e52a(0x195));}await _0x166cb6['sendMessage'](_0x41e52a(0x1e1));}catch(_0x237fbd){}}};_0x4fbf77['on'](ServerEvent[_0x46352e(0x1d2)],async({sender:_0x23eb38,message:_0x3e4c38,world:_0x276674})=>{const [_0x4eb6ab,..._0x5d9265]=_0x3e4c38['split']('\x20');if(_0x29cc1e[_0x4eb6ab])await _0x29cc1e[_0x4eb6ab](_0x276674,_0x23eb38,_0x5d9265);}),_0x4fbf77['on'](ServerEvent[_0x46352e(0x19d)],()=>setupWebSocketServer()),_0x4fbf77['on'](ServerEvent[_0x46352e(0x173)],async({world:_0x1522f4})=>{const _0x1df5af=_0x46352e;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x1522f4,stop_roop=![],resetTimer(),server_log_info(_0x1df5af(0x1bc)+_0x1522f4[_0x1df5af(0x170)]);if(lang=='ja'){let _0x3df5eb='';proximity?_0x3df5eb='有効':_0x3df5eb='無効',_0x1522f4['sendMessage']('接続を開始しました\x0a近接vc：'+_0x3df5eb+_0x1df5af(0x165)+distance+_0x1df5af(0x1a7));}else{let _0x36bd34='';proximity?_0x36bd34=_0x1df5af(0x1e3):_0x36bd34=_0x1df5af(0x1c5),_0x1522f4[_0x1df5af(0x1a1)](_0x1df5af(0x19a)+_0x36bd34+_0x1df5af(0x1b4)+distance+_0x1df5af(0x17a));}await handleWorld(_0x1522f4);}),_0x4fbf77['on'](ServerEvent['WorldRemove'],({world:_0x2a996d})=>{const _0x170e6b=_0x46352e;mainWorld=null,stop_roop=!![],server_log_info(_0x170e6b(0x18b)+_0x2a996d[_0x170e6b(0x170)]);}),_0x4fbf77['on'](ServerEvent[_0x46352e(0x1bb)],async({player:_0xe2ef32,world:_0x367e94})=>{const _0x538ba9=_0x46352e;server_log_info(_0x538ba9(0x1e7)+_0xe2ef32[_0x538ba9(0x170)]);const _0x48a738=setInterval(async()=>{const _0x22a90e=_0x538ba9;try{const _0x140e35=processName(_0xe2ef32[_0x22a90e(0x170)]),_0x4dd0c9=_0x22a90e(0x1ef)+roomId+_0x22a90e(0x1ab)+_0x140e35+'です',_0x447f31=_0x22a90e(0x1f3)+roomId+_0x22a90e(0x18d)+_0x140e35;await _0xe2ef32[_0x22a90e(0x1a1)](lang==='ja'?_0x4dd0c9:_0x447f31);if(password){!passwords[_0x140e35]&&(passwords[_0x140e35]=Math[_0x22a90e(0x1ba)](0x3e8+Math[_0x22a90e(0x18c)]()*0x2328)[_0x22a90e(0x1ee)]());const _0x4cb2fc=lang==='ja'?_0x22a90e(0x19b)+passwords[_0x140e35]+'です':'Password\x20is\x20'+passwords[_0x140e35];await _0xe2ef32['sendMessage'](_0x4cb2fc);}clearInterval(_0x48a738);}catch(_0x2f3110){}},0x1f4);}),_0x4fbf77['on'](ServerEvent['PlayerLeave'],({player:_0x3bad39,world:_0x53c981})=>{const _0x5d6af8=_0x46352e;server_log_info(_0x5d6af8(0x1ec)+_0x3bad39[_0x5d6af8(0x170)]),delete positions[processName(_0x3bad39[_0x5d6af8(0x170)])];const _0x38ff5b=_0x53c981[_0x5d6af8(0x1d0)][_0x5d6af8(0x170)];if(_0x3bad39['name']==_0x38ff5b)process[_0x5d6af8(0x1eb)](0x0);}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info(_0x46352e(0x15d)),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
