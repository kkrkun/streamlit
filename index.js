function _0x5590(_0x4e78a0,_0x5c8aff){const _0x2a6a9a=_0x2a6a();return _0x5590=function(_0x5590b4,_0x107a7a){_0x5590b4=_0x5590b4-0x114;let _0xa022c=_0x2a6a9a[_0x5590b4];return _0xa022c;},_0x5590(_0x4e78a0,_0x5c8aff);}const _0x23197b=_0x5590;(function(_0x390119,_0x50c1b5){const _0x120052=_0x5590,_0x41bea0=_0x390119();while(!![]){try{const _0xf7ac2e=-parseInt(_0x120052(0x163))/0x1*(-parseInt(_0x120052(0x16e))/0x2)+parseInt(_0x120052(0x12e))/0x3*(parseInt(_0x120052(0x1a9))/0x4)+-parseInt(_0x120052(0x19b))/0x5+-parseInt(_0x120052(0x188))/0x6*(-parseInt(_0x120052(0x167))/0x7)+-parseInt(_0x120052(0x13d))/0x8*(-parseInt(_0x120052(0x1c2))/0x9)+parseInt(_0x120052(0x1b7))/0xa+parseInt(_0x120052(0x11c))/0xb*(parseInt(_0x120052(0x164))/0xc);if(_0xf7ac2e===_0x50c1b5)break;else _0x41bea0['push'](_0x41bea0['shift']());}catch(_0x1137f6){_0x41bea0['push'](_0x41bea0['shift']());}}}(_0x2a6a,0xc17e3));const {Server,ServerEvent}=require('socket-be'),WebSocket=require('ws'),fetch=require('node-fetch'),wanakana=require(_0x23197b(0x162)),fs=require('fs'),JSON5=require(_0x23197b(0x193)),getPort=require('get-port'),{Client}=require('ssh2'),net=require(_0x23197b(0x145)),express=require(_0x23197b(0x1b5)),http=require('http'),configPath=_0x23197b(0x156),config=JSON5[_0x23197b(0x121)](fs[_0x23197b(0x158)](configPath,_0x23197b(0x138)));let {app_id='',secret_key='',username='',sub_domain='',sub_domain2='',ssh_password='',port=0x4abc,web_port=0x1f40,proximity=!![],spectator=!![],specListen=!![],specDim=![],password=![],distance=0x6,lang='en'}=config,roomId=sub_domain,stop_roop=![],passwords={},positions={},yRots={},dimensions={},shouldBroadcast=!![],vc_connected=![],mc_connected=![],wss,relayWs,mainWorld,vcSSHClient,mcSSHClient,spectators={},useRelay=![];const server_log_info=_0x5def33=>console[_0x23197b(0x15d)](_0x23197b(0x170)+_0x5def33),server_log_log=_0x396b37=>console[_0x23197b(0x15d)]('\x1b[33m[Log]\x1b[0m\x20'+_0x396b37),processName=_0x5c2857=>wanakana[_0x23197b(0x120)](_0x5c2857[_0x23197b(0x118)](/ /g,'_'))[_0x23197b(0x118)](/n'/g,'n'),RELAY_SERVER_DOMAIN=_0x23197b(0x17e),INACTIVITY_TIMEOUT=0x5*0x3c*0x3e8;let inactivityTimer;function _0x2a6a(){const _0x4fa685=['correlationId','lang','❌\x20SSH\x20Error\x20(','run_command','330411AVHGGn','?clientType=server_script','URL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','socket-beサーバーのポート:\x20','https://proximity-vc-mcbe.pages.dev?roomid=','Host-only\x20command：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20言語を変更できます\x0a\x20\u00a0!dis\x20-\x20!dis\x20<Number>\x20set\x20max\x20distance\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20enable/disable\x20proximity\x20voice\x20chat\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20separate\x20spectator\x20and\x20VC\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20Spectator`s\x20VC\x20separated\x20by\x20dimension\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20enable/disable\x20password','中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)','enabled','❌\x20設定ファイルの更新に失敗しました:','Error\x20handling\x20world:','utf8','sendMessage','Spectator`s\x20VC\x20set\x20to\x20common\x20in\x20all\x20dimensions','random','stringify','8dgrqiX','Password\x20is\x20','disconnect_command','pipe','Password\x20disabled','yRot','specDim','.tcpexposer.com','net','body','参加者はこのURLにアクセスしてください:','createConnection','Spectator\x20cannot\x20listen\x20to\x20other\x20gamemode\x20players','sender','error','Open','ws://127.0.0.1:','<Proximity\x20VC>Language\x20set\x20to\x20English','\x0aMax\x20distance:','false','コマンド一覧：\x0a\x20\u00a0!help\x20-\x20ヘルプを表示します\x0a\x20\u00a0!name\x20-\x20VCで使うゲーマータグを確認できます','OPEN','proximity','/create-room','initialization','./config.json','参加:\x20','readFileSync','specListen','createServer','近接VCを使用中です\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','スペクテイター同士の会話を共通にしました','log','SIGINT','Spectator\x20can\x20listen\x20to\x20other\x20gamemode\x20players','\x0a=======================================================','send','wanakana','7843Kqfswh','48gFcrQy','Changed\x20max\x20distance\x20to\x20','PlayerChat','77mHNnem','パスワードは','接続終了:\x20','includes','[MC\x20SSH]','partner_connected','exit','2RCOjEq','WorldAdd','\x1b[36m[Info]\x1b[0m\x20','/room/','--------------------','\x20処理中にエラーが発生しました:','[VC\x20SSH]','runCommand','tcpexposer.com','string','\x20Relay\x20server\x20disconnected\x20(ID:\x20','スペクテイターが他モードプレイヤーの会話を聞けるようになました','終了シグナル受信。SSH接続を停止します...','readyState','URL:https://proximity-vc-mcbe.pages.dev/\x0aルームIDは','\x22\x5cs*:\x5cs*)(?:\x22.*?\x22|\x5cd+\x5c.?\x5cd*|true|false)','mcproxvc.tcpexposer.com','position','json','positions','true','connect','name','wss://','\x0a!help\x20for\x20command\x20list','tcp\x20connection','10428kxsACW','Using\x20Proximity\x20Voice\x20Chat\x0aURL:https://proximity-vc-mcbe.pages.dev/\x0aRoomID\x20is\x20','です\x0aあなたのVCnameは','testfor\x20@a[m=spectator]','/connect\x20localhost:','end','floor','action','remoteAddr','message','details','json5','[MC\x20Local\x20WS\x20Error]','Asia/Tokyo','ROOM\x20ID:\x20','localhost','Spectator\x20set\x20to\x20common\x20VC','roomId','close','6417795ZNfcQt','[MC\x20Relay]\x20ローカルのsocket-beに接続成功。','value','command_result','[VC\x20Relay]\x20メッセージ処理エラー:','Minecraftから以下のコマンドで接続してください:','\x0aYour\x20VCname\x20is\x20','[MC\x20Relay]','\x20WebSocket\x20error:','Server','split','パスワードを無効にしました','スペクテイターが他モードプレイヤーの会話を聞けなくなりました','spectator','12HxKjnR','スペクテイターとVCを分けました','<近接VC>言語を日本語に設定しました','Participants\x20should\x20access\x20this\x20URL','❌\x20ポートフォワーディング失敗\x20(','victim','post','★★★\x20[MC\x20Relay]\x20パートナー接続通知を受信。ローカルブリッジを構築します。\x20★★★','writeFileSync','\x20Relay\x20server\x20connected\x20(ID:\x20','toString','from','express','entries','1835190nXJLnw','スペクテイターを共通のVCにしました','dimensions','/connect\x20','name_command','testfor\x20@e[type=player]','Connection\x20started\x0aProximity\x20voice\x20chat:','distance','Connect\x20from\x20Minecraft\x20with\x20the\x20following\x20command:','WebSocket\x20error:','声の最大距離を','6425883tOQOdM','disabled','type','ローカル接続エラー\x20(','use','ready','indexOf','forEach','=======================================================\x0a','data_update','localPlayer','replace','パスワードを有効にしました','[VC\x20Relay]','spectators','2258377aDYzcw','https://','status','querytarget\x20@e[type=player]','toRomaji','parse','remotePort','values','password','WorldRemove','退出:\x20','forwardIn','alive','yRots'];_0x2a6a=function(){return _0x4fa685;};return _0x2a6a();}const resetTimer=()=>{clearTimeout(inactivityTimer),inactivityTimer=setTimeout(()=>{const _0x47aaae=_0x5590;process[_0x47aaae(0x16d)](0x7c);},INACTIVITY_TIMEOUT);};function startSshForwarding(_0x39fcb9,_0x389b62,_0x2594fe){const _0x4f1c14=_0x23197b;if(!_0x39fcb9||!username||!ssh_password)return;const _0x53cb70=_0x2594fe==='vc',_0x4faf75=_0x53cb70?_0x4f1c14(0x174):_0x4f1c14(0x16b),_0x2ef589={'host':_0x4f1c14(0x176),'port':0x16,'username':username,'password':ssh_password},_0x217587={'remoteAddr':_0x39fcb9,'remotePort':0x50,'localAddr':_0x4f1c14(0x197),'localPort':_0x389b62},_0x39efdb=new Client();return _0x39efdb['on'](_0x4f1c14(0x1c7),()=>{const _0xb8ba4=_0x4f1c14;_0x39efdb[_0xb8ba4(0x127)](_0x217587[_0xb8ba4(0x190)],_0x217587[_0xb8ba4(0x122)],_0xf851a0=>{const _0x706e8c=_0xb8ba4;if(_0xf851a0)return console[_0x706e8c(0x14b)](_0x4faf75+_0x706e8c(0x1ad)+_0x39fcb9+'):',_0xf851a0[_0x706e8c(0x191)]),server_log_info(_0x4faf75+_0x706e8c(0x134)),connectToRelayServer(_0x2594fe),_0x39efdb[_0x706e8c(0x18d)]();console[_0x706e8c(0x15d)](_0x706e8c(0x160)),_0x53cb70?(useRelay=![],vc_connected=!![],server_log_info(_0x706e8c(0x196)+_0x39fcb9),server_log_info(_0x706e8c(0x147)),server_log_info(_0x706e8c(0x1ac)),server_log_info(_0x706e8c(0x132)+_0x39fcb9)):(server_log_info(_0x706e8c(0x1a0)),server_log_info(_0x706e8c(0x1bf)),server_log_info(_0x706e8c(0x1ba)+_0x39fcb9+_0x706e8c(0x144))),console[_0x706e8c(0x15d)](_0x706e8c(0x115));}),_0x39efdb['on'](_0xb8ba4(0x187),(_0x4607a4,_0x56f479)=>{const _0x291369=_0xb8ba4,_0x1268ee=_0x56f479(),_0x5a191c=net[_0x291369(0x148)]({'host':_0x217587['localAddr'],'port':_0x217587['localPort']});_0x5a191c['on'](_0x291369(0x183),()=>_0x1268ee[_0x291369(0x140)](_0x5a191c)['pipe'](_0x1268ee)),_0x5a191c['on'](_0x291369(0x14b),_0x21dbd4=>{const _0x3ca219=_0x291369;console[_0x3ca219(0x14b)](_0x3ca219(0x1c5)+_0x39fcb9+'):',_0x21dbd4[_0x3ca219(0x191)]),_0x1268ee[_0x3ca219(0x19a)]();}),_0x1268ee['on'](_0x291369(0x19a),()=>_0x5a191c[_0x291369(0x18d)]());});})['on'](_0x4f1c14(0x14b),_0x5a890d=>{const _0x26efa6=_0x4f1c14;console[_0x26efa6(0x14b)](_0x26efa6(0x12c)+_0x39fcb9+'):',_0x5a890d[_0x26efa6(0x191)]),server_log_info(_0x4faf75+_0x26efa6(0x134)),connectToRelayServer(_0x2594fe);}),_0x39efdb[_0x4f1c14(0x183)](_0x2ef589),_0x39efdb;}async function setupWebSocketServer(){const _0xb73706=_0x23197b;if(sub_domain===''||username===''||ssh_password==='')return;wss=new WebSocket[(_0xb73706(0x1a4))]({'port':web_port}),wss['on']('connection',_0x8be5a7=>{const _0x50f971=_0xb73706;_0x8be5a7['on']('message',_0x19d642=>{try{const {userName:_0x35190b,position:_0x4b8664}=JSON['parse'](_0x19d642);if(_0x35190b&&_0x4b8664)positions[_0x35190b]=_0x4b8664;}catch(_0x1286f4){console['error']('WebSocketメッセージの解析に失敗:',_0x1286f4);}}),_0x8be5a7['on'](_0x50f971(0x14b),_0x524957=>console['error'](_0x50f971(0x1c0),_0x524957));}),vcSSHClient=startSshForwarding(sub_domain,web_port,'vc');if(sub_domain2)mcSSHClient=startSshForwarding(sub_domain2,port,'mc');else console[_0xb73706(0x15d)]('\x0a======================================================='),server_log_info(_0xb73706(0x1a0)),server_log_info(_0xb73706(0x1bf)),server_log_info(_0xb73706(0x18c)+port),console[_0xb73706(0x15d)]('=======================================================\x0a');process['on'](_0xb73706(0x15e),()=>{const _0x22ef87=_0xb73706;console[_0x22ef87(0x15d)](_0x22ef87(0x17a));if(vcSSHClient)vcSSHClient['end']();if(mcSSHClient)mcSSHClient[_0x22ef87(0x18d)]();process['exit']();});}function broadcastPositions(){const _0x2aefc6=_0x23197b,_0x346c44=JSON[_0x2aefc6(0x13c)]({'type':'world_update','dimentions':dimensions,'proximity':proximity,'positions':positions,'distance':distance,'spectator':spectator,'spectators':spectators,'specListen':specListen,'specDim':specDim,'yRots':yRots,'dimensions':dimensions,'password':password,'passwords':passwords,'app_id':app_id,'secret_key':secret_key});if((sub_domain===''||username===''||ssh_password===''||useRelay)&&relayWs?.[_0x2aefc6(0x17b)]===WebSocket['OPEN'])relayWs[_0x2aefc6(0x161)](_0x346c44);else sub_domain&&username&&ssh_password&&!useRelay&&wss['clients'][_0x2aefc6(0x114)](_0x4978c8=>{const _0xaa4380=_0x2aefc6;_0x4978c8[_0xaa4380(0x17b)]===WebSocket['OPEN']&&_0x4978c8[_0xaa4380(0x161)](_0x346c44);});}async function handleWorld(_0x2e8574){const _0x23fae0=_0x23197b;try{const _0xf54607=Array[_0x23fae0(0x1b4)](_0x2e8574['players'][_0x23fae0(0x123)](),_0x44b434=>String(_0x44b434[_0x23fae0(0x184)]));let _0x329bde={};if(proximity){const [_0x3ec089,_0x2ba940,_0x1850c4]=await Promise['all']([_0x2e8574[_0x23fae0(0x175)](_0x23fae0(0x1bc)),_0x2e8574[_0x23fae0(0x175)](_0x23fae0(0x18b)),_0x2e8574[_0x23fae0(0x175)](_0x23fae0(0x11f))]);_0x329bde={'alive':_0x3ec089['victim']||[],'spectators':_0x2ba940[_0x23fae0(0x1ae)]||[],'details':JSON['parse'](_0x1850c4[_0x23fae0(0x192)]||'[]')};}_0xf54607['forEach'](_0xd80e4a=>{const _0x217ac7=_0x23fae0;resetTimer();let _0x7c0f59;if(proximity)_0x7c0f59=_0x329bde[_0x217ac7(0x128)][_0x217ac7(0x1c8)](_0xd80e4a);const _0xf0467=processName(_0xd80e4a);_0x329bde[_0x217ac7(0x11b)]['includes'](_0xd80e4a)?spectators[_0xf0467]=!![]:spectators[_0xf0467]=![];if(!proximity)positions[_0xf0467]={'x':0x0,'y':0x2710,'z':0x0};else{if(!_0x329bde['alive'][_0x217ac7(0x16a)](_0xd80e4a))positions[_0xf0467]={'x':0x0,'y':0x4e20,'z':0x0};else{if(spectator&&_0x329bde[_0x217ac7(0x11b)][_0x217ac7(0x16a)](_0xd80e4a)){if(specListen===!![])positions[_0xf0467]=_0x329bde[_0x217ac7(0x192)][_0x7c0f59]['position'];else positions[_0xf0467]={'x':0x0,'y':0x2710,'z':0x0};if(specDim===!![])dimensions[_0xf0467]=_0x329bde['details'][_0x7c0f59]['dimension'];}else _0x329bde[_0x217ac7(0x192)][_0x7c0f59]?.[_0x217ac7(0x17f)]?(positions[_0xf0467]=_0x329bde[_0x217ac7(0x192)][_0x7c0f59]['position'],yRots[_0xf0467]=_0x329bde[_0x217ac7(0x192)][_0x7c0f59][_0x217ac7(0x142)],dimensions[_0xf0467]=_0x329bde['details'][_0x7c0f59]['dimension']):positions[_0xf0467]={'x':0x0,'y':0x7530,'z':0x0};}}}),shouldBroadcast=!![];}catch(_0x1e3033){console[_0x23fae0(0x14b)](_0x23fae0(0x137),_0x1e3033);}if(!stop_roop)setTimeout(()=>handleWorld(_0x2e8574),0x64);}async function connectToRelayServer(_0x141ab2){const _0x24e1d0=_0x23197b,_0x5bd2f0=_0x141ab2==='mc',_0x3b05d2=_0x5bd2f0?_0x24e1d0(0x1a2):_0x24e1d0(0x11a);try{const _0x151eb5=await fetch(_0x24e1d0(0x11d)+RELAY_SERVER_DOMAIN+_0x24e1d0(0x154)),_0x2e380f=await _0x151eb5[_0x24e1d0(0x180)](),_0x32eb92=_0x2e380f[_0x24e1d0(0x199)];if(!_0x5bd2f0)roomId=_0x32eb92;console[_0x24e1d0(0x15d)](_0x24e1d0(0x160));_0x5bd2f0?(server_log_info(_0x24e1d0(0x1a0)),server_log_info(_0x24e1d0(0x1bf)),server_log_info(_0x24e1d0(0x1ba)+RELAY_SERVER_DOMAIN+_0x24e1d0(0x171)+_0x32eb92)):(useRelay=!![],vc_connected=!![],server_log_info('ROOM\x20ID:\x20'+_0x32eb92),server_log_info('参加者はこのURLにアクセスしてください:'),server_log_info(_0x24e1d0(0x1ac)),server_log_info('https://proximity-vc-mcbe.pages.dev?roomid='+_0x32eb92));console['log']('=======================================================\x0a');const _0x2a0cb8=new WebSocket(_0x24e1d0(0x185)+RELAY_SERVER_DOMAIN+_0x24e1d0(0x171)+_0x32eb92+_0x24e1d0(0x12f));if(!_0x5bd2f0)relayWs=_0x2a0cb8;_0x2a0cb8['on']('open',()=>console[_0x24e1d0(0x15d)](_0x3b05d2+_0x24e1d0(0x1b2)+_0x32eb92+')')),_0x2a0cb8['on']('close',()=>console[_0x24e1d0(0x15d)](_0x3b05d2+_0x24e1d0(0x178)+_0x32eb92+')')),_0x2a0cb8['on'](_0x24e1d0(0x14b),_0x57340f=>console[_0x24e1d0(0x14b)](_0x3b05d2+_0x24e1d0(0x1a3),_0x57340f)),_0x5bd2f0?setupMcRelayListeners(_0x2a0cb8):setupVcRelayListeners(_0x2a0cb8);}catch(_0x354de7){console[_0x24e1d0(0x14b)](_0x3b05d2+_0x24e1d0(0x173),_0x354de7);}}function setupVcRelayListeners(_0x188979){const _0x100808=_0x23197b;_0x188979['on'](_0x100808(0x191),async _0xd823d6=>{const _0x1e6a44=_0x100808;try{const _0x30113f=JSON['parse'](_0xd823d6[_0x1e6a44(0x1b3)]());if(mainWorld&&_0x30113f[_0x1e6a44(0x18f)]===_0x1e6a44(0x12d)&&typeof _0x30113f['value']===_0x1e6a44(0x177)){const _0x72afbf=await mainWorld[_0x1e6a44(0x175)](_0x30113f[_0x1e6a44(0x19d)]);_0x188979[_0x1e6a44(0x161)](JSON[_0x1e6a44(0x13c)]({'type':_0x1e6a44(0x19e),'payload':_0x72afbf}));}}catch(_0x247a58){console[_0x1e6a44(0x14b)](_0x1e6a44(0x19f),_0x247a58);}});}function name_command(_0x23fe9e){const _0xbb5df5=_0x23197b,_0x1a8bd7=processName(_0x23fe9e);!passwords[_0x1a8bd7]&&(passwords[_0x1a8bd7]=Math[_0xbb5df5(0x18e)](0x3e8+Math[_0xbb5df5(0x13b)]()*0x2328)['toString']());const _0x37e602=lang==='ja'?_0xbb5df5(0x168)+passwords[_0x1a8bd7]+'です':_0xbb5df5(0x13e)+passwords[_0x1a8bd7];return _0x37e602;}function data_update(_0x511b37){const _0x5051ca=_0x23197b;broadcastPositions(),resetTimer();for(const [_0x5a7c3e,_0x4c5bca]of Object[_0x5051ca(0x1b6)](_0x511b37)){switch(_0x5a7c3e){case _0x5051ca(0x1c4):continue;case _0x5051ca(0x153):_0x4c5bca!==proximity&&(updateConfig(_0x5a7c3e,_0x4c5bca),proximity=_0x4c5bca);break;case _0x5051ca(0x181):positions=_0x4c5bca;break;case _0x5051ca(0x1be):_0x4c5bca!==distance&&(updateConfig(_0x5a7c3e,_0x4c5bca),distance=_0x4c5bca);break;case _0x5051ca(0x1a8):_0x4c5bca!==spectator&&(updateConfig(_0x5a7c3e,_0x4c5bca),spectator=_0x4c5bca);break;case'spectators':spectators=_0x4c5bca;break;case _0x5051ca(0x159):_0x4c5bca!==specListen&&(updateConfig(_0x5a7c3e,_0x4c5bca),specListen=_0x4c5bca);break;case'specDim':_0x4c5bca!==specDim&&(updateConfig(_0x5a7c3e,_0x4c5bca),specDim=_0x4c5bca);break;case _0x5051ca(0x1b9):dimensions=_0x4c5bca;break;case _0x5051ca(0x129):yRots=_0x4c5bca;break;case _0x5051ca(0x124):_0x4c5bca!==password&&(updateConfig(_0x5a7c3e,_0x4c5bca),password=_0x4c5bca);case'lang':_0x4c5bca!==lang&&(updateConfig(_0x5a7c3e,_0x4c5bca),lang=_0x4c5bca);break;}}}function setupMcRelayListeners(_0x4ba8c8){const _0x3dc9ea=_0x23197b;let _0x1356cb;_0x4ba8c8['on'](_0x3dc9ea(0x191),async _0x3149e8=>{const _0x5b3c88=_0x3dc9ea;try{const _0x355b3a=JSON[_0x5b3c88(0x121)](_0x3149e8[_0x5b3c88(0x1b3)]());if(_0x355b3a[_0x5b3c88(0x1c4)]===_0x5b3c88(0x16c)){console[_0x5b3c88(0x15d)](_0x5b3c88(0x1b0)),_0x1356cb=new WebSocket(_0x5b3c88(0x14d)+port),_0x1356cb['on']('open',()=>console[_0x5b3c88(0x15d)](_0x5b3c88(0x19c))),_0x1356cb['on'](_0x5b3c88(0x191),_0x2ea70e=>_0x4ba8c8[_0x5b3c88(0x17b)]===WebSocket[_0x5b3c88(0x152)]&&_0x4ba8c8[_0x5b3c88(0x161)](_0x2ea70e)),_0x1356cb['on']('close',()=>_0x4ba8c8[_0x5b3c88(0x17b)]===WebSocket[_0x5b3c88(0x152)]&&_0x4ba8c8[_0x5b3c88(0x19a)]()),_0x1356cb['on']('error',_0x5e0c13=>console[_0x5b3c88(0x14b)](_0x5b3c88(0x194),_0x5e0c13[_0x5b3c88(0x191)]));return;}else{if(_0x355b3a[_0x5b3c88(0x1c4)]==='name_command')try{const _0x148897=name_command(_0x355b3a[_0x5b3c88(0x14a)]),_0x3fd8fa={'type':_0x5b3c88(0x1bb),'message':_0x148897,'correlationId':_0x355b3a[_0x5b3c88(0x12a)]};_0x4ba8c8[_0x5b3c88(0x161)](JSON['stringify'](_0x3fd8fa));}catch(_0x83b08){console[_0x5b3c88(0x15d)](_0x83b08);}else{if(_0x355b3a[_0x5b3c88(0x1c4)]===_0x5b3c88(0x155))try{const _0x4a3828=JSON[_0x5b3c88(0x13c)]({'type':'initialization','roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang,'correlationId':_0x355b3a['correlationId']});_0x4ba8c8[_0x5b3c88(0x161)](_0x4a3828);}catch(_0x27983e){console[_0x5b3c88(0x15d)](_0x27983e);}else{if(_0x355b3a[_0x5b3c88(0x1c4)]===_0x5b3c88(0x116))try{data_update(_0x355b3a);}catch(_0x56bfed){console[_0x5b3c88(0x15d)](_0x56bfed);}else _0x355b3a[_0x5b3c88(0x1c4)]===_0x5b3c88(0x13f)&&process[_0x5b3c88(0x16d)](0x0);}}}}catch(_0x6d4739){}_0x1356cb?.[_0x5b3c88(0x17b)]===WebSocket[_0x5b3c88(0x152)]&&_0x1356cb[_0x5b3c88(0x161)](_0x3149e8);}),_0x4ba8c8['on'](_0x3dc9ea(0x19a),()=>_0x1356cb?.[_0x3dc9ea(0x19a)]());}function updateConfig(_0x5e7a69,_0x36eff6){const _0x2e14b3=_0x23197b;try{let _0x34518c=fs[_0x2e14b3(0x158)](configPath,_0x2e14b3(0x138));const _0x20b559=new RegExp('(\x22'+_0x5e7a69+_0x2e14b3(0x17d)),_0x854c4=typeof _0x36eff6==='string'?'\x22'+_0x36eff6+'\x22':_0x36eff6,_0x5a0c42=_0x34518c[_0x2e14b3(0x118)](_0x20b559,'$1'+_0x854c4);_0x5a0c42!==_0x34518c&&fs[_0x2e14b3(0x1b1)](configPath,_0x5a0c42,_0x2e14b3(0x138));}catch(_0xc884f8){console[_0x2e14b3(0x14b)](_0x2e14b3(0x136),_0xc884f8);}};async function main(){const _0x1ce812=_0x23197b;resetTimer(),port=await getPort({'port':port}),web_port=await getPort({'port':web_port}),server_log_info(_0x1ce812(0x131)+port);const _0x4413b6=express(),_0xc52dcb=http[_0x1ce812(0x15a)](_0x4413b6);_0xc52dcb['listen'](port);const _0x4d87b2=new Server({'webSocketOptions':{'server':_0xc52dcb},'timezone':_0x1ce812(0x195),'disableEncryption':!![]});_0x4413b6[_0x1ce812(0x1c6)](express[_0x1ce812(0x180)]()),_0x4413b6[_0x1ce812(0x1af)]('/',(_0x180d2e,_0x39a820)=>{const _0x5754fb=_0x1ce812;if(_0x180d2e[_0x5754fb(0x146)][_0x5754fb(0x1c4)]===_0x5754fb(0x1bb)){const _0x5da59a=name_command(_0x180d2e[_0x5754fb(0x146)][_0x5754fb(0x14a)]),_0x56c9cc={'type':_0x5754fb(0x1bb),'message':_0x5da59a};_0x39a820[_0x5754fb(0x11e)](0xc8)[_0x5754fb(0x180)](_0x56c9cc);}else{if(_0x180d2e[_0x5754fb(0x146)]['type']==='initialization'){const _0x2fa512={'type':_0x5754fb(0x155),'roomId':roomId,'proximity':proximity,'distance':distance,'spectator':spectator,'specListen':specListen,'specDim':specDim,'password':password,'lang':lang};_0x39a820[_0x5754fb(0x11e)](0xc8)['json'](_0x2fa512);}else{if(_0x180d2e[_0x5754fb(0x146)]['type']===_0x5754fb(0x116))data_update(_0x180d2e[_0x5754fb(0x146)]),_0x39a820[_0x5754fb(0x11e)](0xc8)[_0x5754fb(0x180)]({'success':!![]});else _0x180d2e[_0x5754fb(0x146)][_0x5754fb(0x1c4)]===_0x5754fb(0x13f)&&process[_0x5754fb(0x16d)](0x0);}}});const _0x20dd83=(_0x268ac2,_0x14ae6a,_0x443286)=>async(_0x29e0c0,_0x5a065b,_0xb20a65)=>{const _0xa9f25e=_0x1ce812;if(_0x5a065b[_0xa9f25e(0x184)]!==_0x29e0c0[_0xa9f25e(0x117)][_0xa9f25e(0x184)])return;if(_0xb20a65[0x0]!==_0xa9f25e(0x182)&&_0xb20a65[0x0]!==_0xa9f25e(0x150))return;const _0x39b0e5=_0xb20a65[0x0]===_0xa9f25e(0x182);if(_0x268ac2===_0xa9f25e(0x124))password=_0x39b0e5;else{if(_0x268ac2===_0xa9f25e(0x153))proximity=_0x39b0e5;else{if(_0x268ac2===_0xa9f25e(0x1a8))spectator=_0x39b0e5;else{if(_0x268ac2===_0xa9f25e(0x159))specListen=_0x39b0e5;else{if(_0x268ac2==='specDim')specDim=_0x39b0e5;}}}}updateConfig(_0x268ac2,_0x39b0e5),Object['assign'](global,{[_0x268ac2]:_0x39b0e5});const _0x43319b=lang==='ja'?_0x39b0e5?_0x14ae6a[_0xa9f25e(0x135)]:_0x14ae6a['disabled']:_0x39b0e5?_0x443286[_0xa9f25e(0x135)]:_0x443286[_0xa9f25e(0x1c3)];await _0x29e0c0['sendMessage'](_0x43319b);},_0x305d50={'!dis':async(_0x12eea4,_0x3817b4,_0x2e50da)=>{const _0xe85521=_0x1ce812;try{if(_0x3817b4['name']!==_0x12eea4[_0xe85521(0x117)][_0xe85521(0x184)])return;const _0x134fcc=Number(_0x2e50da[0x0]);if(!isNaN(_0x134fcc)){distance=_0x134fcc,updateConfig('distance',_0x134fcc);const _0x1c7fcd=lang==='ja'?_0xe85521(0x1c1)+distance+'に変更しました':_0xe85521(0x165)+distance;await _0x12eea4[_0xe85521(0x139)](_0x1c7fcd);}}catch(_0x75bc1b){}},'!name':async(_0x262f98,_0x5c3aa6)=>{const _0x4246ab=_0x1ce812;try{const _0x1225a6=processName(_0x5c3aa6[_0x4246ab(0x184)]),_0x1ae69b=_0x4246ab(0x17c)+roomId+_0x4246ab(0x18a)+_0x1225a6+'です',_0x48c8f8=_0x4246ab(0x130)+roomId+_0x4246ab(0x1a1)+_0x1225a6;await _0x5c3aa6[_0x4246ab(0x139)](lang==='ja'?_0x1ae69b:_0x48c8f8);if(password){!passwords[_0x1225a6]&&(passwords[_0x1225a6]=Math[_0x4246ab(0x18e)](0x3e8+Math['random']()*0x2328)['toString']());const _0x2cbdd5=lang==='ja'?_0x4246ab(0x168)+passwords[_0x1225a6]+'です':_0x4246ab(0x13e)+passwords[_0x1225a6];await _0x5c3aa6[_0x4246ab(0x139)](_0x2cbdd5);}}catch(_0x4db512){}},'!password':_0x20dd83(_0x1ce812(0x124),{'enabled':_0x1ce812(0x119),'disabled':_0x1ce812(0x1a6)},{'enabled':'Password\x20enabled','disabled':_0x1ce812(0x141)}),'!pvc':_0x20dd83(_0x1ce812(0x153),{'enabled':'近接vcを有効にしました','disabled':'近接vcを無効にしました'},{'enabled':'Proximity\x20VC\x20enabled','disabled':'Proximity\x20VC\x20disabled'}),'!spectator':_0x20dd83('spectator',{'enabled':_0x1ce812(0x1aa),'disabled':_0x1ce812(0x1b8)},{'enabled':'Spectator\x20and\x20VC\x20separated','disabled':_0x1ce812(0x198)}),'!specListen':_0x20dd83('specListen',{'enable':_0x1ce812(0x179),'disable':_0x1ce812(0x1a7)},{'enable':_0x1ce812(0x15f),'disable':_0x1ce812(0x149)}),'!specDim':_0x20dd83(_0x1ce812(0x143),{'enable':'\x20スペクテイター同士の会話をディメンションごとに分けました','disable':_0x1ce812(0x15c)},{'enable':'Spectator`s\x20VC\x20separated\x20by\x20dimension','disable':_0x1ce812(0x13a)}),'!lang':async(_0x55e960,_0x59fe49,_0x43cc49)=>{const _0x15390c=_0x1ce812;try{if(_0x59fe49[_0x15390c(0x184)]!==_0x55e960[_0x15390c(0x117)][_0x15390c(0x184)])return;const _0x13d5c1=_0x43cc49[0x0]==='ja'?'ja':'en';lang=_0x13d5c1,updateConfig(_0x15390c(0x12b),_0x13d5c1);const _0x5aabbc=_0x13d5c1==='ja'?_0x15390c(0x1ab):_0x15390c(0x14e);await _0x55e960[_0x15390c(0x139)](_0x5aabbc);}catch(_0x5d6f29){}},'!help':async(_0x2d24d8,_0x1a6732)=>{const _0x476325=_0x1ce812;try{await _0x1a6732[_0x476325(0x139)](_0x476325(0x172));if(lang=='ja'){await _0x1a6732['sendMessage'](_0x476325(0x151));const _0x12e2aa=_0x2d24d8[_0x476325(0x117)][_0x476325(0x184)];_0x1a6732[_0x476325(0x184)]==_0x12e2aa&&await _0x1a6732['sendMessage']('ホスト専用コマンド：\x0a\x20\u00a0!lang\x20-\x20!lang\x20<ja/en>\x20chenge\x20language\x0a\x20\u00a0!dis\x20-\x20!dis\x20<数値>\x20で声の届く距離を変更できます\x0a\x20\u00a0!pvc\x20-\x20!pvc\x20<true/false>\x20で近接vcを有効/無効にできます\x0a\x20\u00a0!spectator\x20-\x20!spectator\x20<true/false>\x20でスペクテイターとVCを分けます\x0a\x20\u00a0!specListen\x20-\x20!specListen\x20<true/false>\x20でスペクテイターが他モードプレイヤーの会話を聞けるようになります\x20\x0a\x20\u00a0!specDim\x20-\x20!specDim\x20<true/false>\x20でスペクテイター同士の会話をディメンションごとに分けます\x0a\x20\u00a0!password\x20-\x20!password\x20<true/false>\x20でパスワードを有効/無効にできます');}else{await _0x1a6732['sendMessage']('Command\x20list:\x0a\x20\u00a0!help\x20-\x20show\x20help\x0a\x20\u00a0!name\x20-\x20check\x20your\x20VC\x20GamerTag');const _0x1eddd1=_0x2d24d8['localPlayer'][_0x476325(0x184)];_0x1a6732[_0x476325(0x184)]==_0x1eddd1&&await _0x1a6732['sendMessage'](_0x476325(0x133));}await _0x1a6732[_0x476325(0x139)](_0x476325(0x172));}catch(_0x15a93e){}}};_0x4d87b2['on'](ServerEvent[_0x1ce812(0x166)],async({sender:_0x5941c9,message:_0x24febe,world:_0x434aaa})=>{const _0x8ea1ed=_0x1ce812,[_0x4faf87,..._0x48e357]=_0x24febe[_0x8ea1ed(0x1a5)]('\x20');if(_0x305d50[_0x4faf87])await _0x305d50[_0x4faf87](_0x434aaa,_0x5941c9,_0x48e357);}),_0x4d87b2['on'](ServerEvent[_0x1ce812(0x14c)],()=>setupWebSocketServer()),_0x4d87b2['on'](ServerEvent[_0x1ce812(0x16f)],async({world:_0x5e437b})=>{const _0x321973=_0x1ce812;shouldBroadcast=![],mc_connected=!![],mainWorld=_0x5e437b,stop_roop=![],server_log_info('接続開始:\x20'+_0x5e437b[_0x321973(0x184)]);if(lang=='ja'){let _0x4e5aec='';proximity?_0x4e5aec='有効':_0x4e5aec='無効',_0x5e437b[_0x321973(0x139)]('接続を開始しました\x0a近接vc：'+_0x4e5aec+'\x0a声の届く距離：'+distance+'\x0a!help\x20でコマンド一覧を確認できます');}else{let _0x8cfa8e='';proximity?_0x8cfa8e=_0x321973(0x135):_0x8cfa8e=_0x321973(0x1c3),_0x5e437b['sendMessage'](_0x321973(0x1bd)+_0x8cfa8e+_0x321973(0x14f)+distance+_0x321973(0x186));}await handleWorld(_0x5e437b);}),_0x4d87b2['on'](ServerEvent[_0x1ce812(0x125)],({world:_0xa76a29})=>{const _0xf987fa=_0x1ce812;mainWorld=null,stop_roop=!![],server_log_info(_0xf987fa(0x169)+_0xa76a29['name']);}),_0x4d87b2['on'](ServerEvent['PlayerLoad'],async({player:_0x15f424,world:_0x579f8b})=>{const _0x4425eb=_0x1ce812;server_log_info(_0x4425eb(0x157)+_0x15f424[_0x4425eb(0x184)]);const _0x22712a=setInterval(async()=>{const _0xa83ed6=_0x4425eb;try{const _0xff6bcc=processName(_0x15f424[_0xa83ed6(0x184)]),_0x251b07=_0xa83ed6(0x15b)+roomId+'です\x0aあなたのVCnameは'+_0xff6bcc+'です',_0x45fd79=_0xa83ed6(0x189)+roomId+'\x0aYour\x20VCname\x20is\x20'+_0xff6bcc;await _0x15f424['sendMessage'](lang==='ja'?_0x251b07:_0x45fd79);if(password){!passwords[_0xff6bcc]&&(passwords[_0xff6bcc]=Math['floor'](0x3e8+Math[_0xa83ed6(0x13b)]()*0x2328)[_0xa83ed6(0x1b3)]());const _0xe96ad7=lang==='ja'?_0xa83ed6(0x168)+passwords[_0xff6bcc]+'です':_0xa83ed6(0x13e)+passwords[_0xff6bcc];await _0x15f424[_0xa83ed6(0x139)](_0xe96ad7);}clearInterval(_0x22712a);}catch(_0x722ce3){}},0x1f4);}),_0x4d87b2['on'](ServerEvent['PlayerLeave'],({player:_0x1208e6,world:_0x5790a1})=>{const _0x1bbb28=_0x1ce812;server_log_info(_0x1bbb28(0x126)+_0x1208e6[_0x1bbb28(0x184)]);const _0x3ba9eb=_0x5790a1[_0x1bbb28(0x117)][_0x1bbb28(0x184)];if(_0x1208e6['name']===_0x3ba9eb)process[_0x1bbb28(0x16d)](0x0);delete positions[processName(_0x1208e6[_0x1bbb28(0x184)])];}),setInterval(()=>{if(shouldBroadcast&&vc_connected){broadcastPositions();if(mc_connected)shouldBroadcast=![];}},0x32),(sub_domain===''||username===''||ssh_password==='')&&(server_log_info('中継サーバーを使用します\x20(Relay\x20server\x20will\x20be\x20used)'),await connectToRelayServer('mc'),await connectToRelayServer('vc'));}main();
